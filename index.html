<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGA Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
                font-family: Arial, sans-serif;
                overflow: hidden; 
                position: fixed; 
                width: 100%; 
                height: 100%; 
        }

        #bar-line {
            display: flex;
            justify-content: space-between; 
            margin-bottom: 20px;
            height: 150px;
        }

        .left-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: 50px;
        }

        .button-group {
            display: flex;
            gap: 10px; 
        }

        .center-controls {
            display: flex;
            height: 55px;
            width: 100%;
            margin-top: 30px;
            gap: 5px; 
        }

        .center-controls label {
            margin-right: 0px;
            margin-top: 15px;
            width: 50px;

        }
        .center-controls input {
            margin-right: 2px!important;
            margin-top: 10px;
            width: 50px;

        }

        #menu-1 {
            width: 50%; 
            height: 120px;
        }

        .tab-content {
                display: none;
        }

        .tab-content-6 {
                display: none;
                overflow-y:auto;

        }

        .image-container h2 {
                display: flex;
                align-items: center; 
                margin: 0; 
        }

        .image-container img {
                height: 70px; 
                margin-right: 10px; 
                vertical-align: middle; 
        }

        .image-container h2 span {
                display: inline-flex;
                align-items: center; 
        }

        .tab-button {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 15px;
        }

        .button-add-grey {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 13px;
                height: 50px;
                width: 150px;
        }
        .sendToComparison {
                cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        .sendToComparison:active {
            transform: scale(0.95); 
            background-color: #d1d1d1; 
        }

        .last100 {
                cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        .last100:active {
            transform: scale(0.95); 
            background-color: #d1d1d1; 
        }

        .button-add-reference {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #0000006b;
                border-radius: 5px;
                background-color: #4bc0c033!important;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
        }

        .button-add-data {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #ff638433!important;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
        }
        
        
        .button-add-comparison {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #473737b0 !important;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                color:"white";
        }

        .tab-button.active {
                background-color: #f7caca;
        }

        .table-container {
                display: flex; 
                justify-content: flex-start;
                width: 95%;
                border: 0px solid #ddd;
                max-height: 600px; 
                margin: 20px auto;
                padding: 10px;
                overflow-x: auto; 
                overflow-y: auto!important; 
        }
        #menu-2 {
                display: flex; 
                justify-content: flex-start;
                width: 95%;
                height: 500px;
                overflow: auto; 
                border: 0px solid #ddd;
                margin: 20px auto;
                padding: 10px;
        }

        .table-container-comp {
                display: flex; 
                justify-content: flex-start;
                width: 95%;
                height: 100px;
                overflow: auto;
                border: 0px solid #ddd;
                margin: 20px auto;
                padding: 10px;
        }

        .table-container table {
                border-collapse: collapse;
                margin-right: 20px;
        }

        .table-container-comp table {
                border-collapse: collapse;
                margin-right: 20px; 
        }

        .table-container table:last-of-type {
                margin-right: 0; 
        }

        .table-container-comp table:last-of-type {
                margin-right: 0; 
        }

        table, th, td {
                width: 150px; 
                height: 40px;
                border: 1px solid;
                text-align: center;
                padding: 0;
                box-sizing: border-box;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
        }

        th {
                background-color: #f7caca;
                height: 40px;
        }

        .highlight {
                background-color: #ffffff;
        }

        .controls {
                margin-bottom: 20px;
        }

        .controls label {
                margin-right: 10px;
        }

        .summary-table {
                border-collapse: collapse;
        }

        .summary-table th, .summary-table td {
                border: 1px solid black;
                padding: 8px;
        }

        .summary-table th {
                background-color: #f7caca;
        }

        .data-table-container {
                display: flex;
        }

        .gray-row {
                background-color: #a7dfe6; 
                height: 40px; 
        }

        thead th {
                position: sticky;
                top: 0;
                background-color: #f7caca; 
                z-index: 1; 
        }
        .—Åont{
            border: 1px solid black;
            width: 100%;
            height: auto;
            overflow: auto;
        }
        #chartContainer {
            position: relative;
            width: 60%; 
            height: 460px; 
            margin-top: 20px;
            margin-left: 5px;
            font-family: 'Helvetica', sans-serif;
            border: 1px solid #ddd; 
            overflow: hidden; 
            resize: both; 
            box-sizing: border-box; 
        }
        
        canvas {
            display: block;
            width: 100% !important;  
            height: 100% !important;
        }
        .chart-title {
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .resize-handle {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 16px;
            height: 16px;
            background: #ddd;
            cursor: se-resize;
        }
        .square-button-active {
            width: auto;
            min-width: 1.5cm;
            height: 1.5cm; 
            background-color: #60656674;
            color: white;
            border: none; 
            border-radius: 5px; 
            font-size: 19px; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex; 
            align-items: center;
            justify-content: center;
            text-align: center;
            text-transform: none; 
            display: inline-block; 
            margin-right: 10px;
        }

        input[type="number"] {
            width: 50px; 
            height: 20px; 
            text-align: center;
            justify-content: center; 
        }
        .pdf-table-container {
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start;
            width: 230mm;
            height: 700px;
            overflow: auto;
            border: 0px solid #ddd;
            padding: 10px;
        }

        .pdf-body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .pdf-container {
            width: 210mm; 
            height: 297mm;
            background-color: #fff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box; 
            margin-bottom: 20px; 
        }

        .pdf-logo {
            width: 29.6mm;
            height: 29.6mm; 
        }

        .pdf-logo-cont {
            height: auto; 
            align-items: center; 
            margin-bottom: 3px; 
        }
        .pdf-text-header-big {
            justify-content: center; 
            text-align: center; 
            width: 100%; 
            height: 145px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 28px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            padding-top: 41px; 
            box-sizing: border-box;
            margin-left: 5px;
        }
        .pdf-text-name {
            width: 140px; 
            height: 30px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box;

        }
        .pdf-text-info {
            display: flex;
            justify-content: center; 
            align-items: center; 
            width: 100%; 
            height: 35px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 0px;
            padding: 0px;
        }
        .pdf-text-yes-no {
            width: 250px; 
            height: 30px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box; 
        }


        .pdf-text-header-small {
            text-align: center; 
            font-size: 20px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            padding: 10px 0; 
        }

        .pdf-text-logo {
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            margin-top: 3px;
        }

        .pdf-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .pdf-info {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-top: 15px;
        }
        
        .pdf-text-sample-name {
            font-size: 18px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
        }
        .pdf-text-plots-name {
            font-size: 18px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
        }
        .pdf-text-handover-date {
            font-size: 18px;
            align-items: left; 
            width: 210px; 
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
            margin-left: 150px;
            
        }
        .pdf-text-sample-data {
            display: flex; 
            justify-content: center;
            align-items: center;
            width: 40.6mm;
            height: 30px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 0px;
        }
        .pdf-text-sample-box {
            display: flex;
            width: 100%; 
            height: 25px;
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box;
            padding: 0px;
        }
        .pdf-text-measurement-details-box {
            display: flex; 
            width: 100%; 
            height: 30px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 22px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            padding: 0px;
        }

        label {
            font-family: 'Arial', sans-serif;
            font-size: 14px;
            color: #333;
            margin-left: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group1 {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .checkbox-group2 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 90px;
            margin-right: 10px;
        }
        .checkbox-group3 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 182px;
            margin-right: 10px;
        }
        .pdf-text-checkbox {
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 380px;
            height: 35px;
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 40px;
            padding: 0px;
        } 
        .pdf-text-final-pressure {
            width: 220px; 
            height: 35px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-right: 410px;
            padding: 0px;
        } 
        .pdf-text-final-remarks {
        
            justify-content: center; 
            align-items: center; 
            width: 100%;
            height: 120px;
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 16px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 0px;
            padding: 0px;
        } 
        .checkbox-alfresco-1 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 0px;
            margin-right: 10px;
            
        }

        .checkbox-alfresco-2 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 60px;
            margin-right: 10px;
        }
        .checkbox-alfresco-3 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 50px;
            margin-right: 10px;
        }
        .checkbox-alfresco-4 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 170px;
            margin-right: 10px;
        }
        .checkbox-alfresco-5 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 148px;
            margin-right: 10px;
        }

        .pdf-plot {
            display: flex; 
            justify-content: center; 
            width: 100%; 
            height: 90mm; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box;
            margin-left: 0px;
            padding: 0px;
        }
        .pdf-text-sample-plot {
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 100.6mm; 
            height: 30px; 
            border: 3px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 50px;
        }
        .pdf-2-name-pressure{
            display: flex; 
            justify-content: center; 
            align-items: center;
            width: 53.6mm;
            height: 30px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 10px;
            
        }
        .pdf-2-name-data{
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 53.6mm; 
            height: 30px; 
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-right: 50px;
            margin-left: 10px;
            
        }
        .pdf-2-text-pressure {
            height: 30px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box; 
        }
        .pdf-2-text-data {
            height: 30px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box;
            margin-left: 0px;
        }
        .pdf-summary-big{
            display: flex; 
            justify-content: center; 
            align-items: center;
            width: 100%; 
            height: 20px; 
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-right: 50px;
            margin-left: 10px;
            
        }
        .pdf-summary-name{
            display: flex; 
            align-items: center; 
            width: 400px; 
            height: 20px;
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 14px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 20px; 
        }
        .pdf-summary-date{
            display: flex;
            justify-content: center; 
            align-items: center; 
            width: 100px; 
            height: 20px;
            border: 2px solid rgb(0, 0, 0);
            font-size: 14px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; 
            margin-left: 0px; 
        }

        .button-container {
            display: flex;
            max-width: 1400px; 
            overflow-x: auto; 
        }

        .element-wrapper {
            display: flex;
            flex-direction: column; 
            align-items: center; 
           
        }

        input[type="color"] {
            cursor: pointer;
            width: 100%;
            height: 20px;
            border: none;
            margin-right: 10px;
        }

        @media print {

            body {
                position: static;  
                margin: 0;
                padding: 0;
                scale: 95%; 
            }



            #end-file-1, #end-file-2, #end-file-3 {
                visibility: visible;
                position: static;
                page-break-before: auto; 
                page-break-after: auto;
            }


            table, img {
                page-break-inside: avoid;
            }

           
            #end-file-1, #end-file-2, #end-file-3 {
                width: 100%; 
                margin-bottom: 5px; 
                padding: 0px;
                box-shadow: none; 
                border: none; 
            }

            #end-file-1 {
                margin-top: 0;
                
            }

            #end-file-2 {
                margin-top: 0px; 
            }

            #end-file-3 {
                margin-top: 0px; 
            }
            /* size of the printed document */
            @page {
                size: A4; 
                margin: 10mm; 
            }
        }
        .popup {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 140px;
        }

        .popup input {
            width: 35px;
        }

        .popup button {
            margin-top: 5px;
            margin-left: 10px;
        }

        .choise-of-the-quelle {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle2 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle3 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle4 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }

    </style>
</head>
<body>

    <div class="image-container">
        <h2><img src="Logo_XFEL_positiv_.jpg" alt="Logo"> <span>RGA Data Manager</span></h2>
    </div>
    <br><br>
    <div>
        <button class="tab-button active" onclick="showTab(1)"><b>Reference raw</b></button>
        <button class="tab-button" onclick="showTab(2)"><b>Reference w/o noise</b></button>
        <button class="tab-button" onclick="showTab(3)"><b>Sample raw</b></button>
        <button class="tab-button" onclick="showTab(4)"><b>Sample w/o noise</b></button>
        <button class="tab-button" onclick="showTab(5)"><b>Comparison</b></button>
        <button class="tab-button" onclick="showTab(6)"><b>Visualization</b></button>
        <button class="tab-button" onclick="showTab(7)"><b>Result sheet</b></button>
    </div>

    <div id="tab1" class="tab-content">
        <h3>Reference raw</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput1" data-tab-number="1" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="1" data-tab-number = "1" value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval1" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval1" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="1" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="1" data-ref="1" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable1" class="summary-table">
                <!--  Content of the table summaryTable1 -->
            </table>
            <table id="dataTable1">
                <!--  Content of the table dataTable1 -->
            </table>
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <h3>Ref noise removal</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput2" data-tab-number="2" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="2" data-tab-number = "2" value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval2" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval2" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="2" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="2" data-ref="1" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable2" class="summary-table">
                <!--  Content of the table summaryTable2 -->
            </table>
            <table id="dataTable2">
                <!--  Content of the table dataTable2 -->
            </table>
        </div>
    </div>

    <div id="tab3" class="tab-content">
        <h3>Sample data</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput3" data-tab-number="3" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="3" data-tab-number = "3"  value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval3" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval3" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="3" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="3" data-ref="2" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable3" class="summary-table">
                <!--  Content of the table summaryTable3 -->
            </table>
            <table id="dataTable3">
                <!--  Content of the table dataTable3 -->
            </table>
        </div>
    </div>

    <div id="tab4" class="tab-content">
        <h3>Data noise removal</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput4" data-tab-number="4" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="4" data-tab-number = "4"  value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval4" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval4" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="4" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="4" data-ref="2" style="margin-left: 10px;" data-tab="4">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable4" class="summary-table">
                <!--  Content of the table summaryTable4 -->
            </table>
            <table id="dataTable4">
                <!--  Content of the table dataTable4 -->
            </table>
        </div>
    </div>


    <div id="tab5" class="tab-content">
        <h3>Comparison</h3>
        <label><b>Reference average</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable5" class="summary-table">
                    <!--  Content of the table summaryTable5 -->
                </table>
                <table id="dataTable5">
                    <!--  Content of the table dataTable5 -->
                </table>
            </div>
        </div>
        <br><br>
        <!-- Label "Data average" -->
        <label><b>Data average</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable6" class="summary-table">
                    <!--  Content of the table summaryTable6 -->
                </table>
                <table id="dataTable6">
                    <!--  Content of the table dataTable6 -->
                </table>
            </div>
        </div>
        <label><b>Comparison</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable7" class="summary-table">
                    <!--  Content of the table summaryTable6 -->
                </table>
                <table id="dataTable7">
                    <!--  Content of the table dataTable6 -->
                </table>
            </div>
        </div>
    </div>
    <div id="tab6" class="tab-content">
        <h3>Data Visualization</h3>
        
        <!-- container for the diagram-->
        <div id="menu-1">
            <div id="bar-line">
                <!-- left side -->
                <div class="left-buttons">
                    <!-- first group of the buttons  -->
                    <div class="button-group">
                        <input type="color" id="colorPicker_reference_bar" style = "width: 15px; height: 50px; margin-right: 0;" value="#4BC0C0">
                        <button id="toggleChartFromTable5" class="button-add-grey" >Add/delete Reference<br><b>(chart)</b></button>
                        <div id="opacityPopup_reference" class="popup" style="display: none;">
                            <label for="opacityInput_reference_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_reference_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_reference">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_sample_bar" style = "width: 15px; height: 50px;  margin-right: 0px;" value="#ff6384">
                        <button id="toggleChartFromTable6" class="button-add-grey">Add/delete Data<br><b>(chart)</b></button>
                        <div id="opacityPopup_sample" class="popup" style="display: none;">
                            <label for="opacityInput_sample_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_sample_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_sample">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_comparison_bar" style = "width: 15px; height: 50px;  margin-right:0px; border-width: 0px;" value="#464544">
                        <button id="toggleChartFromTable7" class="button-add-grey">Add the comparison<br><b>(chart)</b></button>
                        <div id="opacityPopup_comparison" class="popup" style="display: none;">
                            <label for="opacityInput_comarison_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_comparison_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_comparison">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_vacuum_100" style = "width: 15px; height: 50px; margin-right: 0px;" value="#ff4400">
                        <button id="vacuum_100" class="button-add-grey">Add the Vacuum Line<br><b>(1/100)</b> (for data) </button>
                        <button class="button-add-grey"><label for="yMin">Y Min:</label>
                        <input type="number" id="yMin" step="0.1" value="1e-15"></button>
                        <button class="button-add-grey"><label for="xMin">X Min:</label>
                        <input type="number" id="xMin" step="0.1" value="1"></button>
                        <button id="saveButton" class="button-add-grey">Save the plot</button>
                        <button id="downloadBtn_refernce" class="button-add-grey">Send to result sheet<br><b>Reference</b></button>
                        <button id="clearHistograms" class="button-add-grey">Clear the plot</button>
                    </div>
                    <!-- Second group of the button-->
                    <div class="button-group">
                        <input type="color" id="colorPicker_reference_line" style = "width: 15px; height: 50px; margin-right: 0px;" value="#4BC0C0">
                        <button id="toggleChartFromTable5-2" class="button-add-grey">Add/delete Reference<br><b>(line)</b></button>
                        <input type="color" id="colorPicker_sample_line" style = "width: 15px; height: 50px; margin-right: 0px;" value="#FF6384">
                        <button id="toggleChartFromTable6-2" class="button-add-grey">Add/delete Data<br><b>(line)</b></button>
                        <input type="color" id="colorPicker_comparison_line" style = "width: 15px; height: 50px; margin-right: 0px;" value="#464544">
                        <button id="toggleChartFromTable7-2" class="button-add-grey">Add the comparison<br><b>(line)</b></button>
                        <input type="color" id="colorPicker_vacuum_1000" style = "width: 15px; height: 50px; margin-right: 0px;" value="#ff4400">
                        <button id="vacuum_1000" class="button-add-grey">Add the Vacuum Line<br><b>(1/1000)</b> (for data) </button>
                        <button class="button-add-grey"><label for="yMax">Y Max:</label>
                        <input type="number" id="yMax" step="0.1" value="1e-6"></button>
                        <button class="button-add-grey"><label for="xMax">X Max:</label>
                        <input type="number" id="xMax" step="0.1" value="100"></button>
                        <button id="downloadBtn_sample" class="button-add-grey">Send to result sheet<br><b>Sample</b></button>
                        <button id="downloadBtn_summary" class="button-add-grey">Send to result sheet<br><b>Summary</b></button>                        
                    </div>
                </div>
            </div>
        </div>
        <div class="button-container">
            <!-- element button and corresponding color button  -->
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Water" class="square-button-active" element="Water">H<sub>2</sub>O</button>
                <input type="color" id="colorPicker_Water" value="#00BFFF">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonDioxide" class="square-button-active" element="CarbonDioxide">CO<sub>2</sub></button>
                <input type="color" id="colorPicker_CarbonDioxide" value="#ff4400">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Oxygen" class="square-button-active" element="Oxygen">O<sub>2</sub></button>
                <input type="color" id="colorPicker_Oxygen" value="#41cb8f">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Nitrogen" class="square-button-active" element="Nitrogen">N<sub>2</sub></button>
                <input type="color" id="colorPicker_Nitrogen" value="#010055">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Air" class="square-button-active" element="Air">Air</button>
                <input type="color" id="colorPicker_Air" value="#5bd1ff">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_TurbopumpOil" class="square-button-active" element="TurbopumpOil">TPump Oil</button>
                <input type="color" id="colorPicker_TurbopumpOil" value="#d5ff1d">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Trifluoromethane" class="square-button-active" element="Trifluoromethane">CHF<sub>3</sub></button>
                <input type="color" id="colorPicker_Trifluoromethane" value="#43f343">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Tetrafluoromethane" class="square-button-active" element="Tetrafluoromethane">CF<sub>4</sub></button>
                <input type="color" id="colorPicker_Tetrafluoromethane" value="#dc43f3">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Hydrogen" class="square-button-active" element="Hydrogen">H<sub>2</sub></button>
                <input type="color" id="colorPicker_Hydrogen" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Helium" class="square-button-active" element="Helium">He</button>
                <input type="color" id="colorPicker_Helium" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Methane" class="square-button-active" element="Methane">CH<sub>4</sub></button>
                <input type="color" id="colorPicker_Methane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ammonia" class="square-button-active" element="Ammonia">NH<sub>3</sub></button>
                <input type="color" id="colorPicker_Ammonia" value="#959296">
            </div>    
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Neon" class="square-button-active" element="Neon">Ne</button>
                <input type="color" id="colorPicker_Neon" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetylene" class="square-button-active" element="Acetylene">C<sub>2</sub>H<sub>2</sub></button>
                <input type="color" id="colorPicker_Acetylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Diborane" class="square-button-active" element="Diborane">B<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Diborane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_VinylChloride" class="square-button-active" element="VinylChloride">C<sub>2</sub>H<sub>3</sub>Cl</button>
                <input type="color" id="colorPicker_VinylChloride" value="#959296">
            </div>            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonMonoxide" class="square-button-active" element="CarbonMonoxide">CO</button>
                <input type="color" id="colorPicker_CarbonMonoxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethylene" class="square-button-active" element="Ethylene">C<sub>2</sub>H<sub>4</sub></button>
                <input type="color" id="colorPicker_Ethylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethane" class="square-button-active" element="Ethane">C<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Ethane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Propane" class="square-button-active" element="Propane">C<sub>3</sub>H<sub>8</sub></button>
                <input type="color" id="colorPicker_Propane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetaldehyde" class="square-button-active" element="Acetaldehyde">CH<sub>3</sub>CHO</button>
                <input type="color" id="colorPicker_Acetaldehyde" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_FormicAcid" class="square-button-active" element="FormicAcid">HCOOH</button>
                <input type="color" id="colorPicker_FormicAcid" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitricAcid" class="square-button-active" element="NitricAcid">HNO<sub>3</sub></button>
                <input type="color" id="colorPicker_NitricAcid" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Silane" class="square-button-active" element="Silane">SiH<sub>4</sub></button>
                <input type="color" id="colorPicker_Silane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrogenDioxide" class="square-button-active" element="NitrogenDioxide">NO<sub>2</sub></button>
                <input type="color" id="colorPicker_NitrogenDioxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Methanol" class="square-button-active" element="Methanol">CH<sub>3</sub>OH</button>
                <input type="color" id="colorPicker_Methanol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_EthyleneGlycol" class="square-button-active" element="EthyleneGlycol">C<sub>2</sub>H<sub>6</sub>O<sub>2</sub></button>
                <input type="color" id="colorPicker_EthyleneGlycol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethanol" class="square-button-active" element="Ethanol">C<sub>2</sub>H<sub>5</sub>OH</button>
                <input type="color" id="colorPicker_Ethanol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_HydrogenSulfide" class="square-button-active" element="HydrogenSulfide">H<sub>2</sub>S</button>
                <input type="color" id="colorPicker_HydrogenSulfide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Argon" class="square-button-active" element="Argon">Ar</button>
                <input type="color" id="colorPicker_Argon" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Propene" class="square-button-active" element="Propene">C<sub>3</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Propene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetone" class="square-button-active" element="Acetone">CH<sub>3</sub>COCH<sub>3</sub></button>
                <input type="color" id="colorPicker_Acetone" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Butane" class="square-button-active" element="Butane">C<sub>4</sub>H<sub>10</sub></button>
                <input type="color" id="colorPicker_Butane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_MethylEthylKetone" class="square-button-active" element="MethylEthylKetone">C<sub>4</sub>H<sub>8</sub>O</button>
                <input type="color" id="colorPicker_MethylEthylKetone" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_MPOil" class="square-button-active" element="MPOil">MPOil</button>
                <input type="color" id="colorPicker_MPOil" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_AceticAcid" class="square-button-active" element="AceticAcid">CH<sub>3</sub>COOH</button>
                <input type="color" id="colorPicker_AceticAcid" value="#959296">
            </div>           
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrousOxide" class="square-button-active" element="NitrousOxide">N<sub>2</sub>O</button>
                <input type="color" id="colorPicker_NitrousOxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_IsopropylAlcohol" class="square-button-active" element="IsopropylAlcohol">C<sub>3</sub>H<sub>8</sub>O</button>
                <input type="color" id="colorPicker_IsopropylAlcohol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_BoronTrifluoride" class="square-button-active" element="BoronTrifluoride">BF<sub>3</sub></button>
                <input type="color" id="colorPicker_BoronTrifluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_DPOilPPE" class="square-button-active" element="DPOilPPE">DPOilPPE</button>
                <input type="color" id="colorPicker_DPOilPPE" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrogenTrifluoride" class="square-button-active" element="NitrogenTrifluoride">NF<sub>3</sub></button>
                <input type="color" id="colorPicker_NitrogenTrifluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Disilane" class="square-button-active" element="Disilane">Si<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Disilane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Diphosphine" class="square-button-active" element="Diphosphine">P<sub>2</sub>H<sub>4</sub></button>
                <input type="color" id="colorPicker_Diphosphine" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_SulfurDioxide" class="square-button-active" element="SulfurDioxide">SO<sub>2</sub></button>
                <input type="color" id="colorPicker_SulfurDioxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Fomblin" class="square-button-active" element="Fomblin">Fomblin</button>
                <input type="color" id="colorPicker_Fomblin" value="#959296">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon13" class="square-button-active" element="Freon13">Freon 13</button>
                <input type="color" id="colorPicker_Freon13" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonDisulfide" class="square-button-active" element="CarbonDisulfide">CS<sub>2</sub></button>
                <input type="color" id="colorPicker_CarbonDisulfide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Arsine" class="square-button-active" element="Arsine">AsH<sub>3</sub></button>
                <input type="color" id="colorPicker_Arsine" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Benzene" class="square-button-active" element="Benzene">C<sub>6</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Benzene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_DPOilDC705" class="square-button-active" element="DPOilDC705">DPOilDC705</button>
                <input type="color" id="colorPicker_DPOilDC705" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Krypton" class="square-button-active" element="Krypton">Kr</button>
                <input type="color" id="colorPicker_Krypton" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon12" class="square-button-active" element="Freon12">Freon 12</button>
                <input type="color" id="colorPicker_Freon12" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_SiliconTetrafluoride" class="square-button-active" element="SiliconTetrafluoride">SiF<sub>4</sub></button>
                <input type="color" id="colorPicker_SiliconTetrafluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Toluene" class="square-button-active" element="Toluene">C<sub>7</sub>H<sub>8</sub></button>
                <input type="color" id="colorPicker_Toluene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Trichloroethylene" class="square-button-active" element="Trichloroethylene">C<sub>2</sub>HCl<sub>3</sub></button>
                <input type="color" id="colorPicker_Trichloroethylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon11" class="square-button-active" element="Freon11">Freon 11</button>
                <input type="color" id="colorPicker_Freon11" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Xenon" class="square-button-active" element="Xenon">Xe</button>
                <input type="color" id="colorPicker_Xenon" value="#959296">
            </div>    
        </div>    
        <div id="chartContainer">
            <canvas id="myChart"></canvas>
        </div>
        <!-- –í–∞—à–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ 6 -->
    </div>

    <div id="tab7" class="tab-content">
        <h3>Result sheet</h3>
        <div class="controls">
            <!-- –ó–¥–µ—Å—å –º–æ–≥—É—Ç –±—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <button onclick="saveAsPDF()" class="button-add-grey"><b>Save as pdf / Print</b></button>
        </div>
        <div class="pdf-table-container"  >
            <div class="pdf-container" id = "end-file-1">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">SAMPLE</div>
                        <div class="pdf-text-handover-date" contenteditable="false">HANDOVER DATE:</div>
                        <div class="pdf-text-sample-data" contenteditable="true" id="data-final-3"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Designation
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Requested by:
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Treatment:
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">MEASUREMENT DETAILS</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Method:
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="vac_standard" class="checkbox-group1">VAC Standard Lab Qualification</label>
                        <label><input type="checkbox" id="baked" class="checkbox-group2">Baked </label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="Untriggered"class="checkbox-group1">VAC Untriggered</label>
                        <label><input type="checkbox" id="Unbaked" class="checkbox-group3">Unbaked</label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="EasyView"class="checkbox-group1">EasyView</label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="Other"class="checkbox-group1">Other (specify):</label>
                        <div class="pdf-text-checkbox" contenteditable="true"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Final pressure:</div>
                    <div class="pdf-text-final-pressure" contenteditable="true" id="final_pressure"></div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Measurement date &<br>Alfresco file name:</div>
                    <div class="pdf-text-info" contenteditable="true"></div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Remarks:</div>
                    <div class="pdf-text-final-remarks" contenteditable="true"></div>
                </div>

                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">CHECKOUT</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Alfresco Upload:</div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label style="color: red; font-size: 18px; font-weight: bold;"><input type="checkbox" id="Raw"class="checkbox-alfresco-1">Raw data</label>
                        <label style="color: red; font-size: 18px; font-weight: bold;"><input type="checkbox" id="Screenshots"class="checkbox-alfresco-2">Screenshots</label>
                        <label style="color: red; font-size: 18px; font-weight: bold;"><input type="checkbox" id="Reference"class="checkbox-alfresco-3">Reference</label>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Cleared for UHV vessels<br>according specifications:</div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label style="color: red; font-size: 22px;">
                            <input type="checkbox" id="yes" class="checkbox-alfresco-4">
                            <b>YES</b>
                        </label>
                        <label style="color: red; font-size: 22px;">
                            <input type="checkbox" id="no" class="checkbox-alfresco-5">
                            <b>NO</b>
                        </label>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Commenced by:</div>
                    <div class="pdf-text-info" contenteditable="true">Frederik Meyn</div>

                </div>
                
            </div>
            <div class="pdf-container" id = "end-file-2">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Reference Measurement</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_reference" style="width: 100%;">
                            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                        </div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" id="data-final-1"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false">Final pressure:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" id=""></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Sample Measurement</div>
                        <div class="pdf-text-sample-plot" contenteditable="true"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_sample" style="width: 100%;"></div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" id="data-final-2"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false">Final pressure:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" id=""></div>
                    </div>
                </div>
                <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
            </div>
            <div class="pdf-container" id = "end-file-3">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="–ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Summary</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_summary" style="width: 100%;"></div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Water peak:</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water-peak"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">All masses < 45 are below 1/100 of water:</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water_1">yes</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">All other masses are below 1/1000 of water</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water_2">yes</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Sum of all scanned masses:</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "sum_of_all_scan"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Sum of masses > 44:</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "sum_of_44"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Contribution of masses > 44 to total:</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "contribution_of_44"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false" style="color: red; font-size: 14px; font-weight: bold;">Cleared for XFEL UHV systems:</div>
                        <div class="pdf-summary-date" contenteditable="true">yes*</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false" style="margin-left: 60px;"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false" style="padding-top: 20px; ">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" style="margin-top: 15px; " id="data-final-4"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false" style="padding-top: 15px; ">Signature:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" style="height: 50px; width: 170px;">F. Meyn</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
            </div>
        </div>
    </div>



<script>
    let data1 = [];
    let data3 = [];
    let filestatus = []
    
    function showTab(tabNumber) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
        
        document.getElementById('tab' + tabNumber).style.display = 'block';
        document.querySelector('.tab-button:nth-of-type(' + tabNumber + ')').classList.add('active');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω
        const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
        if (document.getElementById('fileInput' + tabNumber).files[0]) {
            if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
                } else {
                    processFile1(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
                }
        }
    }
    document.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', function(event) {
            const tabNumber = event.target.getAttribute('data-tab-number'); // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –≤–∫–ª–∞–¥–∫–∏ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
            const file = event.target.files[0];
            if (file) {
                filestatus.push("changed" + tabNumber);
                const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
                // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(file, 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber, filestatus);
                } else {
                    processFile1(file, 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber, filestatus);
                }
            }
        });
    });
    function initializeButtons() {
    // Get all buttons with the class 'choise-of-the-quelle'
        const buttons = document.querySelectorAll('.choise-of-the-quelle');
        buttons.forEach((button) => {
            let isKarabo = true; // Variable to track the current state of the button

            button.addEventListener('click', (event) => {
                // Get the tab number from the button's data attribute
                const tabNumber = button.getAttribute('data-tab-number');

                // Select the file input corresponding to the tab number
                const inputFile = document.querySelector(`input[type="file"][data-tab-number="${tabNumber}"]`);
                const file = inputFile ? inputFile.files[0] : null; // Get the file if available

                // Toggle the button text and process the file based on the state
                if (isKarabo) {
                    button.value = 'Software'; // Set button text to 'Software'
                    button.textContent = 'Software'; // Set button text to 'Karabo'
                    if (file) {
                        processFile1(file, `dataTable${tabNumber}`, `summaryTable${tabNumber}`, tabNumber, filestatus);
                    }
                } else {
                    button.value = 'Karabo'; // Set button text to 'Karabo'
                    button.textContent = 'Karabo'; // Set button text to 'Karabo'
                    if (file) {
                        processFile2(file, `dataTable${tabNumber}`, `summaryTable${tabNumber}`, tabNumber, filestatus);
                    }
                }

                // Toggle the state for the next click
                isKarabo = !isKarabo;
            });
        });
    }

// Call the initialization function after the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', initializeButtons);
    function processFile2(file, dataTableId, summaryTableId, tabNumber, filestatus) {
        if (!file) {
            alert('Choose the file');
            return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            const dataTable = document.getElementById(dataTableId);
            const summaryTable = document.getElementById(summaryTableId);
            dataTable.innerHTML = '';
            summaryTable.innerHTML = '';

            const numLabels = 100; // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 100

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö
            const dataHeaderRow = document.createElement('tr');
            const dataFirstCell = document.createElement('th');
            dataFirstCell.textContent = '‚Ññ';
            dataHeaderRow.appendChild(dataFirstCell);
            for (let i = 1; i <= numLabels; i++) {
                const th = document.createElement('th');
                th.textContent = i; // –ù–æ–º–µ—Ä–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π –≤ –æ–±—ã—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                dataHeaderRow.appendChild(th);
            }
            dataTable.appendChild(dataHeaderRow);

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∑—é–º–µ
            const summaryHeaderRow = document.createElement('tr');
            summaryHeaderRow.innerHTML = '<th>Sum</th><th>Sum>44</th><th>Ratio</th>';
            summaryTable.appendChild(summaryHeaderRow);
            const data = [];
            let previousRow = Array(numLabels + 1).fill(0);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞
            lines.forEach((line, index) => {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
                if (index === 0) return; 
                const values = line.trim().split(/,/); // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–∞–ø—è—Ç–æ–π
                if (values.length < 2) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–Ω–∞—á–µ–Ω–∏–π

                const row = [index]; // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏

                for (let i = 2; i < values.length; i++) {
                    let cellValue = values[i].trim(); // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã
                    let value;

                    if (cellValue === 'Skipped') {
                        value = previousRow[i] || 0; // –ï—Å–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µc–Ω–∏–µ
                    } else {
                        value = parseFloat(cellValue.replace(',', '.'));
                        value = isNaN(value) ? 0 : value; // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π NaN
                    }
                    row.push(value);
                }

                previousRow = row.slice(); // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É
                data.push(row);
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            if (tabNumber === 1) {
                data1 = data;
            } else if (tabNumber === 3) {
                data3 = data;
            }

            // –ó–∞–º–µ–Ω—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            if (typeof tabNumber === 'string') {
                tabNumber = parseInt(tabNumber); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ
            }

            // –ó–∞–º–µ–Ω—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            if (tabNumber === 2 || tabNumber === 4) {
                data.forEach(row => {
                    for (let i = 1; i < row.length; i++) {
                        if (row[i] < 0) {
                            row[i] = 0;
                        }
                    }
                });
            }
            displayData(dataTableId, data, tabNumber, filestatus);
            updateSummaryTable(summaryTableId, data, tabNumber);
            updateAverages(dataTableId, data, tabNumber);
        };

        reader.readAsText(file);
    }

    function processFile1(file, dataTableId, summaryTableId, tabNumber, filestatus) {
        if (!file) {
            alert('Choose the file');
            return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            const dataTable = document.getElementById(dataTableId);
            const summaryTable = document.getElementById(summaryTableId);
            dataTable.innerHTML = '';
            summaryTable.innerHTML = '';

            const numLabels = 100; // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 100

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö
            const dataHeaderRow = document.createElement('tr');
            const dataFirstCell = document.createElement('th');
            dataFirstCell.textContent = '‚Ññ';
            dataHeaderRow.appendChild(dataFirstCell);

            for (let i = 1; i <= numLabels; i++) {
                const th = document.createElement('th');
                th.textContent = i; // –ù–æ–º–µ—Ä–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π –≤ –æ–±—ã—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                dataHeaderRow.appendChild(th);
            }
            dataTable.appendChild(dataHeaderRow);

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∑—é–º–µ
            const summaryHeaderRow = document.createElement('tr');
            summaryHeaderRow.innerHTML = '<th>Sum</th><th>Sum>44</th><th>Ratio</th>';
            summaryTable.appendChild(summaryHeaderRow);

            const data = [];
            let previousRow = Array(numLabels + 1).fill(0);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞
            lines.forEach((line) => {
                const values = line.trim().split(/\s+/);
                if (values.length <= numLabels) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–Ω–∞—á–µ–Ω–∏–π
                const measurementNumber = parseInt(values[0], 10);
                const row = [measurementNumber];

                for (let i = 1; i <= numLabels; i++) {
                    const cellValue = values[i];
                    let value;
                    if (cellValue === 'Skipped') {
                        value = previousRow[i];
                    } else {
                        value = parseFloat(cellValue.replace(',', '.'));
                        value = isNaN(value) ? 0 : value; // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π NaN
                    }
                    row.push(value);
                }

                previousRow = row.slice(); // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É
                data.push(row);
            });
            let tabNumber1 = String.valueOf(tabNumber)
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            if (tabNumber === 1) {
                data1 = data;
            } else if (tabNumber === 3) {
                data3 = data;
            }
            if (typeof tabNumber === 'string') {
                tabNumber = parseInt(tabNumber); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ
            }

            // –ó–∞–º–µ–Ω—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            if (tabNumber === 2 || tabNumber === 4) {
                data.forEach(row => {
                    for (let i = 1; i < row.length; i++) {
                        if (row[i] < 0) {
                            row[i] = 0;
                        }
                    }
                });
                
            }
            displayData(dataTableId, data, tabNumber, filestatus);
            updateSummaryTable(summaryTableId, data, tabNumber);
            updateAverages(dataTableId, data, tabNumber);
        };

        reader.readAsText(file);
    }

    function displayData(tableId, data, tabNumber,filestatus) {
        let startInterval = 0;
        let endInterval = 100;
        if (!Array.isArray(filestatus)) {
            filestatus = []; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∫ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
        }
        if (filestatus.includes("changed" + tabNumber))  {
            startInterval = data[0][0];
            document.getElementById('startInterval' + tabNumber).value = data[0][0];

            endInterval = data[data.length - 1][0]; 
            document.getElementById('endInterval' + tabNumber).value = endInterval; 
            // –£–±–∏—Ä–∞–µ–º "changed" + tabNumber –∏–∑ filestatus
            filestatus = filestatus.filter(item => item !== "changed" + tabNumber);
            
            // –ï—Å–ª–∏ filestatus –ø—É—Å—Ç–æ–π, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –µ–º—É –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
            
        }
        else {
            // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω, –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ input
            startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
            endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);
        }

        const table = document.getElementById(tableId);
        table.innerHTML = '';

        const numLabels = 100; // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 100

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö
        const headerRow = document.createElement('tr');
        const firstCell = document.createElement('th');
        firstCell.textContent = '‚Ññ';
        headerRow.appendChild(firstCell);

        for (let i = 1; i <= numLabels; i++) {
            const th = document.createElement('th');
            th.textContent = i; // –ù–æ–º–µ—Ä–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π –≤ –æ–±—ã—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            headerRow.appendChild(th);
        }
        table.appendChild(headerRow);

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        data.forEach(row => {
            const measurementNumber = row[0];
            if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                const tr = document.createElement('tr');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    td.textContent = index === 0 ? cell : cell.toExponential(4); // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
        updateAverages(tableId, data, tabNumber);
    }

    function updateSummaryTable(summaryTableId, data, tabNumber) {
        const summaryTable = document.getElementById(summaryTableId);
        const startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
        const endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);


    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–∫—É
        const filteredData = data.filter(row => row[0] >= startInterval && row[0] <= endInterval);
        filteredData.forEach(row => {
            const tr = document.createElement('tr');
        
            const sum = row.slice(1).reduce((acc, val) => acc + val, 0);
            const sumGreaterThan44 = row.slice(45).reduce((acc, val) => acc + val, 0);
            const ratio = sum > 0 ? sumGreaterThan44 / sum : 0;

            const sumTd = document.createElement('td');
            sumTd.textContent = sum.toExponential(4); // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            tr.appendChild(sumTd);

            const sumGreaterThan44Td = document.createElement('td');
            sumGreaterThan44Td.textContent = sumGreaterThan44.toExponential(4); // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            tr.appendChild(sumGreaterThan44Td);

            const ratioTd = document.createElement('td');
            ratioTd.textContent = ratio.toExponential(4); // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            tr.appendChild(ratioTd);

            summaryTable.appendChild(tr);
        });

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å–æ —Å—Ä–µ–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
        const avgRow = document.createElement('tr');
        avgRow.classList.add('gray-row'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Å–µ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏

        let sumSum = 0, sumSumGreaterThan44 = 0, sumRatio = 0;
        let count = filteredData.length;

        filteredData.forEach(row => {
            const sum = row.slice(1).reduce((acc, val) => acc + val, 0);
            const sumGreaterThan44 = row.slice(45).reduce((acc, val) => acc + val, 0);
            const ratio = sum > 0 ? sumGreaterThan44 / sum : 0;

            sumSum += sum;
            sumSumGreaterThan44 += sumGreaterThan44;
            sumRatio += ratio;
        });

        const avgSum = count > 0 ? sumSum / count : 0;
        const avgSumGreaterThan44 = count > 0 ? sumSumGreaterThan44 / count : 0;
        const avgRatio = count > 0 ? sumRatio / count : 0;

        const avgSumTd = document.createElement('td');
        avgSumTd.textContent = avgSum.toExponential(4);
        avgRow.appendChild(avgSumTd);

        const avgSumGreaterThan44Td = document.createElement('td');
        avgSumGreaterThan44Td.textContent = avgSumGreaterThan44.toExponential(4);
        avgRow.appendChild(avgSumGreaterThan44Td);

        const avgRatioTd = document.createElement('td');
        avgRatioTd.textContent = avgRatio.toExponential(4);
        avgRow.appendChild(avgRatioTd);

        summaryTable.appendChild(avgRow);
    }

    function updateAverages(tableId, data, tabNumber) {
        const numLabels = 100;
        const startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
        const endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);

        const table = document.getElementById(tableId);

        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        document.querySelectorAll(`#${tableId} .compare-row`).forEach(row => row.remove());
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ —Å —Å—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
        let avgRow = document.querySelector(`#${tableId} .average-row`);
        if (!avgRow) {
            avgRow = document.createElement('tr');
            avgRow.classList.add('average-row', 'gray-row');
            table.appendChild(avgRow);
        } else {
            avgRow.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
        }

        // –ü–µ—Ä–≤–∞—è —è—á–µ–π–∫–∞ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "Average"
        const avgFirstCell = document.createElement('td');
        avgFirstCell.textContent = 'Average';
        avgRow.appendChild(avgFirstCell);

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        const averages = [];
        for (let i = 1; i <= numLabels; i++) {
            let sum = 0, count = 0;
            data.forEach(row => {
                const measurementNumber = row[0];
                if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                    const value = row[i];
                    if (!isNaN(value)) {
                        sum += value;
                        count++;
                    }
                }
            });
            const avg = count > 0 ? sum / count : 0;
            averages.push(avg);

            // –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫—É —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            const avgTd = document.createElement('td');
            avgTd.textContent = avg.toExponential(4);
            avgRow.appendChild(avgTd);
        }

        // –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å 18-–º —ç–ª–µ–º–µ–Ω—Ç–æ–º (–∏–Ω–¥–µ–∫—Å 17)
        const avgValue18 = averages[17];

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        const compareRow1 = createCompareRow('> 0.01 of 18', averages, avgValue18, 0.01, 1, 44); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç 1 –¥–æ 44
        const compareRow2 = createCompareRow('> 0.001 of 18', averages, avgValue18, 0.001, 45, numLabels); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç 45 –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É
        table.appendChild(compareRow1);
        table.appendChild(compareRow2);

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —è—á–µ–µ–∫
        highlightCellsInRange(tableId, startInterval, endInterval);
        if (tabNumber === 4) {
            let foundRed1 = false;
            let foundRed2 = false;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è compareRow1
            compareRow1.querySelectorAll('td').forEach(td => {
                if (td.style.backgroundColor === 'rgb(243, 105, 105)') {  // rgb(243, 105, 105) ‚Äî —ç—Ç–æ #f36969 –≤ —Ñ–æ—Ä–º–∞—Ç–µ rgb
                    document.getElementById('water_1').innerText = "no";
                }
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è compareRow2
            compareRow2.querySelectorAll('td').forEach(td => {
                if (td.style.backgroundColor === 'rgb(243, 105, 105)') {  // rgb(243, 105, 105) ‚Äî —ç—Ç–æ #f36969 –≤ —Ñ–æ—Ä–º–∞—Ç–µ rgb
                    document.getElementById('water_2').innerText = "no";
                }
            });
        }
    }

    function createCompareRow(label, averages, baseValue, multiplier, start, end) {
        const compareRow = document.createElement('tr');
        compareRow.classList.add('compare-row');

        const compareLabelCell = document.createElement('td');
        compareLabelCell.textContent = label;
        compareRow.appendChild(compareLabelCell);
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —è—á–µ–µ–∫ —Ç–æ–ª—å–∫–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
        for (let i = 1; i <= averages.length; i++) { // –ò—Å–ø–æ–ª—å–∑—É–µ–º <= –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            const compareTd = document.createElement('td');
            if (i >= start && i <= end) {
                const compareValue = averages[i - 1]; // –ü—Ä–∏–≤–æ–¥–∏–º i –∫ –∏–Ω–¥–µ–∫—Å—É –º–∞—Å—Å–∏–≤–∞ (i-1)
                compareTd.style.backgroundColor = compareValue > multiplier * baseValue ? '#f36969' : '#9ee3a3'; // –ö—Ä–∞—Å–Ω—ã–π –∏–ª–∏ –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç
            } else {
                compareTd.style.backgroundColor = '#A9A9A9'; // –°–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —è—á–µ–µ–∫
            }
            compareRow.appendChild(compareTd);
        }

        return compareRow;
    }

    function highlightCellsInRange(tableId, startInterval, endInterval) {
        document.querySelectorAll(`#${tableId} tr`).forEach(tr => {
            const cells = tr.getElementsByTagName('td');
            for (let i = 1; i < cells.length; i++) {
                const cell = cells[i];
                const measurementNumber = parseInt(tr.cells[0].textContent, 10);
                if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                    cell.classList.add('highlight');
                } else {
                    cell.classList.remove('highlight');
                }
            }
        });
    }

    let myChart = null;
    let datasets = {}; // –•—Ä–∞–Ω–∏–º –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    let datasetList = {};
    const datasetColors = {};
    const datasetStack = {};
    let annotations = []; // –•—Ä–∞–Ω–∏–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
    const colors = [
        'rgba(75, 192, 192, 0.2)',
        'rgba(255, 99, 132, 0.2)',
        'rgba(255, 159, 64, 0.6)',
        'rgba(153, 102, 255, 0.6)',
        'rgba(255, 205, 86, 0.6)',
        'rgba(54, 162, 235, 0.6)',
        'rgba(201, 203, 207, 0.6)'
    ];

    function getDataFromTable(tableId, label) {
        const table = document.getElementById(tableId);

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∫ labels
        const labels = [];
        for (let i = 1; i < table.rows[0].cells.length; i++) {
            labels.push(table.rows[0].cells[i].innerText.trim());
        }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∫ data
        const data = [];
        for (let i = 1; i < table.rows[1].cells.length; i++) {
            const cellValue = parseFloat(table.rows[1].cells[i].innerText.trim()); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ
            if (!isNaN(cellValue)) {
                data.push(cellValue);
            } else {
                console.error('One of the values is not correct:', table.rows[1].cells[i].innerText);
            }
        }

        return { labels, data };
    }



    document.addEventListener('DOMContentLoaded', () => {
        const ctx = document.getElementById('myChart').getContext('2d');

        function updateChart() {
            if (myChart) {
                myChart.destroy();
            }
            const canvas = document.getElementById('myChart');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);

            const yMinInput = document.getElementById('yMin');
            const yMaxInput = document.getElementById('yMax');
            const yMinValue = parseFloat(yMinInput.value);
            const yMaxValue = parseFloat(yMaxInput.value);

            myChart = new Chart(ctx, {
                data: {
                    labels: Object.keys(datasets).length > 0 ? Object.values(datasets)[0].labels : [],
                    datasets: Object.values(datasets).map((ds, index) => {
                        let stackGroupX = 'StackGroupX1';
                        let yAxisID = 'y';
                        let color_1 = ds.backgroundColor || 'rgba(0, 0, 0, 0.1)';
                        let order = 1;
                        let op = 45;
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä—É–ø–ø—ã –¥–ª—è —Å—Ç—ç–∫–∞ –∏ –æ—Å–∏ Y
                        if (ds.staks === 'Calculated Reference measurement') {
                            yAxisID = 'y2';
                            order = 2;
                            stackGroupX = 'StackGroupX1';
                        } else if (ds.staks === 'Calculated Sample measurement') {
                            yAxisID = 'y2';
                            order = 2;
                            stackGroupX = 'StackGroupX2';
                        } else if (ds.label === 'Reference measurement') {
                            color_1 = document.getElementById("colorPicker_reference_bar").value || "rgba(75, 192, 192, 0.4)";
                            op = document.getElementById("opacityInput_reference_bar").value/100;
                            
                            stackGroupX = 'StackGroupX1';
                        } else if (ds.label === 'Sample measurement') {
                            color_1 = document.getElementById("colorPicker_sample_bar").value || 'rgba(255, 99, 132, 0.3)';
                            stackGroupX = 'StackGroupX2';
                            op = document.getElementById("opacityInput_reference_bar").value/100;
                        }else if (ds.label === 'Comparison') {
                            color_1 = document.getElementById("colorPicker_comparison_bar").value || 'rgba(255, 99, 132, 0.3)';
                        } else if (ds.label === 'Reference measurment line') {
                            color_1 = "white";

                        }

                        if (ds.colorCode === 'yes') {
                            color_1 = ds.backgroundColor;
                        }

                        function setOpacity(color, alpha) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ rgba
                            if (color.startsWith("rgba")) {
                                // –ò–∑–º–µ–Ω—è–µ–º –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª
                                return color.replace(/rgba\((\d+), (\d+), (\d+), ([^)]+)\)/, `rgba($1, $2, $3, ${alpha})`);
                            }
                            // –ï—Å–ª–∏ —Ü–≤–µ—Ç –Ω–µ rgba, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–≥–æ –≤ rgba –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                            return convertHexToRgba(color, alpha);
                        }
                        
                        color_1 = setOpacity(color_1, op); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.7

                        function convertHexToRgba(hex, alpha) {
                            let r = parseInt(hex.slice(1, 3), 16);
                            let g = parseInt(hex.slice(3, 5), 16);
                            let b = parseInt(hex.slice(5, 7), 16);
                            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                        }

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
                        const chartType = ds.type || 'bar'; // 'line' –∏–ª–∏ 'bar'
                        return {
                            type: chartType,  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
                            label: ds.label,
                            data: ds.data,
                            backgroundColor: ds.backgroundColor || color_1,
                            borderColor: ds.borderColor || color_1,
                            borderWidth: chartType === 'line' ? 2 : 0,  // –®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏
                            stack: stackGroupX,
                            order: order,
                            yAxisID: yAxisID,
                            fill: chartType === 'line' ? false : true, // –ï—Å–ª–∏ —ç—Ç–æ –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫, –æ—Ç–∫–ª—é—á–∞–µ–º –∑–∞–ª–∏–≤–∫—É
                            spanGaps: true,  // –°–æ–µ–¥–∏–Ω—è–µ–º —Ç–æ—á–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏
                            showLine: chartType === 'line' ? true : false,  // –õ–∏–Ω–∏–∏ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
                            pointRadius: chartType === 'line' ? 0 : 0, // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏–Ω–∏–π
                            barPercentage: 0.9,      // –®–∏—Ä–∏–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã (–æ—Ç 0 –¥–æ 1, 0.9 - —à–∏—Ä–æ–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã)
                            categoryPercentage: 1.0, // –ü–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
                            maxBarThickness: 90,
                        
                        };
                    })
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    const value = tooltipItem.raw;
                                    return tooltipItem.dataset.label + ': ' + (value ? value.toExponential(4) : '–ù/–î');
                                }
                            }
                        },
                        legend: {
                            labels: {
                                position: 'right', // –õ–µ–≥–µ–Ω–¥–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–ø—Ä–∞–≤–∞
                                align: 'start', // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
                                    weight: 'bold' // –ñ–∏—Ä–Ω–æ—Å—Ç—å —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
                                },
                                color: 'black' // –¶–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–Ω—ã–π)
                            }
                        },
                        annotation: {
                            annotations: annotations
                        }
                    },
                    onClick: (evt, elements) => {
                        if (elements.length) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const index = element.index;
                            const value = myChart.data.datasets[datasetIndex].data[index];
                            const label = myChart.data.labels[index];
                            const values = myChart.data.datasets.map(ds => ds.data[index]);

                            //addAnnotation(label, values, index);
                            //updateChart();
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            barPercentage: 1.0,
                            categoryPercentage: 1.0,
                            min: xMin,
                            max: xMax,
                            title: {
                                display: true, // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Å–∏
                                text: 'Mass point', // –¢–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                color: 'black', // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                    weight: 'bold' // –ñ–∏—Ä–Ω–æ—Å—Ç—å —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                }
                            },
                            ticks: {
                                color: "black",
                                font: {
                                    size: 12, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ 14 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
                                    weight: "bold",

                                },
                            },

                        },
                        y: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            stacked: false,
                            min: yMinValue,
                            max: yMaxValue,
                            ticks: {
                                color: "black",
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ 14 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
                                    weight: "bold",

                                },
                                callback: function (value) {
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ª–æ–≥–∞—Ä–∏—Ñ–º –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10 —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º
                                    if (Number.isInteger(Math.log10(value))) {
                                        return Number(value.toString());
                                    }
                                    return null; // –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–µ—Ç–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                                }
                            },
                            title: {
                                display: true, // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Å–∏
                                text: 'Pressure in mbar', // –¢–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                color: 'black', // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                    weight: 'bold' // –ñ–∏—Ä–Ω–æ—Å—Ç—å —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                }
                            }
                        },
                        y2: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            stacked: true,
                            position: 'right',
                            min: yMinValue,
                            max: yMaxValue,
                            ticks: {
                                color: "black",
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ 14 (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
                                    weight: "bold",

                                },
                                callback: function (value) {
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ª–æ–≥–∞—Ä–∏—Ñ–º –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10 —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º
                                    if (Number.isInteger(Math.log10(value))) {
                                        return Number(value.toString());
                                    }
                                    return null; // –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–µ—Ç–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                                }
                            },
                            title: {
                                display: true, // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Å–∏
                                text: 'Pressure in mbar', // –¢–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                color: 'black', // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                font: {
                                    size: 14, // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                    weight: 'bold' // –ñ–∏—Ä–Ω–æ—Å—Ç—å —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                                }
                            }
                        }
                    }
                }
            });

            document.getElementById('clearHistograms').addEventListener('click', function() {
                // function to delete the class from the button 
                function removeClassFromButtons(className) {
                    const buttons = document.querySelectorAll(className);
                    buttons.forEach(button => {
                        button.classList.remove(className.substring(1)); // delete the . from the class
                    });
                }

                // delete all the classes from the buttons 
                removeClassFromButtons('.button-add-comparison');
                removeClassFromButtons('.button-add-data');
                removeClassFromButtons('.button-add-reference');

                // all button with the class name "addCalculatedHistogramsButton_"
                const squareButtons = document.querySelectorAll('button[class^="square-button-"]');
                squareButtons.forEach(button => {
                    const classes = Array.from(button.classList);
                    classes.forEach(className => {
                        if (className.startsWith('square-button-')) {
                            button.classList.remove(className); // delete the class 
                            button.classList.add('square-button-active')
                        }
                    });
                    button.style.backgroundColor = ''; // delete the color of the button
                });
                datasets = [];
                datasetList = {};
                updateChart();
            });

 

        }

     
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫
        function addAnnotation(label, values, index) {
            const existingAnnotation = annotations.find(ann => ann.value === label);
            if (!existingAnnotation) {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ —à–∞—Ö–º–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
                const yOffset = (annotations.length % 2 === 0) ? -150 : -110;
                const columnColor = colors[index % values.length];
                annotations.push({
                    type: 'line',
                    mode: 'vertical',
                    scaleID: 'x',
                    value: label,  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –ø–æ –æ—Å–∏ X
                    borderColor: 'rgba(0, 0, 0, 0.3)', 
                    borderWidth: 2,
                    borderDash: [5, 5], // –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è
                    label: {
                        content: `${label}:`,
                        enabled: true,
                        position: 'top',
                        yAdjust: yOffset, // –°–º–µ—â–µ–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                        backgroundColor: 'black',
                        borderColor: "black",  // –¶–≤–µ—Ç –∫–æ–ª–æ–Ω–∫–∏
                        borderWidth: 1,                 
                        font: {
                            size: 13,
                            family: 'Arial',
                            weight: 'bold',                        
                        }
                    }
                });

                annotations.push({
                    type: 'line',
                    mode: 'vertical',
                    scaleID: 'x',
                    value: label,  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –ø–æ –æ—Å–∏ X
                    label: {
                        content: `${values[0]} mbar`,
                        enabled: true,
                        position: 'top',
                        yAdjust: yOffset + 29, // –°–º–µ—â–µ–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                        backgroundColor: colors[0],
                        borderColor: "black",  // –¶–≤–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞
                        borderWidth: 1,
                        color: 'black',
                        font: {
                            size: 13,
                            family: 'Arial',
                            weight: 'bold',
                            color: 'black',
                        }
                    }
                });

                if (values.length > 1) {
                    annotations.push({
                        type: 'line',
                        mode: 'vertical',
                        scaleID: 'x',
                        value: label,  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –ø–æ –æ—Å–∏ X
                        label: {
                            content: `${values[1]} mbar`,
                            enabled: true,
                            position: 'top',
                            yAdjust: yOffset +59, // –°–º–µ—â–µ–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                            backgroundColor: colors[1],
                            borderColor: 'black',  // –¶–≤–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞
                            borderWidth: 1,
                            color: 'black',
                            font: {
                                size: 13,
                                family: 'Arial',
                                weight: 'bold',
                                color: 'black',
                            }
                        }
                    });
                }   
            }
        }   
        let buttonActive = false; // global flag for the state of the buttons 

        function addArrays(arr1, arr2) {
            return arr1.map((value, index) => value + arr2[index]);
        }

        function subtractArrays(arr1, arr2) {
            return arr1.map((value, index) => value - arr2[index]);
        }

        function addCalculatedHistograms(chem, selectedColor) {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á–∏ –¥–ª—è "–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö" –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
            const greyDatasets = Object.keys(datasets).filter(label => label.startsWith('Calculated '));
            const mainDatasets = Object.keys(datasets).filter(label => label.startsWith('Reference')||label.startsWith('Sample'));
            const oldGreyPeaks1 = datasets["Calculated Reference measurement"]?.peaks|| datasets["Calculated Sample measurement"]?.peaks|| []
            
            if (((oldGreyPeaks1.length === 1)) && oldGreyPeaks1[0] === chem) {
        // –ï—Å–ª–∏ –µ—Å—Ç—å "–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ" –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã, —É–¥–∞–ª—è–µ–º –∏—Ö
                greyDatasets.forEach(label => delete datasets[label]);
                annotations = annotations.filter(ann => !ann.value.startsWith('Calculated ')); // –£–¥–∞–ª—è–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è "–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö
                updateChart();
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏, —Ç–∞–∫ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã
                return 0;  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º 0, –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
            } else {
                if (mainDatasets.length === 0) {
                    return 0;
                }
        //
                const greyColor = 'rgba(128, 128, 128, 0.6)';  // color for the border 
                let added = false;  // flag for the 
                let info_peaks = []
                Object.keys(datasets).forEach((label) => {
                    if (!label.includes("Calculated") && !label.includes("Comparison") && !label.includes("line") &&  !label.includes("Vacuum test")) {
                        const oldData = datasets[label].data;
                        let oldGreyData = datasets[`Calculated ${label}`]?.data || Array(100).fill(0);
                        const oldGreyPeaks = datasets[`Calculated ${label}`]?.peaks|| [];
                        const newLabels = [];
                        const newData = [];
                        let newLABEL = label 
                        let newPeaks = oldGreyPeaks
                        let button_color = '#00BFFF';
                        const mks_peaks = {
                            "Hydrogen": [[2, 100], [1, 5]],
                            "Helium": [[4, 100]],
                            "Methane": [[16, 100], [15, 85], [14, 16], [13, 8], [1, 4]],
                            "Ammonia": [[17, 100], [16, 80], [15, 8], [14, 2]],
                            "Water": [[18, 100], [17, 25], [1, 6], [16, 2], [2, 2]],
                            "Neon": [[20, 100], [22, 9]],
                            "Acetylene": [[26, 100], [25, 20], [13, 5], [54, 5], [27, 3]],
                            "Diborane": [[26, 100], [27, 96], [24, 95], [25, 57], [11, 40]],
                            "VinylChloride": [[27, 100], [62, 88], [28, 36], [26, 33], [64, 27]],
                            "Nitrogen": [[28, 100], [14, 7], [29, 1]],
                            "CarbonMonoxide": [[28, 100], [16, 10], [12, 5], [29, 1]],
                            "Ethylene": [[28, 100], [26, 61], [27, 59], [25, 12], [14, 8]],
                            "Ethane": [[28, 100], [27, 33], [30, 26], [26, 23], [29, 21]],
                            "Air": [[28, 100], [32, 27], [14, 6], [16, 3], [40, 1]],
                            "Propane": [[29, 100], [28, 59], [27, 38], [44, 26], [43, 22]],
                            "Acetaldehyde": [[29, 100], [44, 45], [43, 27], [42, 9], [26, 9]],
                            "FormicAcid": [[29, 100], [46, 61], [45, 47], [17, 17], [28, 17]],
                            "NitricAcid": [[30, 100], [14, 7], [15, 2], [16, 1]],
                            "Silane": [[30, 100], [31, 80], [29, 31], [28, 28], [32, 8]],
                            "NitrogenDioxide": [[30, 100], [46, 37], [16, 22], [14, 9]],
                            "Methanol": [[31, 100], [32, 66], [29, 64], [28, 6], [18, 2]],
                            "EthyleneGlycol": [[31, 100], [33, 28], [15, 18], [29, 17], [43, 7]],
                            "Ethanol": [[31, 100], [45, 34], [27, 24], [29, 23], [46, 17]],
                            "Oxygen": [[32, 100], [16, 11]],
                            "HydrogenSulfide": [[34, 100], [32, 44], [33, 42], [36, 34], [35, 2]],
                            "Argon": [[40, 100], [20, 10]],
                            "Propene": [[41, 100], [39, 73], [42, 69], [27, 38], [40, 29]],
                            "Acetone": [[43, 100], [15, 67], [28, 17], [14, 15], [58, 15]],
                            "Butane": [[43, 100], [29, 44], [27, 37], [28, 32], [41, 27]],
                            "MethylEthylKetone": [[43, 100], [29, 25], [72, 16], [27, 16], [57, 6]],
                            "MPOil": [[43, 100], [41, 91], [57, 73], [55, 64], [71, 20]],
                            "Acetic Acid": [[43, 100], [45, 93], [60, 57], [29, 15], [42, 1]],
                            "TurbopumpOil": [[43, 100], [57, 88], [41, 76], [55, 73], [71, 52]],
                            "CarbonDioxide": [[44, 100], [28, 11], [16, 9], [12, 6], [45, 1]],
                            "NitrousOxide": [[44, 100], [30, 31], [14, 13], [28, 11], [16, 5]],
                            "IsopropylAlcohol": [[45, 100], [43, 16], [27, 16], [29, 10], [41, 7]],
                            "BoronTrifluoride": [[49, 100], [48, 28], [68, 5], [11, 5], [19, 3]],
                            "DPOilPPE": [[50, 100], [77, 89], [63, 29], [62, 27], [64, 21]],
                            "NitrogenTrifluoride": [[52, 100], [33, 40], [71, 31], [14, 9], [19, 8]],
                            "Disilane": [[60, 100], [58, 82], [57, 48], [62, 42], [61, 40]],
                            "Diphosphine": [[62, 100], [64, 70], [63, 59], [65, 26], [66, 2]],
                            "SulfurDioxide": [[64, 100], [48, 49], [32, 10], [66, 5], [16, 5]],
                            "Fomblin": [[69, 100], [20, 28], [16, 16], [31, 9], [97, 8]],
                            "Trifluoromethane": [[69, 100], [51, 91], [31, 49], [50, 42], [12, 4]],
                            "Tetrafluoromethane": [[69, 100], [50, 12], [19, 7], [31, 5]],
                            "Freon13": [[69, 100], [85, 15], [50, 14], [31, 9], [35, 7]],
                            "CarbonDisulfide": [[76, 100], [32, 21], [44, 17], [78, 9], [38, 6]],
                            "Arsine": [[76, 100], [78, 60], [77, 21], [75, 4]],
                            "Benzene": [[78, 100], [77, 22], [51, 18], [50, 17], [52, 15]],
                            "DPOilDC705": [[78, 100], [76, 83], [39, 73], [43, 59], [91, 32]],
                            "Krypton": [[84, 100], [86, 31], [83, 20], [82, 20], [80, 4]],
                            "Freon12": [[85, 100], [87, 32], [50, 16], [35, 12]],
                            "SiliconTetrafluoride": [[85, 100], [87, 12], [28, 12], [33, 10], [86, 5]],
                            "Toluene": [[91, 100], [92, 69], [65, 16], [51, 10], [63, 9]],
                            "Trichloroethylene": [[95, 100], [60, 65], [97, 64], [35, 40], [47, 26]],
                            "Freon11": [[101, 100], [103, 60], [35, 16], [66, 15], [47, 12]],
                            "Xenon": [[132, 100], [129, 98], [131, 79], [134, 39], [136, 33]]
                        };
            // settings of the new histograms 
                        const totalColumns = 100;  // the general number of the columns 
                        let newDataArray = new Array(totalColumns).fill(0);
                        if (mks_peaks[chem]) {
                            elementData = mks_peaks[chem];
                            const index_max = mks_peaks[chem][0][0]
                            const max_peak = oldData[index_max-1] || 0;
                            newLABEL = newLABEL + " + " + chem;  
                            newDataArray[index_max-1] = max_peak; 
                            button_color = selectedColor || '#00BFFF'; 

            // add the data on the corresponding place 
                            elementData.slice(1).forEach(([column, percentage]) => {
                                const colValue = max_peak || 0; 
                                if (totalColumns > column) newDataArray[column - 1] = colValue * (percentage / 100);
                            });
            // add the x-axes labels 
                            for (let i = 1; i <= totalColumns; i++) {
                                newLabels.push(i.toString());
                            }
                            
                        }           
                        if (!datasetList[label]?.includes(chem)) {
                            if (!Array.isArray(datasetList[label])) {
                                datasetList[label] = [];  // create the list of the dataset labels when it still does not exist 
                            }
                            datasetList[label].push(chem); // add the element to the datasetList 
                            buttonActive = 1;
                            // add the dataset of the element to the list with the data need to be plotted 
                            datasets[`Calculated ${label} ${chem}`] = {
                                labels: newLabels,
                                data: newDataArray,
                                label: `Peak for ${label}: ${chem}`,
                                staks: `Calculated ${label}`,
                                backgroundColor: button_color,
                                borderColor: greyColor.replace('0.6', '1'),
                                borderWidth: 0,
                                peaks: newPeaks,
                                colorCode: "yes",
                                type: "bar",
                                
                            };
                            info_peaks = datasets[`Calculated ${label}`]?.peaks;
                        } else {
                            const index = datasetList[label].indexOf(chem);
                            if (index !== -1) {
                                datasetList[label].splice(index, 1);  // delete the label and plot from the list of the labels 
                            }
                            delete datasets[`Calculated ${label} ${chem}`]; //delete the dataset from the list of the datasets 
                            buttonActive = 0;
                        }

                    }
                });

                updateChart(); // update the plot 

                return buttonActive ;  // return of index p (you will see it down)
            }
        }
        function handleButtonClick(button) {
            

            let p = 0; // initilization of the p - needed to control the color of the button, when it is active or not 
            let colorPicker, element;

            element = button.getAttribute('element');
            const colorPickerId = `colorPicker_${element}`; // name of the color plate used under this button 
            colorPicker = document.getElementById(colorPickerId).value; // take the chosen color from the color plate 
            p = addCalculatedHistograms(element, colorPicker); // –ü–µ—Ä–µ–¥–∞–µ–º —Ü–≤–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã

            // save the status of the button, based on the active or not active state (p index after addCalculatedHistograms)
            if (p===1) {
                button.classList.add(`square-button-${element}`); // adding the uniqe class for the button 
                button.style.backgroundColor = colorPicker; // changing the color on the chosen one 
            } else {
                button.classList.remove(`square-button-${element}`);
                button.style.backgroundColor = ''; // 
            }
        }

        //  Add event handlers for all buttons
        const buttons = document.querySelectorAll('[id^="addCalculatedHistogramsButton_"]'); // Find all the buttons

        buttons.forEach(button => {
            button.addEventListener('click', function() {
                handleButtonClick(this); // Call the general function with the current button
            });
        });

        
        let test = 0;
        function toggleDataFromTable(tableId, label, chartType) {
            if (datasets[label]) {
                // delete the data when it is alredy exist 
                delete datasets[label];
                delete datasetColors[label];
                test = 0;
            } else {
                const { labels, data } = getDataFromTable(tableId, label);  // get the data with the function getDataFromTable 

                // logic for the line plot  "Vacuum test 1/100"
                if (label === "Vacuum test 1/100") {
                    const data100 = new Array(data.length).fill(null);  // Create an array of empty data
                    const referenceValue = data[17];  // 18th element (index 17)
                    for (let i = 0; i < 45; i++) {
                        data100[i] = referenceValue / 100;  // Values for indexes 1 to 45
                    }
                    datasets[label] = {
                        data: data100,    // Data for Vacuum test 1/100
                        label: label,
                        borderColor: document.getElementById('colorPicker_vacuum_100').value,  // color of the line
                        showLine: true,    // type line for the scatter 
                        fill: false,       // Disable filling under the curve
                        type: 'line',
                        labels: labels,
                        backgroundColor: "white",
                    };
                }
                // logic for the line plot  "Vacuum test 1/1000"
                else if (label === "Vacuum test 1/1000") {
                    const data1000 = new Array(data.length).fill(null);  // Create an array of empty data
                    const referenceValue = data[17];  // 18th element (index 17)
                    for (let i = 44; i < data.length; i++) {
                        data1000[i] = referenceValue / 1000;  // Values for indexes 46 to 100
                    }
                    datasets[label] = {
                        data: data1000,    // –î–∞–Ω–Ω—ã–µ –¥–ª—è Vacuum test 1/1000
                        label: label,
                        borderColor: document.getElementById('colorPicker_vacuum_1000').value,  // color of the line
                        showLine: true,    // type line for the scatter 
                        fill: false,        // Disable filling under the curve
                        type: 'line',
                        labels: labels,
                        backgroundColor: "white",
                    };
                }
                // other cases 
                else {
                    if (chartType === 'scatter') {
                        let color_plot = '';
                        if (label == "Reference measurement line") {
                            color_plot = document.getElementById('colorPicker_reference_line').value;
                        }
                        if (label == "Sample measurement line") {
                            color_plot = document.getElementById('colorPicker_sample_line').value;
                        }
                        if (label == "Comparison line") {
                            color_plot = document.getElementById('colorPicker_comparison_line').value;
                        }

                        datasets[label] = {
                            data: data,         // data used for the line plot 
                            label: label,
                            borderColor: color_plot,   // Color of the line plot
                            showLine: true,     // Show line for scatter
                            fill: false,        //  Disable filling under the curve
                            type: 'line',
                            labels: labels,
                            backgroundColor: "white",
                        };
                    } else {
                        let color = "";
                        datasets[label] = { labels, data, label };
                        if (label == "Reference measurement bar") {
                            color = document.getElementById('colorPicker_reference_bar').value;
                        }
                        if (label == "Sample measurement bar") {
                            color = document.getElementById('colorPicker_sample_bar').value;
                        }
                        if (label == "Comparison bar") {
                            color = document.getElementById('colorPicker_comparison_bar').value;
                        }
                        datasetColors[label] = color;  // Assign color to other charts
                    }
                }

                test = 1;
            }

            updateChart();  
            return test;
        }


        document.getElementById('toggleChartFromTable5').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable5', 'Reference measurement',"bar");
            if (p===1) {
                this.classList.add('button-add-reference');
            } else {
                this.classList.remove('button-add-reference');
            }
        });

        document.getElementById('toggleChartFromTable6').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Sample measurement',"bar");
            if (p===1) {
                this.classList.add('button-add-data');
            } else {
                this.classList.remove('button-add-data');
            }
        });



        document.getElementById('toggleChartFromTable7').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable7', 'Comparison', "bar");
            if (p===1) {
                this.classList.add('button-add-comparison');
            } else {
                this.classList.remove('button-add-comparison');
            }
        });

        document.getElementById('toggleChartFromTable5-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable5', 'Reference measurement line','scatter');
            if (p===1) {
                this.classList.add('button-add-reference');
            } else {
                this.classList.remove('button-add-reference');
            }
        });

        document.getElementById('toggleChartFromTable6-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Sample measurement line','scatter');
            if (p===1) {
                this.classList.add('button-add-data');
            } else {
                this.classList.remove('button-add-data');
            }
        });

        document.getElementById('toggleChartFromTable7-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable7', 'Comparison line', 'scatter');
            if (p===1) {
                this.classList.add('button-add-comparison');
            } else {
                this.classList.remove('button-add-comparison');
            }
        });
        document.getElementById('vacuum_1000').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Vacuum test 1/1000', 'scatter');
            if (p===1) {
                this.classList.add('button-add-vacuum-1000');
            } else {
                this.classList.remove('button-add-vacuum-1000');
            }
        });
        document.getElementById('vacuum_100').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Vacuum test 1/100', 'scatter');
            if (p===1) {
                this.classList.add('button-add-vacuum-100');
            } else {
                this.classList.remove('button-add-vacuum-100');
            }
        });

        document.getElementById('yMin').addEventListener('input', function () {
            yMin = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('yMax').addEventListener('input', function () {
            yMax = parseFloat(this.value);
            updateChart();
        });
        document.getElementById('xMin').addEventListener('input', function () {
            xMin = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('xMax').addEventListener('input', function () {
            xMax = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('myChart').addEventListener('contextmenu', function(event) {
            event.preventDefault();  // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞

    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –∫–ª–∏–∫–Ω—É–ª–∏
            const elements = myChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
    
            if (elements.length) {
                const element = elements[0];
                const index = element.index;
                const label = myChart.data.labels[index];

        // –ò—â–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–µ—Ç–∫–µ (label)
                const annotationIndex = annotations.findIndex(ann => ann.value === label);
        
                if (annotationIndex !== -1) {
            // –£–¥–∞–ª—è–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é
                    annotations.splice(annotationIndex, 1);
                    updateChart();  // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
                }
            }
        });


    // Update the chart size when the window size changes
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('myChart');
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            if (myChart) {
                myChart.resize();
            }
        });

        updateChart(); // Update the chart on page load
    });


    function take_the_avarage(summaryTableId, dataTableId, tabNumber, refNumber) {
        const table_sum = document.getElementById(summaryTableId);
        const table_data = document.getElementById(dataTableId);
        const lastRowIndex = table_sum.rows.length - 1;

    // Check that there are rows in the tables
        if (lastRowIndex < 0) return; // If the table is empty, exit the function
   // Clone the last line
        const lastRow = table_sum.rows[lastRowIndex];
        const lastRow_data = table_data.rows[lastRowIndex];
        const rowCopy = lastRow.cloneNode(true);
        const rowCopy_data = lastRow_data.cloneNode(true);

        const ts = parseInt(refNumber) + 4; 

    // Search for tables in a new tab
        const table_sum_comp = document.getElementById('summaryTable' + ts);
        const table_data_comp = document.getElementById('dataTable' + ts);

    // Clear tables before adding new data
        table_sum_comp.innerHTML = '';
        table_data_comp.innerHTML = '';

    // If the tables are empty, add a header
        if (table_sum.rows.length > 0) {
        const headerRow = table_sum.rows[0].cloneNode(true);
        table_sum_comp.appendChild(headerRow);
        }
        if (table_data.rows.length > 0) {
            const headerRow_data = table_data.rows[0].cloneNode(true);
            table_data_comp.appendChild(headerRow_data);
        }

    // Add cloned rows to tables in a new tab
        table_sum_comp.appendChild(rowCopy);
        table_data_comp.appendChild(rowCopy_data);
    }

    function calculateDifference(referenceTable_sum, dataTable_sum,referenceTable_dat, dataTable_dat) {
        const refRows_sum = referenceTable_sum.rows;
        const dataRows_sum = dataTable_sum.rows;
        const refRows_dat = referenceTable_dat.rows;
        const dataRows_dat = dataTable_dat.rows;

  // Make sure that both tables have the same number of rows
        if (refRows_sum.length !== dataRows_sum.length && refRows_sum.length!==0 &&  dataRows_sum.length !==0) {
            console.warn("Tables have different number of rows.");
            return;
        }
        if (refRows_dat.length !== dataRows_dat.length && refRows_dat.length!==0 &&  dataRows_dat.length !==0) {
            console.warn("Tables have different number of rows.");
            return;
        }

        const comparisonTable_sum = document.getElementById('summaryTable7');
        comparisonTable_sum.innerHTML = ''; // Clear the comparison table
        const comparisonTable_dat = document.getElementById('dataTable7');
        comparisonTable_dat.innerHTML = ''; // Clear the comparison table

    // Add a header
        const summaryHeaderRow_sum = document.createElement('tr');
        comparisonTable_sum.innerHTML = '<th>Sum</th><th>Sum>44</th><th>Ratio</th>';
        comparisonTable_sum.appendChild(summaryHeaderRow_sum);

        const summaryHeaderRow_dat = document.createElement('tr');
        const firstCell = document.createElement('th');
        firstCell.textContent = '‚Ññ';
        summaryHeaderRow_dat.appendChild(firstCell);
        const numLabels = 100;
        for (let i = 1; i <= numLabels; i++) {
            const th = document.createElement('th');
            th.textContent = i; // Measurement numbers in normal format
            summaryHeaderRow_dat.appendChild(th);
        }
    

    // Calculate the difference
        for (let i = 1; i < refRows_sum.length; i++) { // start with 1 to skip the header
            const refRow = refRows_sum[i];
            const dataRow = dataRows_sum[i];
            const newRow = document.createElement('tr');

            for (let j = 0; j < refRow.cells.length-1; j++) {
                
                const refCell = parseFloat(refRow.cells[j].innerText) || 0;
                const dataCell = parseFloat(dataRow.cells[j].innerText) || 0;
                const diff = dataCell - refCell
            

                const newCell = document.createElement('td');
                newCell.innerText = diff.toExponential(4); 
                newRow.appendChild(newCell);
            }
            const ratio_cell = document.createElement('td');
            const newrow1 = parseFloat(newRow.cells[0].innerText) 
            const newrow2 = parseFloat(newRow.cells[1].innerText) 
            const ratio_end = newrow2/newrow1;
            ratio_cell.innerText = ratio_end.toExponential(4); 
            newRow.appendChild(ratio_cell);

            comparisonTable_sum.appendChild(newRow);
        }
    
        for (let i = 1; i < refRows_dat.length; i++) { // start with 1 to skip the header
            const refRow = refRows_dat[i];
            const dataRow = dataRows_dat[i];
            const newRow = document.createElement('tr');

        // Create the first cell with the text ‚ÄúAverage‚Äù
            const averageCell = document.createElement('td');
            averageCell.innerText = "Average";
            newRow.appendChild(averageCell);

            for (let j = 1; j < refRow.cells.length; j++) {
                const refCell = parseFloat(refRow.cells[j].innerText) || 0;
                const dataCell = parseFloat(dataRow.cells[j].innerText) || 0;
                const diff = dataCell - refCell;
                const newCell = document.createElement('td');
                newCell.innerText = diff.toExponential(4); // Format the difference
                newRow.appendChild(newCell);
            }

        comparisonTable_dat.appendChild(summaryHeaderRow_dat);
        comparisonTable_dat.appendChild(newRow);
        }
    
    }

    function updateComparisonTable(tabNumber, refNumber) {

        const referenceTable_sum = document.getElementById('summaryTable5');
        const referenceTable_dat = document.getElementById('dataTable5');
        const dataTable_sum = document.getElementById('summaryTable6');
        const dataTable_dat = document.getElementById('dataTable6');
        const comparisonTable_sum = document.getElementById('summaryTable7');
        const comparisonTable_dat = document.getElementById('dataTable7');
        calculateDifference(referenceTable_sum, dataTable_sum,referenceTable_dat, dataTable_dat)
    
    }
// Set event handler for ‚ÄúSend to comparison‚Äù buttons
    document.querySelectorAll('.sendToComparison').forEach(button => {
        button.addEventListener('click', function() {
            const tabNumber = this.getAttribute('data-tab'); // Get tab number
            const refNumber = this.getAttribute('data-ref'); // Get the reference number
            const summaryTableId = 'summaryTable' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;

        
            take_the_avarage(summaryTableId, dataTableId, tabNumber, refNumber);
            updateComparisonTable(tabNumber, refNumber);
            if (tabNumber==="3" || tabNumber==="4" ) {
                var table = document.getElementById('summaryTable6');
                var data_table = document.getElementById('dataTable6');
                var total = table.rows[1].cells[0].innerText;
                var total_44 = table.rows[1].cells[1].innerText;
                var total_ratio = table.rows[1].cells[2].innerText;
                var water_peak = data_table.rows[1].cells[18].innerText
                document.getElementById('sum_of_all_scan').innerText = total;
                document.getElementById('sum_of_44').innerText = total_44;
                document.getElementById('contribution_of_44').innerText = total_ratio;
                document.getElementById('water-peak').innerText = water_peak;
            }
            if (tabNumber==="1" || tabNumber==="2" ) {
                var table = document.getElementById('summaryTable5');
                var valueToInsert = table.rows[1].cells[0].innerText;
                document.getElementById('sum_of_all_scan_ref').innerText = valueToInsert;
            }
            var today = new Date();
            var formattedDate = today.getDate().toString().padStart(2, '0') + '.' + 
                    (today.getMonth() + 1).toString().padStart(2, '0') + '.' + 
                    today.getFullYear();
            document.getElementById('data-final-1').innerText = formattedDate;
            document.getElementById('data-final-2').innerText = formattedDate;
            document.getElementById('data-final-3').innerText = formattedDate;
            document.getElementById('data-final-4').innerText = formattedDate;
        });
    });


    function setupControls(tabNumber) {
        document.getElementById('startInterval' + tabNumber).addEventListener('change', () => {
            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
        });

        document.getElementById('endInterval' + tabNumber).addEventListener('change', () => {
            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
        });
    }

    
    // get the sample plot for the final document
    function downloadChart_sample() {
        const canvas = document.getElementById('myChart');
        const link = document.createElement('a');
        const dataURL = canvas.toDataURL('image/png'); // Get the Data URL of the chart
        const resultContainer_sample = document.getElementById('resultChartContainer_sample');
        const img = document.createElement('img');
        img.src = dataURL;
        img.style.maxWidth = '100%';
        resultContainer_sample.innerHTML = ''; 
        resultContainer_sample.appendChild(img); 

    }
    // get the reference plot for the final document
    function downloadChart_reference() {
        const canvas = document.getElementById('myChart');
        const link = document.createElement('a');
        const dataURL = canvas.toDataURL('image/png'); // Get the Data URL of the chart
        const resultContainer_reference = document.getElementById('resultChartContainer_reference');
        const img = document.createElement('img');
        img.src = dataURL;
        img.style.maxWidth = '100%';
        resultContainer_reference.innerHTML = ''; 
        resultContainer_reference.appendChild(img); 

    }
    // get the comparison plot for the final document
    function downloadChart_summary() {
        const canvas = document.getElementById('myChart');
        const link = document.createElement('a');
        const dataURL = canvas.toDataURL('image/png'); // Get the Data URL of the chart
        const resultContainer_summary = document.getElementById('resultChartContainer_summary');
        const img = document.createElement('img');
        img.src = dataURL;
        img.style.maxWidth = '100%';
        resultContainer_summary.innerHTML = ''; 
        resultContainer_summary.appendChild(img); 

    }

    document.getElementById('downloadBtn_refernce').addEventListener('click', downloadChart_reference);
    document.getElementById('downloadBtn_sample').addEventListener('click', downloadChart_sample);
    document.getElementById('downloadBtn_summary').addEventListener('click', downloadChart_summary);



    document.querySelectorAll('.last100').forEach(button => {
        button.addEventListener('click', function() {
            const tabNumber = this.getAttribute('data-tab'); // Get tab number 
            const startIntervalInput = document.getElementById('startInterval' + tabNumber);
            const endIntervalInput = document.getElementById('endInterval' + tabNumber);
            if (this.value === "all") {
                startIntervalInput.value = endIntervalInput.value - 100;
                this.value = "100"
                this.textContent = "All measurements"
                
            } else {
                startIntervalInput.value = 1;
                this.value = "all"
                this.textContent = "Last 100 measurements"
            }

            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
            
        });
    });




    function saveAsPDF() {
        // Get the contents of the items to be saved as a PDF
        var elementToPrint_1 = document.getElementById('end-file-1').outerHTML;
        var elementToPrint_2 = document.getElementById('end-file-2').outerHTML;
        var elementToPrint_3 = document.getElementById('end-file-3').outerHTML;
        
        //  Combine the contents of all three elements
        var combinedContent = elementToPrint_1 + elementToPrint_2 + elementToPrint_3;
        // Create a new window
        var printWindow = window.open('', '', 'width=800,height=600');
        
        // Copy all styles from the main document
        var styles = '';
        Array.from(document.styleSheets).forEach(styleSheet => {
            try {
                // If it is a CSS file (<link>), add it via <link> to the new window
                if (styleSheet.href) {
                    styles += `<link rel="stylesheet" href="${styleSheet.href}">`;
                } else {
                    // If it is a built-in style (<style>), copy its contents
                    Array.from(styleSheet.cssRules).forEach(rule => {
                        styles += `<style>${rule.cssText}</style>`;
                    });
                }
            } catch (e) {
                console.log("Style is not founded:", styleSheet.href);
            }
        });

        function updateCheckboxHTML(element) {
        // Find all checkboxes in the element
            var checkboxes = element.querySelectorAll('input[type="checkbox"]');
            
            // Update the HTML by adding a checked attribute if the checkbox is checked
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    checkbox.setAttribute('checked', 'checked');  // Add checked attribute to HTML
                } else {
                    checkbox.removeAttribute('checked'); // Remove the attribute if the checkbox is unchecked
                }
            });
        }

        var element_1 = document.getElementById('end-file-1');
        var element_2 = document.getElementById('end-file-2');
        var element_3 = document.getElementById('end-file-3');

        updateCheckboxHTML(element_1);
        updateCheckboxHTML(element_2);
        updateCheckboxHTML(element_3);

        var elementToPrint_1 = element_1.outerHTML;
        var elementToPrint_2 = element_2.outerHTML;
        var elementToPrint_3 = element_3.outerHTML;

        var combinedContent = elementToPrint_1 + elementToPrint_2 + elementToPrint_3;



        
        //  Add printable content to a new window
        printWindow.document.write('<html><head><title>Print</title>');
        printWindow.document.write(styles);  // –í—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
        printWindow.document.write('</head><body>');
        printWindow.document.write(combinedContent);
        printWindow.document.write('</body></html>');
        
        // Wait until the content is loaded, then call the print function
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        
    // Close the window after printing (this may not work automatically in Safari)
    }
    document.getElementById('saveButton').addEventListener('click', function() {
    // Creating an image in PNG format
        const link = document.createElement('a');
        link.href = myChart.toBase64Image();
        link.download = 'my_chart.png';  // –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        link.click();
    });

    // Initialize handlers for all tabs
    [1, 2, 3, 4].forEach(setupControls);

    // Show the first tab by default
    showTab(1);


            // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –∫ —Ñ—É–Ω–∫—Ü–∏–∏ drawChart
</script>

</body>
</html>
