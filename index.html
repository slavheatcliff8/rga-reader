<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGA Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="mqttws31.min.js"></script>
    



    <style>
        body {
                font-family: Arial, sans-serif;
                overflow: hidden; /* Отключает прокрутку страницы */
                position: fixed; /* Фиксирует страницу на месте */
                width: 100%; /* Устанавливает ширину на 100% экрана */
                height: 100%; /* Устанавливает высоту на 100% экрана */
        }

        #bar-line {
            display: flex;
            justify-content: space-between; /* Равномерное распределение левой и правой частей */
            margin-bottom: 20px;
            height: auto;
        }

        .left-buttons {
            display: flex;
            flex-direction: column; /* Две группы кнопок в две строки */
            gap: 3px; /* Отступ между строками кнопок */
            height: auto;
            border: 1px solid #241616;
            border-radius: 5px;
            padding: 4px;
        }

        
        .last100 {
                cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }

        .last100:active {
            transform: scale(0.95); 
            background-color: #d1d1d1; 
        }

        .button-group_main {
            display: flex;
            gap: 1px; /* Пространство между кнопками в строке */
            border: 1px solid #241616;
            border-radius: 5px;
        }
        .button-group {
            display: flex;
            gap: 1px; /* Пространство между кнопками в строке */

        }

        .center-controls {
            display: flex;
            height: 55px;
            width: 100%;
            margin-top: 30px;
            gap: 5px; /* Отступы между элементами */
        }

        .center-controls label {
            margin-right: 0px;
            margin-top: 15px;
            width: 50px;

        }
        .center-controls input {
            margin-right: 2px!important;
            margin-top: 10px;
            width: 50px;

        }

        #menu-1 {
            width: 50%; /* Ширина меню */
            height: 120px;
        }

        .tab-content {
                display: none;
        }

        .tab-content-6 {
                display: none;
                overflow-y:auto;

        }

        .image-container h2 {
                display: flex;
                align-items: center; 
                margin: 0; 
        }

        .image-container img {
                height: 70px; 
                margin-right: 10px; 
                vertical-align: middle; 
        }

        .image-container h2 span {
                display: inline-flex;
                align-items: center; 
        }

        .tab-button {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 15px;
        }

        .button-add-grey {
                cursor: pointer;
                padding: 10px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 13px;
                height: 50px;
                width: 150px;
        }
        .button-add-grey_visualisation {
                cursor: pointer;
                padding: 0px;
                margin-right: 0px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 16px;
                height: 50px;
                width: 66px;
        }
        .button-add-grey-crit {
            background-color: grey;
            cursor: not-allowed;
        }
        .button-add-green {
            cursor: pointer;
            padding: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1px solid #8d8989;
            border-radius: 5px;
            background-color: #f1f1f1;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            height: auto;
            width: 90%;
            display: flex;
            justify-content: flex-start; 
            align-items: center; 
            text-align: left; 
            background-color: rgb(61, 108, 151);
            cursor: pointer;
            color: white;
            overflow: auto;
        }

        .peaks_info {
            cursor: pointer;
            padding: 10px;
            margin-top: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 0px solid #8d8989;
            border-radius: 5px;
            background-color: #f1f1f1;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            height: auto;
            width: 95%;
            display: flex; 
            justify-content: flex-start; 
            text-align: left; 
            background-color: white;
            cursor: pointer;
            overflow: auto;
            display: flex;
            flex-direction: column; 
            align-items: left; 

        }


        .button-add-criterium {
            cursor: pointer;
            padding: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1px solid #8d8989;
            border-radius: 5px;
            background-color: #f1f1f1;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            height: auto;
            width: 450px;
            display: flex; 
            justify-content: flex-start; 
            align-items: center; 
            text-align: left; 
            background-color: white;
            cursor: pointer;
            overflow: auto;

        }

        .button-add-criterium-info {
            display: flex;
            flex-direction: column; 
            margin-top: 10px;
            margin-left: 20px;
            height: auto;
        }

        .button-add-criterium-data {
            display: flex; 
            flex-direction: column; 
            margin-top: 10px;
            margin-left: 20px;
            height: auto;
        }

        .button-add-criterium-info-small {
            margin-bottom: 10px;
            padding: 5px;
            border: 0px solid #000000;
            border-radius: 5px;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            width: 100%;
            height: auto;
            align-items: center; 
            display: flex;

        }

        .button-add-criterium-info-small-data {
            margin-bottom: 10px;
            padding: 5px;
            border: 2px solid #000000;
            border-radius: 5px;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            width: 100%;
            height: auto;
            align-items: center;
            display: flex; 

        }

        .button-add-criterium-info-name {
            border: 0px solid #000000;
            border-radius: 5px;
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            width: 100px;
            height: 10px;
            align-items: center;
            display: flex; 

        }

        .info-buttons {
            display: flex;
            flex-direction: column; 
            font-size: 19px; 
            font-weight: bold;
            margin: 0px; 
            width: 500px;
            color: #333; 
        }



        .sendToComparison {
            cursor: pointer;
            padding: 5px;
            margin-right: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f1f1f1;
            font-family: Helvetica, Helvetica;
            font-size: 12px;
            height: 30px;
            width: 150px;
    }
        .sendToComparison:active {
            transform: scale(0.95);
            background-color: #d1d1d1; 
        }

        .button-add-reference {
                cursor: pointer;


                border: 1px solid #0000006b;
                border-radius: 5px;
                background-color: #4bc0c033!important;
                font-family: Helvetica, Helvetica;
                font-size: 15px;
        }

        .button-add-data {
                cursor: pointer;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #ff638433!important;
                font-family: Helvetica, Helvetica;
                font-size: 15px;
        }
        
        
        .button-add-comparison {
                cursor: pointer;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #473737b0 !important;
                font-family: Helvetica, Helvetica;
                font-size: 15px;
                color:"white";
        }

        .tab-button.active {
                background-color: #f7caca;
        }

        .table-container {
                display: flex; 
                justify-content: flex-start;
                width: 95%;
                border: 0px solid #ddd;
                max-height: 600px; 
                margin: 20px auto;
                padding: 10px;
                overflow-x: auto;
                overflow-y: auto!important; 
        }
        #menu-2 {
                display: flex;
                justify-content: flex-start;
                width: 95%;
                height: 500px;
                overflow: auto;
                border: 0px solid #ddd;
                margin: 20px auto;
                margin-top: 50px;
                padding: 10px;
        }

        .table-container-comp {
                display: flex; 
                justify-content: flex-start;
                width: 95%;
                height: 100px;
                overflow: auto; 
                border: 0px solid #ddd;
                margin: 20px auto;
                padding: 10px;
        }

        .table-container table {
                border-collapse: collapse;
                margin-right: 20px; /* Отступ между таблицами */
        }

        .table-container-comp table {
                border-collapse: collapse;
                margin-right: 20px; /* Отступ между таблицами */
        }

        .table-container table:last-of-type {
                margin-right: 0; /* Убираем отступ у последней таблицы */
        }

        .table-container-comp table:last-of-type {
                margin-right: 0; /* Убираем отступ у последней таблицы */
        }

        table, th, td {
                width: 150px; /* Фиксированная ширина ячеек */
                height: 40px; /* Фиксированная высота ячеек */
                border: 1px solid;
                text-align: center;
                padding: 0;
                box-sizing: border-box;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
        }

        th {
                background-color: #f7caca;
                height: 40px;
        }

        .highlight {
                background-color: #ffffff;
        }

        .controls {
                margin-bottom: 20px;
        }

        .controls label {
                margin-right: 10px;
        }

        .summary-table {
                border-collapse: collapse;
        }

        .summary-table th, .summary-table td {
                border: 1px solid black;
                padding: 8px;
        }

        .summary-table th {
                background-color: #f7caca;
        }

        .data-table-container {
                display: flex;
        }

        .gray-row {
                background-color: #a7dfe6; /* Серый цвет */
                height: 40px; /* Высота строки */
        }

        thead th {
                position: sticky;
                top: 0;
                background-color: #f7caca; /* Цвет фона для заголовка, чтобы он выделялся */
                z-index: 1; /* Чтобы заголовок был поверх других элементов при прокрутке */
        }
        .сont{
            border: 1px solid black;
            width: 100%;
            height: auto;
            overflow: auto;
        }
        #parentContainer {
            position: relative;
            display: flex; /* Для расположения контейнеров по горизонтали */
            width: 1390px; /* Ширина контейнера на всю ширину родителя */
            height: 500px; /* Начальная высота контейнера */
            margin-top: 20px;
            margin-left: 5px;
            font-family: 'Helvetica', sans-serif; /* Используем шрифт Helvetica */
            border: 0px solid #ca4e4e; /* Линия вокруг контейнера для визуализации */
            overflow: auto; /* Скрытие содержимого, выходящего за пределы контейнера */
            box-sizing: border-box; /* Учитывать границы и отступы при расчете размеров */
        }

        #parentContainer_right {
            position: relative;
            display: flex; /* Для расположения контейнеров по горизонтали */
            width: 200px!; /* Ширина контейнера на всю ширину родителя */
            height: 460px; /* Начальная высота контейнера */
            margin-top: 20px;
            margin-left: 5px;
            font-family: 'Helvetica', sans-serif; /* Используем шрифт Helvetica */
            border: 0px solid #ca4e4e; /* Линия вокруг контейнера для визуализации */
            overflow: auto; /* Скрытие содержимого, выходящего за пределы контейнера */
            box-sizing: border-box; /* Учитывать границы и отступы при расчете размеров */
            display: flex;
            flex-direction: column;
        }
        .criteriumContainer_tittle {
            position: relative;
            width: 500px; /* Ширина контейнера на всю ширину родителя */
            height: 40px; /* Начальная высота контейнера */
            margin-top: 0px;
            margin-bottom: 10px;
            margin-left: 20px;
            font-family: 'Helvetica', sans-serif; /* Используем шрифт Helvetica */
            border: -px solid #0e0a0a; /* Линия вокруг контейнера для визуализации */
            box-sizing: border-box; /* Учитывать границы и отступы при расчете размеров */
            display: flex;
        }
        .criteriumContainer {
            position: relative;
            width: 500px; /* Ширина контейнера на всю ширину родителя */
            height: 200px; /* Начальная высота контейнера */
            margin-top: 0px;
            margin-left: 20px;
            font-family: 'Helvetica', sans-serif; /* Используем шрифт Helvetica */
            border: -px solid #0e0a0a; /* Линия вокруг контейнера для визуализации */
            overflow: auto; /* Скрытие содержимого, выходящего за пределы контейнера */
            box-sizing: border-box; /* Учитывать границы и отступы при расчете размеров */
        }
        
        #chartContainer {
            position: relative;
            width: 60%; /* Ширина контейнера на всю ширину родителя */
            height: 460px; /* Начальная высота контейнера */
            margin-top: 40px;
            margin-left: 5px;
            font-family: 'Helvetica', sans-serif; /* Используем шрифт Helvetica */
            border: 1px solid #ddd; /* Линия вокруг контейнера для визуализации */
            overflow: hidden; /* Скрытие содержимого, выходящего за пределы контейнера */
            resize: both; /* Разрешение растягивания контейнера */
            box-sizing: border-box; /* Учитывать границы и отступы при расчете размеров */
        }
        
        canvas {
            display: block;
            width: 100% !important;  /* Ширина холста в процентах от контейнера */
            height: 100% !important; /* Высота холста в процентах от контейнера */
        }
        .chart-title {
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .resize-handle {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 16px;
            height: 16px;
            background: #ddd;
            cursor: se-resize;
        }
        .square-button-active {
            width: auto; /* Ширина кнопки */
            min-width: 1.5cm;
            height: 1.5cm; /* Высота кнопки */
            background-color: #60656674; /* Голубой цвет */
            color: white; /* Цвет текста */
            border: none; /* Убираем бордер */
            border-radius: 5px; /* Скругляем углы (по желанию) */
            font-size: 19px; /* Размер шрифта */
            font-weight: bold; /* Жирный шрифт */
            cursor: pointer; /* Курсор при наведении */
            display: flex; /* Используем flexbox для центрирования текста */
            align-items: center; /* Вертикальное центрирование текста */
            justify-content: center; /* Горизонтальное центрирование текста */
            text-align: center; /* Выравнивание текста по центру */
            text-transform: none; /* Преобразуем текст в верхний регистр, если необходимо */
            display: inline-block; /* Размещаем кнопки в одну строку */
            margin-right: 10px; /* Расстояние между кнопками */
        }

        input[type="number"] {
            width: 50px; /* Устанавливаем ширину для всех полей с типом number */
            height: 20px; 
            text-align: center; /* Выравнивание текста по центру */
            justify-content: center; /* Горизонтальное центрирование текста */
        }
        input[type="peak"] {
            width: 70px; /* Устанавливаем ширину для всех полей с типом number */
            height: 30px; 
            margin-left: 10px;
            margin-top: 15px;
            text-align: center; /* Выравнивание текста по центру */
            justify-content: center; /* Горизонтальное центрирование текста */
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            font-size: 30px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
        }
        .pdf-table-container {
            display: flex; /* Для расположения контейнеров по горизонтали */
            flex-direction: column; /* Размещаем контейнеры вертикально */
            justify-content: flex-start;
            width: 230mm;
            height: 700px;
            overflow: auto; /* Добавляет прокрутку */
            border: 0px solid #ddd;
            padding: 10px;
        }

        .pdf-body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .pdf-container {
            width: 210mm; /* Ширина A4 */
            height: 297mm;
            background-color: #fff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column; /* Устанавливаем вертикальное направление */
            padding: 20px;
            box-sizing: border-box; /* Учитывает padding в размерах */
            margin-bottom: 20px; /* Отступ между контейнерами */
        }

        .pdf-logo {
            width: 29.6mm; /* Ширина A4 */
            height: 29.6mm; /* Высота A4 */
        }

        .pdf-logo-cont {
            height: auto; /* Автоматическая высота */
            align-items: center; /* Центрирование по вертикали */
            margin-bottom: 3px; /* Отступ снизу для логотипа */
        }
        .pdf-text-header-big {
            justify-content: center; /* Горизонтальное выравнивание по центру */
            text-align: center; /* Вертикальное выравнивание по центру */
            width: 100%; /* Ширина 100% контейнера */
            height: 145px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 28px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            padding-top: 41px; /* Убираем отступы, чтобы текст был по центру */
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 5px;
        }
        .pdf-text-name {
            width: 140px; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            box-sizing: border-box; /* Учитываем границы в размерах */

        }
        .pdf-text-info {
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 100%; /* Ширина 100% контейнера */
            height: 35px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px;
            padding: 0px;
        }
        .pdf-text-yes-no {
            width: 250px; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box; /* Учитываем границы в размерах */
        }


        .pdf-text-header-small {
            text-align: center; /* Центрируем текст */
            font-size: 20px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            padding: 10px 0; /* Отступ сверху и снизу */
        }

        .pdf-text-logo {
            text-align: center; /* Центрируем текст */
            font-size: 13px;
            font-weight: bold;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            margin-top: 3px; /* Отступ сверху для текста логотипа */
        }

        .pdf-header {
            display: flex; /* Flexbox для выравнивания логотипа и текста */
            justify-content: space-between; /* Распределение пространства между элементами */
            align-items: center; /* Центрирование по вертикали */
        }
        .pdf-info {
            display: flex; /* Flexbox для выравнивания логотипа и текста */
            justify-content: space-between; /* Распределение пространства между элементами */
            align-items: center; /* Центрирование по вертикали */
            margin-top: 15px;
        }
        
        .pdf-text-sample-name {
            font-size: 18px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
        }
        .pdf-text-plots-name {
            font-size: 18px;
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
        }
        .pdf-text-handover-date {
            font-size: 18px;
            align-items: left; 
            width: 210px; /* Ширина 100% контейнера */
            font-family: 'Arial', rgba(15, 23, 72, 1);
            font-weight: bold;
            margin-left: 150px;
            
        }
        .pdf-text-sample-data {
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 40.6mm; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px;
        }
        .pdf-text-sample-box {
            display: flex; /* Включаем Flexbox */
            width: 100%; /* Ширина 100% контейнера */
            height: 25px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            padding: 0px;
        }
        .pdf-text-measurement-details-box {
            display: flex; /* Включаем Flexbox */
            width: 100%; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 22px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            padding: 0px;
        }

        label {
            font-family: 'Arial', sans-serif;
            font-size: 14px;
            color: #333;
            margin-left: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group1 {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .checkbox-group2 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 90px;
            margin-right: 10px;
        }
        .checkbox-group3 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 182px;
            margin-right: 10px;
        }
        .pdf-text-checkbox {
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 380px; /* Ширина 100% контейнера */
            height: 35px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 40px;
            padding: 0px;
        } 
        .pdf-text-final-pressure {
            width: 220px; /* Ширина 100% контейнера */
            height: 35px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-right: 410px;
            padding: 0px;
        } 
        .pdf-text-final-remarks {
        
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 100%; /* Ширина 100% контейнера */
            height: 80px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 16px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px;
            padding: 0px;
        } 
        .checkbox-alfresco-1 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 0px;
            margin-right: 10px;
            
        }

        .checkbox-alfresco-2 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 60px;
            margin-right: 10px;
        }
        .checkbox-alfresco-3 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 50px;
            margin-right: 10px;
        }
        .checkbox-alfresco-4 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 170px;
            margin-right: 10px;
        }
        .checkbox-alfresco-5 {
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin-left: 148px;
            margin-right: 10px;
        }

        .pdf-plot {
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            width: 100%; /* Ширина 100% контейнера */
            height: 90mm; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px;
            padding: 0px;
        }
        .pdf-text-sample-plot {
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 100.6mm; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 3px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 50px;
        }
        .pdf-2-name-pressure{
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 53.6mm; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 10px;
            
        }
        .pdf-2-name-data{
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 53.6mm; /* Ширина 100% контейнера */
            height: 30px; /* Фиксированная высота */
            border: 2px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-right: 50px;
            margin-left: 10px;
            
        }
        .pdf-2-text-pressure {
            height: 30px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box; /* Учитываем границы в размерах */
        }
        .pdf-2-text-data {
            height: 30px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 15px;
            font-family: 'Arial', rgba(15, 23, 72, 1);;
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px;
        }
        .pdf-summary-big{
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 100%; /* Ширина 100% контейнера */
            height: 20px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 18px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-right: 50px;
            margin-left: 10px;
            
        }
        .pdf-summary-name{
            display: flex; /* Включаем Flexbox */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 400px; /* Ширина 100% контейнера */
            height: 20px; /* Фиксированная высота */
            border: 0px solid rgba(15, 23, 72, 1);
            font-size: 14px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 20px; 
        }
        .pdf-summary-date{
            display: flex; /* Включаем Flexbox */
            justify-content: center; /* Горизонтальное выравнивание по центру */
            align-items: center; /* Вертикальное выравнивание по центру */
            width: 100px; /* Ширина 100% контейнера */
            height: 20px; /* Фиксированная высота */
            border: 2px solid rgb(0, 0, 0);
            font-size: 14px;
            font-family: 'Arial', rgb(0, 0, 0);
            box-sizing: border-box; /* Учитываем границы в размерах */
            margin-left: 0px; 
        }

        .button-container {
            display: flex;
            max-width: 1400px; /* Ширина контейнера */
            overflow-x: auto; /* Включает вертикальную прокрутку */
            margin-top: 30px;
        }

        .element-wrapper {
            display: flex;
            flex-direction: column; /* Размещаем кнопку элемента и пикер цвета вертикально */
            align-items: center; /* Центрируем пикеры под кнопками */
           
        }

        input[type="color"] {
            cursor: pointer;
            width: 100%;
            height: 20px;
            border: none;
            margin-right: 10px;
        }

        @media print {
            /* Сбрасываем стили для печати */
            body {
                position: static;  
                margin: 0;
                padding: 0;
                scale: 95%; /* Можно изменить значение для подгона контента */
            }

            /* Скрываем все элементы, кроме тех, что нужно напечатать */

            /* Делаем видимыми только нужные элементы и их содержимое */
            #end-file-1, #end-file-2, #end-file-3 {
                visibility: visible;
                position: static;
                page-break-before: auto; /* Автоматическое разбиение страниц */
                page-break-after: auto;
            }

            /* Останавливаем разрывы страниц внутри таблиц и изображений */
            table, img {
                page-break-inside: avoid;
            }

            /* Стиль для каждого блока */
            #end-file-1, #end-file-2, #end-file-3 {
                width: 100%; /* Можно зафиксировать ширину, например, 1000px для большей консистентности */
                margin-bottom: 5px; /* Разделяем элементы */
                padding: 0px;
                box-shadow: none; /* Убираем тени */
                border: none; /* Убираем границы */
            }

            /* Устанавливаем точные отступы для каждого блока */
            #end-file-1 {
                margin-top: 0;
                
            }

            #end-file-2 {
                margin-top: 0px; /* Добавляем отступы вместо отрицательных значений */
            }

            #end-file-3 {
                margin-top: 0px; /* Добавляем отступы вместо отрицательных значений */
            }
            
            /* Устанавливаем фиксированные размеры, чтобы одинаково рендерилось в разных браузерах */
            @page {
                size: A4; /* Или можно использовать размер, подходящий вашему контенту, например "letter" */
                margin: 10mm; /* Поля страницы, чтобы контент не обрезался */
            }
        }
        .popup {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 140px;
        }

        .popup input {
            width: 35px;
        }

        .popup button {
            margin-top: 5px;
            margin-left: 10px;
        }

        .mqtt-connection {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }

        .choise-of-the-quelle {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle2 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle3 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        
        .choise-of-the-quelle4 {
            cursor: pointer;
                padding: 5px;
                margin-right: 5px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: #f1f1f1;
                font-family: Helvetica, Helvetica;
                font-size: 12px;
                height: 30px;
                width: 150px;
        }
        .left-buttons h4 {
            font-size: 19px; /* Размер шрифта заголовка */
            font-weight: bold; /* Полужирный текст */
            margin: 0px; /* Отступ между заголовком и кнопками */
            color: #333; /* Цвет заголовка */
        }
    </style>
</head>
<body>

    <div class="image-container">
        <h2><img src="Logo_XFEL_positiv_.jpg" alt="Logo"> <span>RGA Data Manager</span></h2>
    </div>
    <br><br>
    <div>
        <button class="tab-button active" onclick="showTab(1)"><b>Reference raw</b></button>
        <button class="tab-button" onclick="showTab(2)"><b>Reference w/o noise</b></button>
        <button class="tab-button" onclick="showTab(3)"><b>Sample raw</b></button>
        <button class="tab-button" onclick="showTab(4)"><b>Sample w/o noise</b></button>
        <button class="tab-button" onclick="showTab(5)"><b>Comparison</b></button>
        <button class="tab-button" onclick="showTab(6)"><b>Visualization</b></button>
        <button class="tab-button" onclick="showTab(7)"><b>Result sheet</b></button>
    </div>

    <div id="tab1" class="tab-content">
        <h3>Reference raw</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput1" data-tab-number="1" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="1" data-tab-number = "1" value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval1" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval1" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="1" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="1" data-ref="1" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable1" class="summary-table">
            </table>
            <table id="dataTable1">
            </table>
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <h3>Ref noise removal</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput2" data-tab-number="2" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="2" data-tab-number = "2" value = "Karabo">Karabo</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval2" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval2" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="2" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="2" data-ref="1" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable2" class="summary-table">
            </table>
            <table id="dataTable2">
            </table>
        </div>
    </div>

    <div id="tab3" class="tab-content">
        <h3>Sample data</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput3" data-tab-number="3" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="3" data-tab-number = "3" value = "Karabo">Karabo</button>
            <button class="mqtt-connection" data-tab="3" >MQTT</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval3" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval3" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="3" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="3" data-ref="2" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable3" class="summary-table">

            </table>
            <table id="dataTable3">

            </table>
        </div>
    </div>

    <div id="tab4" class="tab-content">
        <h3>Data noise removal</h3>
        <div class="controls">
            <label><b>File:   </b></label>  
            <input type="file" id="fileInput4" data-tab-number="4" />
        </div>
        <div class="controls">
            <label><b>Quelle:</b></label> 
            <button class="choise-of-the-quelle" data-tab="4" data-tab-number = "4" value = "Karabo">Karabo</button>
            <button class="mqtt-connection" data-tab="4" data-tab-number = "4">MQTT</button>

            <label><b>Used measurements</b> From:              
                <input type="number" id="startInterval4" value="1" min="1">
            </label>
            <label>To:
                <input type="number" id="endInterval4" value="100" min="1">
            </label>
            <button class="last100" style="margin-left: 10px;" data-tab="4" value ="all">Last 100 measurements</button>
            <button class="sendToComparison" data-tab="4" data-ref="2" style="margin-left: 10px;">Send to comparison</button>
        </div>
        <div class="table-container">
            <table id="summaryTable4" class="summary-table">
 
            </table>
            <table id="dataTable4">

            </table>
        </div>
    </div>


    <div id="tab5" class="tab-content">
        <h3>Comparison</h3>
        <label><b>Reference average</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable5" class="summary-table">

                </table>
                <table id="dataTable5">

                </table>
            </div>
        </div>
        <br><br>

        <label><b>Data average</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable6" class="summary-table">

                </table>
                <table id="dataTable6">

                </table>
            </div>
        </div>
        <label><b>Comparison</b></label>
        <div class="controls">
            <div class="table-container-comp">
                <table id="summaryTable7" class="summary-table">

                </table>
                <table id="dataTable7">

                </table>
            </div>
        </div>
    </div>
    <div id="tab6" class="tab-content">
        <h3>Data Visualization</h3>
        
        <div id="menu-1">
            <div id="bar-line">
                <div class="left-buttons" style = "margin-right:10px;">
                    <h4>Reference: </h4>
                    <div class="button-group" >
                        <input type="color" id="colorPicker_reference_bar" style = "width: 15px; height: 50px; margin-right: 0px;" value="#4BC0C0">
                        <button id="toggleChartFromTable5" class="button-add-grey_visualisation" >Bar</button>
                        <div id="opacityPopup_reference" class="popup" style="display: none;">
                            <label for="opacityInput_reference_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_reference_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_reference">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_reference_line" style = "width: 15px; height: 50px; margin-right: 0px;" value="#4BC0C0">
                        <button id="toggleChartFromTable5-2" class="button-add-grey_visualisation"  style = " margin-right:10px;">Line</b></button>
                    </div>
                    <div class="button-group">
                        <input type="color" id="colorPicker_vacuum_reference" style = "width: 15px; height: 50px; margin-right: 0px;" value="#ff4400">
                        <button id="vacuum_test_reference" class="button-add-grey" source = "reference">Vacuum Criterium</button>
                    </div>    
                </div>
                <div class="left-buttons" style = "margin-right:10px;">
                    <h4>Sample: </h4>
                    <div class="button-group">
                        <input type="color" id="colorPicker_sample_bar" style = "width: 15px; height: 50px;  margin-right:0px;" value="#ff6384">
                        <button id="toggleChartFromTable6" class="button-add-grey_visualisation">Bar</b></button>
                        <div id="opacityPopup_sample" class="popup" style="display: none;">
                            <label for="opacityInput_sample_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_sample_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_sample">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_sample_line" style = "width: 15px; height: 50px;margin-right:0px;" value="#FF6384">
                        <button id="toggleChartFromTable6-2" class="button-add-grey_visualisation" style = " margin-right:10px;">Line</b></button>
                    </div>
                    <div class="button-group">
                        <input type="color" id="colorPicker_vacuum_sample" style = "width: 15px; height: 50px; margin-right: 0px;" value="#ff4400">
                        <button id="vacuum_test_sample" class="button-add-grey" source = "sample">Vacuum Criterium</button>
                    </div>
                </div>  
                <div class="left-buttons" style = "margin-right:10px;">
                    <h4>Comparison: </h4>
                    <div class="button-group">
                        <input type="color" id="colorPicker_comparison_bar" style = "width: 15px; height: 50px;  margin-right:0px; border-width: 0px;" value="#464544">
                        <button id="toggleChartFromTable7" class="button-add-grey_visualisation">Bar</button>
                        <div id="opacityPopup_comparison" class="popup" style="display: none;">
                            <label for="opacityInput_comarison_bar">Opacity (0 - 100%):</label>
                            <input type="number" id="opacityInput_comparison_bar" min="0" max="100" step="5" value="40">
                            <button id="applyOpacity_comparison">Apply</button>
                        </div>
                        <input type="color" id="colorPicker_comparison_line" style = "width: 15px; height: 50px; margin-right: 0px;" value="#464544">
                        <button id="toggleChartFromTable7-2" class="button-add-grey_visualisation"style = " margin-right:10px;" >Line</b></button>
                    </div>
                    <div class="button-group">
                        <input type="color" id="colorPicker_vacuum_comparison" style = "width: 15px; height: 50px; margin-right: 0px;" value="#ff4400">
                        <button id="vacuum_test_comparison" class="button-add-grey" source = "comparison">Vacuum Criterium</button>
                    </div>
                </div>
                <div class="left-buttons" style = "margin-right:10px;" >
                    <h4>Scale: </h4>
                    <div class="button-group">
                        <button class="button-add-grey"><label for="yMin">Y Min:</label>
                        <input type="number" id="yMin" step="0.1" value="1e-15"></button>
                        <button class="button-add-grey"><label for="xMin">X Min:</label>
                        <input type="number" id="xMin" step="1" value="1"></button>
                    </div>
                
                    <div class="button-group">
                        <button class="button-add-grey"><label for="yMax">Y Max:</label>
                        <input type="number" id="yMax" step="0.1" value="1e-6"></button>
                        <button class="button-add-grey"><label for="xMax">X Max:</label>
                        <input type="number" id="xMax" step="1" value="100"></button>                       
                    </div>
                </div>
                <div class="left-buttons" >
                    <h4>Send to the report sheet: </h4>
                    <div class="button-group">
                        <button id="downloadBtn_refernce" class="button-add-grey"><b>Reference plot</b></button>
                        <button id="downloadBtn_sample" class="button-add-grey"><b>Sample plot</b></button>
                        <button id="downloadBtn_summary" class="button-add-grey"><b>Summary plot</b></button>
                    </div>
                    <div class="button-group">
                        <button id="saveButton" class="button-add-grey">Save the plot</button>
                        <button id="clearHistograms" class="button-add-grey">Clear the plot</button>
                        
                    </div>
                        
                </div>
            </div>
        </div>
        <div class="button-container">
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Water" class="square-button-active" element="Water">H<sub>2</sub>O</button>
                <input type="color" id="colorPicker_Water" value="#00BFFF">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonDioxide" class="square-button-active" element="CarbonDioxide">CO<sub>2</sub></button>
                <input type="color" id="colorPicker_CarbonDioxide" value="#ff4400">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Oxygen" class="square-button-active" element="Oxygen">O<sub>2</sub></button>
                <input type="color" id="colorPicker_Oxygen" value="#41cb8f">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Nitrogen" class="square-button-active" element="Nitrogen">N<sub>2</sub></button>
                <input type="color" id="colorPicker_Nitrogen" value="#010055">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Air" class="square-button-active" element="Air">Air</button>
                <input type="color" id="colorPicker_Air" value="#5bd1ff">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_TurbopumpOil" class="square-button-active" element="TurbopumpOil">TPump Oil</button>
                <input type="color" id="colorPicker_TurbopumpOil" value="#d5ff1d">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Trifluoromethane" class="square-button-active" element="Trifluoromethane">CHF<sub>3</sub></button>
                <input type="color" id="colorPicker_Trifluoromethane" value="#43f343">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Tetrafluoromethane" class="square-button-active" element="Tetrafluoromethane">CF<sub>4</sub></button>
                <input type="color" id="colorPicker_Tetrafluoromethane" value="#dc43f3">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Hydrogen" class="square-button-active" element="Hydrogen">H</button>
                <input type="color" id="colorPicker_Hydrogen" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Helium" class="square-button-active" element="Helium">He</button>
                <input type="color" id="colorPicker_Helium" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Methane" class="square-button-active" element="Methane">CH<sub>4</sub></button>
                <input type="color" id="colorPicker_Methane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ammonia" class="square-button-active" element="Ammonia">NH<sub>3</sub></button>
                <input type="color" id="colorPicker_Ammonia" value="#959296">
            </div>    
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Neon" class="square-button-active" element="Neon">Ne</button>
                <input type="color" id="colorPicker_Neon" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetylene" class="square-button-active" element="Acetylene">C<sub>2</sub>H<sub>2</sub></button>
                <input type="color" id="colorPicker_Acetylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Diborane" class="square-button-active" element="Diborane">B<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Diborane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_VinylChloride" class="square-button-active" element="VinylChloride">C<sub>2</sub>H<sub>3</sub>Cl</button>
                <input type="color" id="colorPicker_VinylChloride" value="#959296">
            </div>            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonMonoxide" class="square-button-active" element="CarbonMonoxide">CO</button>
                <input type="color" id="colorPicker_CarbonMonoxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethylene" class="square-button-active" element="Ethylene">C<sub>2</sub>H<sub>4</sub></button>
                <input type="color" id="colorPicker_Ethylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethane" class="square-button-active" element="Ethane">C<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Ethane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Propane" class="square-button-active" element="Propane">C<sub>3</sub>H<sub>8</sub></button>
                <input type="color" id="colorPicker_Propane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetaldehyde" class="square-button-active" element="Acetaldehyde">CH<sub>3</sub>CHO</button>
                <input type="color" id="colorPicker_Acetaldehyde" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_FormicAcid" class="square-button-active" element="FormicAcid">HCOOH</button>
                <input type="color" id="colorPicker_FormicAcid" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitricAcid" class="square-button-active" element="NitricAcid">HNO<sub>3</sub></button>
                <input type="color" id="colorPicker_NitricAcid" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Silane" class="square-button-active" element="Silane">SiH<sub>4</sub></button>
                <input type="color" id="colorPicker_Silane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrogenDioxide" class="square-button-active" element="NitrogenDioxide">NO<sub>2</sub></button>
                <input type="color" id="colorPicker_NitrogenDioxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Methanol" class="square-button-active" element="Methanol">CH<sub>3</sub>OH</button>
                <input type="color" id="colorPicker_Methanol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_EthyleneGlycol" class="square-button-active" element="EthyleneGlycol">C<sub>2</sub>H<sub>6</sub>O<sub>2</sub></button>
                <input type="color" id="colorPicker_EthyleneGlycol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Ethanol" class="square-button-active" element="Ethanol">C<sub>2</sub>H<sub>5</sub>OH</button>
                <input type="color" id="colorPicker_Ethanol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_HydrogenSulfide" class="square-button-active" element="HydrogenSulfide">H<sub>2</sub>S</button>
                <input type="color" id="colorPicker_HydrogenSulfide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Argon" class="square-button-active" element="Argon">Ar</button>
                <input type="color" id="colorPicker_Argon" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Propene" class="square-button-active" element="Propene">C<sub>3</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Propene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Acetone" class="square-button-active" element="Acetone">CH<sub>3</sub>COCH<sub>3</sub></button>
                <input type="color" id="colorPicker_Acetone" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Butane" class="square-button-active" element="Butane">C<sub>4</sub>H<sub>10</sub></button>
                <input type="color" id="colorPicker_Butane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_MethylEthylKetone" class="square-button-active" element="MethylEthylKetone">C<sub>4</sub>H<sub>8</sub>O</button>
                <input type="color" id="colorPicker_MethylEthylKetone" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_MPOil" class="square-button-active" element="MPOil">MPOil</button>
                <input type="color" id="colorPicker_MPOil" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_AceticAcid" class="square-button-active" element="AceticAcid">CH<sub>3</sub>COOH</button>
                <input type="color" id="colorPicker_AceticAcid" value="#959296">
            </div>           
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrousOxide" class="square-button-active" element="NitrousOxide">N<sub>2</sub>O</button>
                <input type="color" id="colorPicker_NitrousOxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_IsopropylAlcohol" class="square-button-active" element="IsopropylAlcohol">C<sub>3</sub>H<sub>8</sub>O</button>
                <input type="color" id="colorPicker_IsopropylAlcohol" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_BoronTrifluoride" class="square-button-active" element="BoronTrifluoride">BF<sub>3</sub></button>
                <input type="color" id="colorPicker_BoronTrifluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_DPOilPPE" class="square-button-active" element="DPOilPPE">DPOilPPE</button>
                <input type="color" id="colorPicker_DPOilPPE" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_NitrogenTrifluoride" class="square-button-active" element="NitrogenTrifluoride">NF<sub>3</sub></button>
                <input type="color" id="colorPicker_NitrogenTrifluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Disilane" class="square-button-active" element="Disilane">Si<sub>2</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Disilane" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Diphosphine" class="square-button-active" element="Diphosphine">P<sub>2</sub>H<sub>4</sub></button>
                <input type="color" id="colorPicker_Diphosphine" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_SulfurDioxide" class="square-button-active" element="SulfurDioxide">SO<sub>2</sub></button>
                <input type="color" id="colorPicker_SulfurDioxide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Fomblin" class="square-button-active" element="Fomblin">Fomblin</button>
                <input type="color" id="colorPicker_Fomblin" value="#959296">
            </div>
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon13" class="square-button-active" element="Freon13">Freon 13</button>
                <input type="color" id="colorPicker_Freon13" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_CarbonDisulfide" class="square-button-active" element="CarbonDisulfide">CS<sub>2</sub></button>
                <input type="color" id="colorPicker_CarbonDisulfide" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Arsine" class="square-button-active" element="Arsine">AsH<sub>3</sub></button>
                <input type="color" id="colorPicker_Arsine" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Benzene" class="square-button-active" element="Benzene">C<sub>6</sub>H<sub>6</sub></button>
                <input type="color" id="colorPicker_Benzene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_DPOilDC705" class="square-button-active" element="DPOilDC705">DPOilDC705</button>
                <input type="color" id="colorPicker_DPOilDC705" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Krypton" class="square-button-active" element="Krypton">Kr</button>
                <input type="color" id="colorPicker_Krypton" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon12" class="square-button-active" element="Freon12">Freon 12</button>
                <input type="color" id="colorPicker_Freon12" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_SiliconTetrafluoride" class="square-button-active" element="SiliconTetrafluoride">SiF<sub>4</sub></button>
                <input type="color" id="colorPicker_SiliconTetrafluoride" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Toluene" class="square-button-active" element="Toluene">C<sub>7</sub>H<sub>8</sub></button>
                <input type="color" id="colorPicker_Toluene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Trichloroethylene" class="square-button-active" element="Trichloroethylene">C<sub>2</sub>HCl<sub>3</sub></button>
                <input type="color" id="colorPicker_Trichloroethylene" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Freon11" class="square-button-active" element="Freon11">Freon 11</button>
                <input type="color" id="colorPicker_Freon11" value="#959296">
            </div>
            
            <div class="element-wrapper">
                <button id="addCalculatedHistogramsButton_Xenon" class="square-button-active" element="Xenon">Xe</button>
                <input type="color" id="colorPicker_Xenon" value="#959296">
            </div>    
        </div>   
        <div id="parentContainer">
            <div id="chartContainer">
                <canvas id="myChart"></canvas>

            </div>
            <div class="parentContainer_right">
                <div class="criteriumContainer_tittle">
                    <h3>Peaks Info</h3>
                    <input type="peak" id="Peak Number" step="1" value="0"></button>  
                </div>
                <div class="criteriumContainer">
                    <div class="info-buttons" style="margin-right:10px;">
                        
                        <div class="peaks_info" id = "">  
                              
                        </div>
                    </div>
                </div> 
                <div class="criteriumContainer_tittle"><h3>Vacuum criteriums</h3></div>
                <div class="criteriumContainer">
                    <div class="info-buttons" style="margin-right:10px;">
                        <div class="button-add-criterium" id = "use_criterium_reference">
                            <div class="button-add-criterium-info-name" >Reference</div>
                            <div class="button-add-criterium-info">
                                <div class="button-add-criterium-info-small" >Water peak (mbar)</div>
                                <div class="button-add-criterium-info-small" >Sum all (mbar)</div>
                                <div class="button-add-criterium-info-small" >Sum > 44 (mbar)</div>
                                <div class="button-add-criterium-info-small" >Ratio</div>
                            </div>
                            <div class="button-add-criterium-data">
                                <div class="button-add-criterium-info-small-data" id = "wp_ref">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "fp_ref">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "sum44_ref">No data</div>
                                <div class="button-add-criterium-info-small-data"id = "rat_ref">No data</div>
                            </div>
                        </div>

                        <div class="button-add-criterium"  id = "use_criterium_sample">
                            <div class="button-add-criterium-info-name">Sample</div>
                            <div class="button-add-criterium-info">
                                <div class="button-add-criterium-info-small">Water peak (mbar)</div>
                                <div class="button-add-criterium-info-small" >Sum all (mbar)</div>
                                <div class="button-add-criterium-info-small" >Sum > 44 (mbar)</div>
                                <div class="button-add-criterium-info-small" >Ratio</div>
                            </div>
                            <div class="button-add-criterium-data">
                                <div class="button-add-criterium-info-small-data"  id = "wp_samp">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "fp_samp">No data</div>
                                <div class="button-add-criterium-info-small-data"id = "sum44_samp" >No data</div>
                                <div class="button-add-criterium-info-small-data"id = "rat_samp" >No data</div>
                            </div>
                        </div>

                        <div class="button-add-criterium" id = "use_criterium_comparison">
                            <div class="button-add-criterium-info-name">Comparison</div>
                            <div class="button-add-criterium-info">
                                <div class="button-add-criterium-info-small" >Water peak (mbar)</div>
                                <div class="button-add-criterium-info-small">Sum all (mbar)</div>
                                <div class="button-add-criterium-info-small">Sum > 44 (mbar)</div>
                                <div class="button-add-criterium-info-small">Ratio</div>
                            </div>

                            <div class="button-add-criterium-data">
                                <div class="button-add-criterium-info-small-data" id = "wp_comp">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "fp_comp">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "sum44_comp">No data</div>
                                <div class="button-add-criterium-info-small-data" id = "rat_comp">No data</div>
                            </div>

                        </div>
                    </div>
                </div>  
            </div>

        </div>
    </div>

    <div id="tab7" class="tab-content">
        <h3>Result sheet</h3>
        <div class="controls">
            <button onclick="saveAsPDF()" class="button-add-grey"><b>Save as pdf / Print</b></button>
        </div>
        <div class="pdf-table-container"  >
            <div class="pdf-container" id = "end-file-1">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="Пример картинки">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">SAMPLE</div>
                        <div class="pdf-text-handover-date" contenteditable="false">HANDOVER DATE:</div>
                        <div class="pdf-text-sample-data" contenteditable="true" id="data-final-3"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Designation
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Requested by:
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Treatment:
                    </div>
                    <div class="pdf-text-info" contenteditable="true">
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">MEASUREMENT DETAILS</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Method:
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="vac_standard" class="checkbox-group1">VAC Standard Lab Qualification</label>
                        <label><input type="checkbox" id="baked" class="checkbox-group2">Baked </label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="Untriggered"class="checkbox-group1">VAC Untriggered</label>
                        <label><input type="checkbox" id="Unbaked" class="checkbox-group3">Unbaked</label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="EasyView"class="checkbox-group1">EasyView</label>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">
                    </div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label><input type="checkbox" id="Other"class="checkbox-group1">Other (specify):</label>
                        <div class="pdf-text-checkbox" contenteditable="true"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Final pressure:</div>
                    <div class="pdf-text-final-pressure" contenteditable="true" id="final_pressure" style="margin-left: 35px; text-align: center;"></div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Redmine Ticket №:</div>
                    <div class="pdf-text-final-pressure" contenteditable="true" id="tickets number" style="margin-left: 35px; text-align: center;"></div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Measurement date &<br>Alfresco file name:</div>
                    <div class="pdf-text-info" contenteditable="true" style = "margin-right: 140px;"></div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Remarks:</div>
                    <div class="pdf-text-final-remarks" contenteditable="true"></div>
                </div>

                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-sample-name" contenteditable="false">CHECKOUT</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Alfresco Upload:</div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label style="color: red; font-size: 18px; font-weight: bold; width:125px;"><input type="checkbox" style="margin-left:0px;" id="Raw"class="checkbox-alfresco-1">Raw data</label>
                        <label style="color: red; font-size: 18px; font-weight: bold;width:245px;"><input type="checkbox" style="margin-left:0px;" id="Screenshots"class="checkbox-alfresco-2">Sample documentation</label>
                        <label style="color: red; font-size: 18px; font-weight: bold;width:140px;"><input type="checkbox" style="margin-left:0px;" id="Reference"class="checkbox-alfresco-3">Result sheet</label>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-yes-no" contenteditable="false">Cleared for UHV vessels<br>according specifications:</div>
                    <div class="pdf-text-measurement-details-box" contenteditable="false">
                        <label style="color: red; font-size: 22px;">
                            <input type="checkbox" id="yes" class="checkbox-alfresco-4" style="margin-left:0px;">
                            <b>YES</b>
                        </label>
                        <label style="color: red; font-size: 22px;">
                            <input type="checkbox" id="no" class="checkbox-alfresco-5"style="margin-left:43px;">
                            <b>NO</b>
                        </label>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false">Commenced by:</div>
                    <div class="pdf-text-info" contenteditable="true">Frederik Meyn</div>

                </div>
                
            </div>
            <div class="pdf-container" id = "end-file-2">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="Пример картинки">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Reference Measurement</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_reference" style="width: 100%;">
                        </div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" id="data-final-1"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false">Final pressure:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" id="final_pressure_reference"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Sample Measurement</div>
                        <div class="pdf-text-sample-plot" contenteditable="true"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_sample" style="width: 100%;"></div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" id="data-final-2"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false">Final pressure:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" id="final_pressure_sample"></div>
                    </div>
                </div>
        
            </div>
            <div class="pdf-container" id = "end-file-3">
                <div class="pdf-header">
                    <div class="pdf-logo-cont">
                        <img class="pdf-logo" src="Logo_XFEL_positiv_.jpg" alt="Пример картинки">
                        <div class="pdf-text-logo">VACUUM GROUP</div>
                    </div>
                    <div class="pdf-text-header-big" contenteditable="true">
                        Residual Gas Analysis Results
                        <br>
                        <span class="pdf-text-header-small" contenteditable="true">for RGA qualifications in the vacuum lab test chamber</span>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-text-plots-name" contenteditable="false">Summary</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-plot" contenteditable="false">
                        <div id="resultChartContainer_summary" style="width: 100%;"></div>
                    </div>

                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Water peak (mbar):</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water-peak"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">All masses < 45 are below 1/100 of water (mbar):</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water_1">yes</div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">All other masses are below 1/1000 of water (mbar)</div>
                        <div class="pdf-summary-date" contenteditable="true" id="water_2">yes</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Sum of all scanned masses (mbar):</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "sum_of_all_scan"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Sum of masses > 44 (mbar):</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "sum_of_44"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false">Contribution of masses > 44 to total:</div>
                        <div class="pdf-summary-date" contenteditable="true" id = "contribution_of_44"></div>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false"></div>
                    <div class="pdf-summary-big" contenteditable="false">
                        <div class="pdf-summary-name" contenteditable="false" style="color: red; font-size: 14px; font-weight: bold;">Cleared for XFEL UHV systems:</div>
                        <div class="pdf-summary-date" contenteditable="true">yes*</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info">
                    <div class="pdf-text-name" contenteditable="false" style="margin-left: 60px;"></div>
                    <div class="pdf-text-sample-box" contenteditable="false">
                        <div class="pdf-2-text-data" contenteditable="false" style="padding-top: 20px; ">Date:</div>
                        <div class="pdf-2-name-data" contenteditable="true" style="margin-top: 15px; " id="data-final-4"></div>
                        <div class="pdf-2-text-pressure" contenteditable="false" style="padding-top: 15px; ">Signature:</div>
                        <div class="pdf-2-name-pressure" contenteditable="true" style="height: 50px; width: 170px;">F. Meyn</div>
                    </div>
                </div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
                <div class="pdf-info"></div>
        
            </div>
        </div>
    </div>



<script>
    let data1 = [];
    let data3 = [];
    let filestatus = []

    const mks_peaks = {
        "Hydrogen": [[2, 100], [1, 5]],
        "Helium": [[4, 100]],
        "Methane": [[16, 100], [15, 85], [14, 16], [13, 8], [1, 4]],
        "Ammonia": [[17, 100], [16, 80], [15, 8], [14, 2]],
        "Water": [[18, 100], [17, 25], [1, 6], [16, 2], [2, 2]],
        "Neon": [[20, 100], [22, 9]],
        "Acetylene": [[26, 100], [25, 20], [13, 5], [54, 5], [27, 3]],
        "Diborane": [[26, 100], [27, 96], [24, 95], [25, 57], [11, 40]],
        "VinylChloride": [[27, 100], [62, 88], [28, 36], [26, 33], [64, 27]],
        "Nitrogen": [[28, 100], [14, 7], [29, 1]],
        "CarbonMonoxide": [[28, 100], [16, 10], [12, 5], [29, 1]],
        "Ethylene": [[28, 100], [26, 61], [27, 59], [25, 12], [14, 8]],
        "Ethane": [[28, 100], [27, 33], [30, 26], [26, 23], [29, 21]],
        "Air": [[28, 100], [32, 27], [14, 6], [16, 3], [40, 1]],
        "Propane": [[29, 100], [28, 59], [27, 38], [44, 26], [43, 22]],
        "Acetaldehyde": [[29, 100], [44, 45], [43, 27], [42, 9], [26, 9]],
        "FormicAcid": [[29, 100], [46, 61], [45, 47], [17, 17], [28, 17]],
        "NitricAcid": [[30, 100], [14, 7], [15, 2], [16, 1]],
        "Silane": [[30, 100], [31, 80], [29, 31], [28, 28], [32, 8]],
        "NitrogenDioxide": [[30, 100], [46, 37], [16, 22], [14, 9]],
        "Methanol": [[31, 100], [32, 66], [29, 64], [28, 6], [18, 2]],
        "EthyleneGlycol": [[31, 100], [33, 28], [15, 18], [29, 17], [43, 7]],
        "Ethanol": [[31, 100], [45, 34], [27, 24], [29, 23], [46, 17]],
        "Oxygen": [[32, 100], [16, 11]],
        "HydrogenSulfide": [[34, 100], [32, 44], [33, 42], [36, 34], [35, 2]],
        "Argon": [[40, 100], [20, 10]],
        "Propene": [[41, 100], [39, 73], [42, 69], [27, 38], [40, 29]],
        "Acetone": [[43, 100], [15, 67], [28, 17], [14, 15], [58, 15]],
        "Butane": [[43, 100], [29, 44], [27, 37], [28, 32], [41, 27]],
        "MethylEthylKetone": [[43, 100], [29, 25], [72, 16], [27, 16], [57, 6]],
        "MPOil": [[43, 100], [41, 91], [57, 73], [55, 64], [71, 20]],
        "Acetic Acid": [[43, 100], [45, 93], [60, 57], [29, 15], [42, 1]],
        "TurbopumpOil": [[43, 100], [57, 88], [41, 76], [55, 73], [71, 52]],
        "CarbonDioxide": [[44, 100], [28, 11], [16, 9], [12, 6], [45, 1]],
        "NitrousOxide": [[44, 100], [30, 31], [14, 13], [28, 11], [16, 5]],
        "IsopropylAlcohol": [[45, 100], [43, 16], [27, 16], [29, 10], [41, 7]],
        "BoronTrifluoride": [[49, 100], [48, 28], [68, 5], [11, 5], [19, 3]],
        "DPOilPPE": [[50, 100], [77, 89], [63, 29], [62, 27], [64, 21]],
        "NitrogenTrifluoride": [[52, 100], [33, 40], [71, 31], [14, 9], [19, 8]],
        "Disilane": [[60, 100], [58, 82], [57, 48], [62, 42], [61, 40]],
        "Diphosphine": [[62, 100], [64, 70], [63, 59], [65, 26], [66, 2]],
        "SulfurDioxide": [[64, 100], [48, 49], [32, 10], [66, 5], [16, 5]],
        "Fomblin": [[69, 100], [20, 28], [16, 16], [31, 9], [97, 8]],
        "Trifluoromethane": [[69, 100], [51, 91], [31, 49], [50, 42], [12, 4]],
        "Tetrafluoromethane": [[69, 100], [50, 12], [19, 7], [31, 5]],
        "Freon13": [[69, 100], [85, 15], [50, 14], [31, 9], [35, 7]],
        "CarbonDisulfide": [[76, 100], [32, 21], [44, 17], [78, 9], [38, 6]],
        "Arsine": [[76, 100], [78, 60], [77, 21], [75, 4]],
        "Benzene": [[78, 100], [77, 22], [51, 18], [50, 17], [52, 15]],
        "DPOilDC705": [[78, 100], [76, 83], [39, 73], [43, 59], [91, 32]],
        "Krypton": [[84, 100], [86, 31], [83, 20], [82, 20], [80, 4]],
        "Freon12": [[85, 100], [87, 32], [50, 16], [35, 12]],
        "SiliconTetrafluoride": [[85, 100], [87, 12], [28, 12], [33, 10], [86, 5]],
        "Toluene": [[91, 100], [92, 69], [65, 16], [51, 10], [63, 9]],
        "Trichloroethylene": [[95, 100], [60, 65], [97, 64], [35, 40], [47, 26]],
        "Freon11": [[101, 100], [103, 60], [35, 16], [66, 15], [47, 12]],
        "Xenon": [[132, 100], [129, 98], [131, 79], [134, 39], [136, 33]]
    };
    
    function showTab(tabNumber) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
        
        document.getElementById('tab' + tabNumber).style.display = 'block';
        document.querySelector('.tab-button:nth-of-type(' + tabNumber + ')').classList.add('active');
        
        const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
        if (document.getElementById('fileInput' + tabNumber).files[0]) {
            if (type_file.getAttribute('value') === "Karabo") {
                processFile2(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
            } else if (type_file.getAttribute('value') === "Software") {

                processFile1(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
            } else if (type_file.getAttribute('value') === "MQTT") {

                processMqttData(tabNumber);
            }
        }
    }
    document.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', function(event) {
            const tabNumber = event.target.getAttribute('data-tab-number'); 
            const file = event.target.files[0];
            if (file) {
                filestatus.push("changed" + tabNumber);
                const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
                console.log(type_file.getAttribute('value'))

                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
                } else if (type_file.getAttribute('value') === "Software") {

                    processFile1(document.getElementById('fileInput' + tabNumber).files[0], 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
                } else if (type_file.getAttribute('value') === "MQTT") {

                    processMqttData(tabNumber);
                }
            }
        });
    });

    function initializeButtons() {
        // Получаем все кнопки с классом 'choise-of-the-quelle'
        const buttons = document.querySelectorAll('.choise-of-the-quelle');

        buttons.forEach((button) => {
            let currentState = 'Software'; // Переменная для отслеживания состояния кнопки

            button.addEventListener('click', (event) => {
                // Получаем номер вкладки из атрибута кнопки
                const tabNumber = button.getAttribute('data-tab-number');

                // Выбираем соответствующий input для файла
                const inputFile = document.querySelector(`input[type="file"][data-tab-number="${tabNumber}"]`);
                const file = inputFile ? inputFile.files[0] : null; // Получаем файл, если он есть

                // Логика в зависимости от состояния кнопки
                if (currentState === 'Karabo') {
                    button.value = 'Software';
                    button.textContent = 'Software';
                    if (file) {
                        processFile1(file, `dataTable${tabNumber}`, `summaryTable${tabNumber}`, tabNumber, filestatus);
                    }
                    currentState = 'Software'; // Переключаем состояние
                } else if (currentState === 'Software') {
                    button.value = 'MQTT';
                    button.textContent = 'MQTT';
                    // Здесь добавим логику для работы с MQTT
                    processMqttData(tabNumber)
                    currentState = 'MQTT'; // Переключаем состояние

                } else if (currentState === 'MQTT') {
                    button.value = 'Karabo';
                    button.textContent = 'Karabo';
                    if (file) {
                        processFile2(file, `dataTable${tabNumber}`, `summaryTable${tabNumber}`, tabNumber, filestatus);
                    }
                    currentState = 'Karabo'; // Переключаем состояние
                }
            });
        });
    }

    document.addEventListener('DOMContentLoaded', initializeButtons);

    function processFile2(file, dataTableId, summaryTableId, tabNumber, filestatus) {
        if (!file) {
            alert('Choose the file');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            const dataTable = document.getElementById(dataTableId);
            const summaryTable = document.getElementById(summaryTableId);
            dataTable.innerHTML = '';
            summaryTable.innerHTML = '';

            const numLabels = 100; 

      
            const dataHeaderRow = document.createElement('tr'); 
            const dataFirstCell = document.createElement('th');
            dataFirstCell.textContent = 'Index';
            dataHeaderRow.appendChild(dataFirstCell);
            for (let i = 1; i <= numLabels; i++) {
                const th = document.createElement('th');
                th.textContent = i; 
                dataHeaderRow.appendChild(th);
            }
            dataTable.appendChild(dataHeaderRow);

            const summaryHeaderRow = document.createElement('tr');
            summaryHeaderRow.innerHTML = '<th>Sum</th><th>Sum>44</th><th>Ratio</th>';
            summaryTable.appendChild(summaryHeaderRow);
            const data = [];
            let previousRow = Array(numLabels + 1).fill(0);

            lines.forEach((line, index) => {
                if (index === 0) return; 
                const values = line.trim().split(/,/);
                if (values.length < 2) return;

                const row = [index]; 
                for (let i = 2; i < values.length; i++) {
                    let cellValue = values[i].trim(); 
                    let value;

                    if (cellValue === 'Skipped') {
                        value = previousRow[i] || 0; 
                    } else {
                        value = parseFloat(cellValue.replace(',', '.'));
                        value = isNaN(value) ? 0 : value; 
                    }
                    row.push(value);
                }

                previousRow = row.slice(); 
                data.push(row);
            });

         
            if (tabNumber === 1) {
                data1 = data;
            } else if (tabNumber === 3) {
                data3 = data;
            }

           
            if (tabNumber === 2 || tabNumber === 4) {
                data.forEach(row => {
                    for (let i = 1; i < row.length; i++) {
                        if (row[i] < 0) {
                            row[i] = 0;
                        }
                    }
                });
            }
            console.log (filestatus)
            displayData(dataTableId, data, tabNumber, filestatus);
            updateSummaryTable(summaryTableId, data, tabNumber);
            updateAverages(dataTableId, data, tabNumber);
        };

        reader.readAsText(file);
    }

    function processMqttData(tabNumber) {
        const clientID = "mqtt_js_" + parseInt(Math.random() * 100000, 10);
        const mqttClient = new Paho.MQTT.Client("131.169.140.96", 9001, "/mqtt", "clientId-" + Math.random());


        mqttClient.onConnect = function() {
            console.log('Connected to MQTT broker');
            mqttClient.subscribe("test/rga", {qos: 0}); // Example topic
        };

        mqttClient.onMessageArrived = function(message) {

            let data;
            try {
                // Выполняем как JS-выражение (небезопасно в публичных системах, но годится в тестах)
                data = eval(message.payloadString);
            } catch (err) {
                console.error('❌ Failed to evaluate message:', err);
                return;
            }

            if (Array.isArray(data)) {
                processFile_mqtt(data, 'dataTable' + tabNumber, 'summaryTable' + tabNumber, tabNumber);
            } else {
                console.error('❌ Received MQTT message is not a valid array:', data);
            }
        };

        mqttClient.connect({onSuccess: mqttClient.onConnect});
    }


    function processFile_mqtt(dataArray, dataTableId, summaryTableId, tabNumber) {
        const dataTable = document.getElementById(dataTableId);
        const summaryTable = document.getElementById(summaryTableId);
        dataTable.innerHTML = '';
        summaryTable.innerHTML = '';

        const numColumns = dataArray.length;
        console.log (dataArray)
        // Заголовок таблицы данных
        const headerRow = document.createElement('tr');
        const indexHeader = document.createElement('th');
        indexHeader.textContent = '№';
        headerRow.appendChild(indexHeader);

        for (let i = 1; i <= numColumns; i++) {
            const th = document.createElement('th');
            th.textContent = i;
            headerRow.appendChild(th);
        }
        dataTable.appendChild(headerRow);

        // Заголовок таблицы сводки
        const summaryHeader = document.createElement('tr');
        summaryHeader.innerHTML = '<th>Sum</th><th>Sum > 44</th><th>Ratio</th>';
        summaryTable.appendChild(summaryHeader);

        // Заполнение одной строки данных
        const rowElement = document.createElement('tr');
        const indexCell = document.createElement('td');
        indexCell.textContent = '1';
        rowElement.appendChild(indexCell);

        dataArray.forEach((value) => {
            const td = document.createElement('td');
            td.textContent = parseFloat(value.toFixed(4));
            rowElement.appendChild(td);
        });

        dataTable.appendChild(rowElement);

        // Создаём структуру данных как двумерный массив (как в processFile1)
        const structuredData = [[1, ...dataArray]];
        console.log (structuredData)
        // Обновление таблиц
        displayData(dataTableId, structuredData, tabNumber, null);
        updateSummaryTable(summaryTableId, structuredData, tabNumber);
        updateAverages(dataTableId, structuredData, tabNumber);
    }
    function processFile1(file, dataTableId, summaryTableId, tabNumber, filestatus) {
        if (!file) {
            alert('Choose the file');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            const dataTable = document.getElementById(dataTableId);
            const summaryTable = document.getElementById(summaryTableId);
            dataTable.innerHTML = '';
            summaryTable.innerHTML = '';

            const numLabels = 100; 

         
            const dataHeaderRow = document.createElement('tr');
            const dataFirstCell = document.createElement('th');
            dataFirstCell.textContent = '№';
            dataHeaderRow.appendChild(dataFirstCell);

            for (let i = 1; i <= numLabels; i++) {
                const th = document.createElement('th');
                th.textContent = i; 
                dataHeaderRow.appendChild(th);
            }
            dataTable.appendChild(dataHeaderRow);

            const summaryHeaderRow = document.createElement('tr');
            summaryHeaderRow.innerHTML = '<th>Sum</th><th>Sum>44</th><th>Ratio</th>';
            summaryTable.appendChild(summaryHeaderRow);

            const data = [];
            let previousRow = Array(numLabels + 1).fill(0);

    
            lines.forEach((line) => {
                const values = line.trim().split(/\s+/);
                if (values.length <= numLabels) return; 
                const measurementNumber = parseInt(values[0], 10);
                const row = [measurementNumber];

                for (let i = 1; i <= numLabels; i++) {
                    const cellValue = values[i];
                    let value;
                    if (cellValue === 'Skipped') {
                        value = previousRow[i];
                    } else {
                        value = parseFloat(cellValue.replace(',', '.'));
                        value = isNaN(value) ? 0 : value; 
                    }
                    row.push(value);
                }

                previousRow = row.slice(); 
                data.push(row);
            });


            if (tabNumber === 1) {
                data1 = data;
            } else if (tabNumber === 3) {
                data3 = data;
            }

            if (tabNumber === 2 || tabNumber === 4) {
                data.forEach(row => {
                    for (let i = 1; i < row.length; i++) {
                        if (row[i] < 0) {
                            row[i] = 0;
                        }
                    }
                });
            }

            displayData(dataTableId, data, tabNumber, filestatus);
            updateSummaryTable(summaryTableId, data, tabNumber);
            updateAverages(dataTableId, data, tabNumber);
        };

        reader.readAsText(file);
    }

    function displayData(tableId, data, tabNumber,filestatus) {

        let startInterval = 0;
        let endInterval = 100;
        if (!Array.isArray(filestatus)) {
            filestatus = []; 
        }
        if (filestatus.includes("changed" + tabNumber))  {
            startInterval = data[0][0];
            document.getElementById('startInterval' + tabNumber).value = data[0][0];

            endInterval = data[data.length - 1][0]; 
            document.getElementById('endInterval' + tabNumber).value = endInterval; 


            filestatus = filestatus.filter(item => item !== "changed" + tabNumber);
            

        }
        else {
            startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
            endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);
        }

        const table = document.getElementById(tableId);
        table.innerHTML = '';

        const numLabels = 100; 

    
        const headerRow = document.createElement('tr');
        const firstCell = document.createElement('th');
        firstCell.textContent = '№';
        headerRow.appendChild(firstCell);

        for (let i = 1; i <= numLabels; i++) {
            const th = document.createElement('th');
            th.textContent = i;
            headerRow.appendChild(th);
        }
        table.appendChild(headerRow);

        data.forEach(row => {
            const measurementNumber = row[0];
            if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                const tr = document.createElement('tr');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    td.textContent = index === 0 ? cell : cell.toExponential(4); 
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            }
        });

        updateAverages(tableId, data, tabNumber);
    }

    function updateSummaryTable(summaryTableId, data, tabNumber) {
        const summaryTable = document.getElementById(summaryTableId);
        const startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
        const endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);


        const filteredData = data.filter(row => row[0] >= startInterval && row[0] <= endInterval);

        filteredData.forEach(row => {
            const tr = document.createElement('tr');
        
            const sum = row.slice(1).reduce((acc, val) => acc + val, 0);
            const sumGreaterThan44 = row.slice(45).reduce((acc, val) => acc + val, 0);
            const ratio = sum > 0 ? sumGreaterThan44 / sum : 0;

            const sumTd = document.createElement('td');
            sumTd.textContent = sum.toExponential(4);
            tr.appendChild(sumTd);

            const sumGreaterThan44Td = document.createElement('td');
            sumGreaterThan44Td.textContent = sumGreaterThan44.toExponential(4); 
            tr.appendChild(sumGreaterThan44Td);

            const ratioTd = document.createElement('td');
            ratioTd.textContent = ratio.toExponential(4); 
            tr.appendChild(ratioTd);

            summaryTable.appendChild(tr);
        });

        const avgRow = document.createElement('tr');
        avgRow.classList.add('gray-row'); 

        let sumSum = 0, sumSumGreaterThan44 = 0, sumRatio = 0;
        let count = filteredData.length;

        filteredData.forEach(row => {
            const sum = row.slice(1).reduce((acc, val) => acc + val, 0);
            const sumGreaterThan44 = row.slice(45).reduce((acc, val) => acc + val, 0);
            const ratio = sum > 0 ? sumGreaterThan44 / sum : 0;

            sumSum += sum;
            sumSumGreaterThan44 += sumGreaterThan44;
            sumRatio += ratio;
        });

        const avgSum = count > 0 ? sumSum / count : 0;
        const avgSumGreaterThan44 = count > 0 ? sumSumGreaterThan44 / count : 0;
        const avgRatio = count > 0 ? sumRatio / count : 0;

        const avgSumTd = document.createElement('td');
        avgSumTd.textContent = avgSum.toExponential(4);
        avgRow.appendChild(avgSumTd);

        const avgSumGreaterThan44Td = document.createElement('td');
        avgSumGreaterThan44Td.textContent = avgSumGreaterThan44.toExponential(4);
        avgRow.appendChild(avgSumGreaterThan44Td);

        const avgRatioTd = document.createElement('td');
        avgRatioTd.textContent = avgRatio.toExponential(4);
        avgRow.appendChild(avgRatioTd);

        summaryTable.appendChild(avgRow);
    }

    function updateAverages(tableId, data, tabNumber) {
        const numLabels = 100;
        const startInterval = parseInt(document.getElementById('startInterval' + tabNumber).value, 10);
        const endInterval = parseInt(document.getElementById('endInterval' + tabNumber).value, 10);

        const table = document.getElementById(tableId);

        document.querySelectorAll(`#${tableId} .compare-row`).forEach(row => row.remove());

        let avgRow = document.querySelector(`#${tableId} .average-row`);
        if (!avgRow) {
            avgRow = document.createElement('tr');
            avgRow.classList.add('average-row', 'gray-row');
            table.appendChild(avgRow);
        } else {
            avgRow.innerHTML = ''; 
        }

    
        const avgFirstCell = document.createElement('td');
        avgFirstCell.textContent = 'Average';
        avgRow.appendChild(avgFirstCell);

        const averages = [];
        for (let i = 1; i <= numLabels; i++) {
            let sum = 0, count = 0;
            data.forEach(row => {
                const measurementNumber = row[0];
                if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                    const value = row[i];
                    if (!isNaN(value)) {
                        sum += value;
                        count++;
                    }
                }
            });
            const avg = count > 0 ? sum / count : 0;
            averages.push(avg);

            const avgTd = document.createElement('td');
            avgTd.textContent = avg.toExponential(4);
            avgRow.appendChild(avgTd);
        }

        const avgValue18 = averages[17];

        
        const compareRow1 = createCompareRow('> 0.01 of 18', averages, avgValue18, 0.01, 1, 44); 
        const compareRow2 = createCompareRow('> 0.001 of 18', averages, avgValue18, 0.001, 45, numLabels); 
        
        table.appendChild(compareRow1);
        table.appendChild(compareRow2);

      
        highlightCellsInRange(tableId, startInterval, endInterval);
        if (tabNumber === 4) {
            let foundRed1 = false;
            let foundRed2 = false;

      
            compareRow1.querySelectorAll('td').forEach(td => {
                if (td.style.backgroundColor === 'rgb(243, 105, 105)') {  
                    document.getElementById('water_1').innerText = "no";
                }
            });

      
            compareRow2.querySelectorAll('td').forEach(td => {
                if (td.style.backgroundColor === 'rgb(243, 105, 105)') { 
                    document.getElementById('water_2').innerText = "no";
                }
            });
        }
    }

    function createCompareRow(label, averages, baseValue, multiplier, start, end) {
        const compareRow = document.createElement('tr');
        compareRow.classList.add('compare-row');

        const compareLabelCell = document.createElement('td');
        compareLabelCell.textContent = label;
        compareRow.appendChild(compareLabelCell);

        for (let i = 1; i <= averages.length; i++) { 
            const compareTd = document.createElement('td');
            if (i >= start && i <= end) {
                const compareValue = averages[i - 1]; 
                compareTd.style.backgroundColor = compareValue > multiplier * baseValue ? '#f36969' : '#9ee3a3'; 
            } else {
                compareTd.style.backgroundColor = '#A9A9A9'; 
            }
            compareRow.appendChild(compareTd);
        }

        return compareRow;
    }

    function highlightCellsInRange(tableId, startInterval, endInterval) {
        document.querySelectorAll(`#${tableId} tr`).forEach(tr => {
            const cells = tr.getElementsByTagName('td');
            for (let i = 1; i < cells.length; i++) {
                const cell = cells[i];
                const measurementNumber = parseInt(tr.cells[0].textContent, 10);
                if (measurementNumber >= startInterval && measurementNumber <= endInterval) {
                    cell.classList.add('highlight');
                } else {
                    cell.classList.remove('highlight');
                }
            }
        });
    }

    let myChart = null;
    let datasets = {}; 
    let datasetList = {};
    const datasetColors = {};
    const datasetStack = {};
    let annotations = []; 
    const colors = [
        'rgba(75, 192, 192, 0.2)',
        'rgba(255, 99, 132, 0.2)',
        'rgba(255, 159, 64, 0.6)',
        'rgba(153, 102, 255, 0.6)',
        'rgba(255, 205, 86, 0.6)',
        'rgba(54, 162, 235, 0.6)',
        'rgba(201, 203, 207, 0.6)'
    ];

    function getDataFromTable(tableId, label) {
        const table = document.getElementById(tableId);

  
        const labels = [];
        for (let i = 1; i < table.rows[0].cells.length; i++) {
            labels.push(table.rows[0].cells[i].innerText.trim());
        }


        const data = [];
        for (let i = 1; i < table.rows[1].cells.length; i++) {
            const cellValue = parseFloat(table.rows[1].cells[i].innerText.trim()); 
            if (!isNaN(cellValue)) {
                data.push(cellValue);
            } else {
                console.error('One of the values is not correct:', table.rows[1].cells[i].innerText);
            }
        }

        return { labels, data };
    }


    let lastClickedIndex = null;
    let verticalLine = null; 
    document.addEventListener('DOMContentLoaded', () => {
        const ctx = document.getElementById('myChart').getContext('2d');

        function updateChart() {
            if (myChart) {
                myChart.destroy();
            }
            const canvas = document.getElementById('myChart');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);

            const yMinInput = document.getElementById('yMin');
            const yMaxInput = document.getElementById('yMax');
            const yMinValue = parseFloat(yMinInput.value);
            const yMaxValue = parseFloat(yMaxInput.value);
            const inputField = document.getElementById("Peak Number");

            myChart = new Chart(ctx, {
                data: {
                    labels: Object.keys(datasets).length > 0 ? Object.values(datasets)[0].labels : [],
                    datasets: Object.values(datasets).map((ds, index) => {
                        let stackGroupX = 'StackGroupX1';
                        let yAxisID = 'y';
                        let color_1 = ds.backgroundColor || 'rgba(0, 0, 0, 0.1)';
                        let order = 1;
                        let op = 45;
                        
                        if (ds.staks === 'Calculated Reference measurement') {
                            yAxisID = 'y2';
                            order = 2;
                            stackGroupX = 'StackGroupX1';
                        } else if (ds.staks === 'Calculated Sample measurement') {
                            yAxisID = 'y2';
                            order = 2;
                            stackGroupX = 'StackGroupX2';
                        } else if (ds.label === 'Reference measurement') {
                            color_1 = document.getElementById("colorPicker_reference_bar").value || "rgba(75, 192, 192, 0.4)";
                            op = document.getElementById("opacityInput_reference_bar").value/100;
                            
                            stackGroupX = 'StackGroupX1';
                        } else if (ds.label === 'Sample measurement') {
                            color_1 = document.getElementById("colorPicker_sample_bar").value || 'rgba(255, 99, 132, 0.3)';
                            stackGroupX = 'StackGroupX2';
                            op = document.getElementById("opacityInput_reference_bar").value/100;
                        } else if (ds.label === 'Reference measurment line') {
                            color_1 = "white";

                        }
                        if (verticalLine)
                            myChart.options.plugins.annotation.annotations = [verticalLine];

                        if (ds.colorCode === 'yes') {
                            color_1 = ds.backgroundColor;
                        }

                        function setOpacity(color, alpha) {
                        
                            if (color.startsWith("rgba")) {
                                
                                return color.replace(/rgba\((\d+), (\d+), (\d+), ([^)]+)\)/, `rgba($1, $2, $3, ${alpha})`);
                            }
                           
                            return convertHexToRgba(color, alpha);
                        }
                        
                        color_1 = setOpacity(color_1, op); 

                        function convertHexToRgba(hex, alpha) {
                            let r = parseInt(hex.slice(1, 3), 16);
                            let g = parseInt(hex.slice(3, 5), 16);
                            let b = parseInt(hex.slice(5, 7), 16);
                            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                        }

                        const chartType = ds.type || 'bar'; 
                        return {
                            type: chartType, 
                            label: ds.label,
                            data: ds.data,
                            backgroundColor: ds.backgroundColor || color_1,
                            borderColor: ds.borderColor || color_1,
                            borderWidth: chartType === 'line' ? 2 : 0,  
                            stack: stackGroupX,
                            order: order,
                            yAxisID: yAxisID,
                            fill: chartType === 'line' ? false : true, 
                            spanGaps: true,  
                            showLine: chartType === 'line' ? true : false,  
                            pointRadius: chartType === 'line' ? 0 : 0  
                        };
                    })
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    const value = tooltipItem.raw;
                                    return tooltipItem.dataset.label + ': ' + (value ? value.toExponential(4) : 'Н/Д');
                                }
                            }
                        },
                        legend: {
                            labels: {
                                position: 'right', 
                                align: 'start', 
                                font: {
                                    size: 14, 
                                    weight: 'bold' 
                                },
                                color: 'black' 
                            }
                        },
                        annotation: {
                            annotations: annotations,
                            annotations: verticalLine ? [verticalLine] : []
                        }
                    },
                    onClick: (evt, elements) => {
                        if (elements.length) {
                            const element = elements[0];
                            const datasetIndex = element.datasetIndex;
                            const index = element.index;
                            const value = myChart.data.datasets[datasetIndex].data[index];
                            const label = myChart.data.labels[index];
                            const values = myChart.data.datasets.map(ds => ds.data[index]);
                        }
                    },

                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const index = element.index; 
                            inputField.value = index + 1;
                            inputField.dispatchEvent(new Event('input'));

                            if (lastClickedIndex === index) {
                                verticalLine = null; 
                            } else {
                              
                                if (verticalLine) {
                                    verticalLine.value = myChart.data.labels[index]; 
                                } else {
                   
                                    verticalLine = {
                                        type: 'line',
                                        mode: 'vertical',
                                        scaleID: 'x',
                                        value: myChart.data.labels[index], 
                                        borderColor: 'rgba(0, 0, 0, 1)', 
                                        borderWidth: 2,
                                        borderDash: [5, 5],
                                    };
                                }
                            }

                           
                            myChart.options.plugins.annotation.annotations = verticalLine ? [verticalLine] : [];
                            myChart.update();
                            lastClickedIndex = (lastClickedIndex === index) ? null : index;


                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            barPercentage: 1.0,
                            categoryPercentage: 1.0,
                            min: xMin,
                            max: xMax,
                            title: {
                                display: true, 
                                text: 'Mass point', 
                                color: 'black', 
                                font: {
                                    size: 14, 
                                    weight: 'bold' 
                                }
                            },
                            ticks: {
                                color: "black",
                                font: {
                                    size: 12,
                                    weight: "bold",

                                },
                            },

                        },
                        y: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            stacked: false,
                            min: yMinValue,
                            max: yMaxValue,
                            ticks: {
                                color: "black",
                                font: {
                                    size: 14,
                                    weight: "bold",

                                },
                                callback: function (value) {
                                    
                                    if (Number.isInteger(Math.log10(value))) {
                                        return Number(value.toString());
                                    }
                                    return null; 
                                }
                            },
                            title: {
                                display: true, 
                                text: 'Pressure in mbar', 
                                color: 'black', 
                                font: {
                                    size: 14, 
                                    weight: 'bold'
                                }
                            }
                        },
                        y2: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            stacked: true,
                            position: 'right',
                            min: yMinValue,
                            max: yMaxValue,
                            ticks: {
                                color: "black",
                                font: {
                                    size: 14,
                                    weight: "bold",

                                },
                                callback: function (value) {
                                    if (Number.isInteger(Math.log10(value))) {
                                        return Number(value.toString());
                                    }
                                    return null; 
                                }
                            },
                            title: {
                                display: true,
                                text: 'Pressure in mbar', 
                                color: 'black', 
                                font: {
                                    size: 14, 
                                    weight: 'bold' 
                                }
                            }
                        }
                    }
                }
            });
            
            document.getElementById('clearHistograms').addEventListener('click', function() {

                function removeClassFromButtons(className) {
                    const buttons = document.querySelectorAll(className);
                    buttons.forEach(button => {
                        button.classList.remove(className.substring(1)); 
                    });
                }

        
                removeClassFromButtons('.button-add-comparison');
                removeClassFromButtons('.button-add-data');
                removeClassFromButtons('.button-add-reference');

                const squareButtons = document.querySelectorAll('button[class^="square-button-"]');
                squareButtons.forEach(button => {
                    const classes = Array.from(button.classList);
                    classes.forEach(className => {
                        if (className.startsWith('square-button-')) {
                            button.classList.remove(className); 
                            button.classList.add('square-button-active')
                        }
                    });
                    button.style.backgroundColor = ''; 
                });
                datasets = [];
                datasetList = {};
                if (verticalLine) {
                    verticalLine = null;
                }
                const resultsContainer = document.querySelector(".peaks_info");
                resultsContainer.innerHTML = "";

                updateChart();
            });


        }

        let buttonActive = false; 

        function addArrays(arr1, arr2) {
            return arr1.map((value, index) => value + arr2[index]);
        }

        function subtractArrays(arr1, arr2) {
            return arr1.map((value, index) => value - arr2[index]);
        }

        function addCalculatedHistograms(chem, selectedColor) {

            const greyDatasets = Object.keys(datasets).filter(label => label.startsWith('Calculated '));
            const mainDatasets = Object.keys(datasets).filter(label => label.startsWith('Reference')||label.startsWith('Sample'));
            const oldGreyPeaks1 = datasets["Calculated Reference measurement"]?.peaks|| datasets["Calculated Sample measurement"]?.peaks|| []
            
            if (((oldGreyPeaks1.length === 1)) && oldGreyPeaks1[0] === chem) {
     
                greyDatasets.forEach(label => delete datasets[label]);
                annotations = annotations.filter(ann => !ann.value.startsWith('Calculated '));
                updateChart();

                return 0;  
            } else {
                if (mainDatasets.length === 0) {
                    return 0;
                }
                const greyColor = 'rgba(128, 128, 128, 0.6)'; 
                let added = false;  
                let info_peaks = []
                Object.keys(datasets).forEach((label) => {
                    if (!label.includes("Calculated") && !label.includes("Comparison") && !label.includes("line")) {
                        const oldData = datasets[label].data;
                        let oldGreyData = datasets[`Calculated ${label}`]?.data || Array(100).fill(0);
                        const oldGreyPeaks = datasets[`Calculated ${label}`]?.peaks|| [];
                        const newLabels = [];
                        const newData = [];
                        let newLABEL = label 
                        let newPeaks = oldGreyPeaks
                        let button_color = '#00BFFF';
                        const mks_peaks = {
                            "Hydrogen": [[2, 100], [1, 5]],
                            "Helium": [[4, 100]],
                            "Methane": [[16, 100], [15, 85], [14, 16], [13, 8], [1, 4]],
                            "Ammonia": [[17, 100], [16, 80], [15, 8], [14, 2]],
                            "Water": [[18, 100], [17, 25], [1, 6], [16, 2], [2, 2]],
                            "Neon": [[20, 100], [22, 9]],
                            "Acetylene": [[26, 100], [25, 20], [13, 5], [54, 5], [27, 3]],
                            "Diborane": [[26, 100], [27, 96], [24, 95], [25, 57], [11, 40]],
                            "VinylChloride": [[27, 100], [62, 88], [28, 36], [26, 33], [64, 27]],
                            "Nitrogen": [[28, 100], [14, 7], [29, 1]],
                            "CarbonMonoxide": [[28, 100], [16, 10], [12, 5], [29, 1]],
                            "Ethylene": [[28, 100], [26, 61], [27, 59], [25, 12], [14, 8]],
                            "Ethane": [[28, 100], [27, 33], [30, 26], [26, 23], [29, 21]],
                            "Air": [[28, 100], [32, 27], [14, 6], [16, 3], [40, 1]],
                            "Propane": [[29, 100], [28, 59], [27, 38], [44, 26], [43, 22]],
                            "Acetaldehyde": [[29, 100], [44, 45], [43, 27], [42, 9], [26, 9]],
                            "FormicAcid": [[29, 100], [46, 61], [45, 47], [17, 17], [28, 17]],
                            "NitricAcid": [[30, 100], [14, 7], [15, 2], [16, 1]],
                            "Silane": [[30, 100], [31, 80], [29, 31], [28, 28], [32, 8]],
                            "NitrogenDioxide": [[30, 100], [46, 37], [16, 22], [14, 9]],
                            "Methanol": [[31, 100], [32, 66], [29, 64], [28, 6], [18, 2]],
                            "EthyleneGlycol": [[31, 100], [33, 28], [15, 18], [29, 17], [43, 7]],
                            "Ethanol": [[31, 100], [45, 34], [27, 24], [29, 23], [46, 17]],
                            "Oxygen": [[32, 100], [16, 11]],
                            "HydrogenSulfide": [[34, 100], [32, 44], [33, 42], [36, 34], [35, 2]],
                            "Argon": [[40, 100], [20, 10]],
                            "Propene": [[41, 100], [39, 73], [42, 69], [27, 38], [40, 29]],
                            "Acetone": [[43, 100], [15, 67], [28, 17], [14, 15], [58, 15]],
                            "Butane": [[43, 100], [29, 44], [27, 37], [28, 32], [41, 27]],
                            "MethylEthylKetone": [[43, 100], [29, 25], [72, 16], [27, 16], [57, 6]],
                            "MPOil": [[43, 100], [41, 91], [57, 73], [55, 64], [71, 20]],
                            "Acetic Acid": [[43, 100], [45, 93], [60, 57], [29, 15], [42, 1]],
                            "TurbopumpOil": [[43, 100], [57, 88], [41, 76], [55, 73], [71, 52]],
                            "CarbonDioxide": [[44, 100], [28, 11], [16, 9], [12, 6], [45, 1]],
                            "NitrousOxide": [[44, 100], [30, 31], [14, 13], [28, 11], [16, 5]],
                            "IsopropylAlcohol": [[45, 100], [43, 16], [27, 16], [29, 10], [41, 7]],
                            "BoronTrifluoride": [[49, 100], [48, 28], [68, 5], [11, 5], [19, 3]],
                            "DPOilPPE": [[50, 100], [77, 89], [63, 29], [62, 27], [64, 21]],
                            "NitrogenTrifluoride": [[52, 100], [33, 40], [71, 31], [14, 9], [19, 8]],
                            "Disilane": [[60, 100], [58, 82], [57, 48], [62, 42], [61, 40]],
                            "Diphosphine": [[62, 100], [64, 70], [63, 59], [65, 26], [66, 2]],
                            "SulfurDioxide": [[64, 100], [48, 49], [32, 10], [66, 5], [16, 5]],
                            "Fomblin": [[69, 100], [20, 28], [16, 16], [31, 9], [97, 8]],
                            "Trifluoromethane": [[69, 100], [51, 91], [31, 49], [50, 42], [12, 4]],
                            "Tetrafluoromethane": [[69, 100], [50, 12], [19, 7], [31, 5]],
                            "Freon13": [[69, 100], [85, 15], [50, 14], [31, 9], [35, 7]],
                            "CarbonDisulfide": [[76, 100], [32, 21], [44, 17], [78, 9], [38, 6]],
                            "Arsine": [[76, 100], [78, 60], [77, 21], [75, 4]],
                            "Benzene": [[78, 100], [77, 22], [51, 18], [50, 17], [52, 15]],
                            "DPOilDC705": [[78, 100], [76, 83], [39, 73], [43, 59], [91, 32]],
                            "Krypton": [[84, 100], [86, 31], [83, 20], [82, 20], [80, 4]],
                            "Freon12": [[85, 100], [87, 32], [50, 16], [35, 12]],
                            "SiliconTetrafluoride": [[85, 100], [87, 12], [28, 12], [33, 10], [86, 5]],
                            "Toluene": [[91, 100], [92, 69], [65, 16], [51, 10], [63, 9]],
                            "Trichloroethylene": [[95, 100], [60, 65], [97, 64], [35, 40], [47, 26]],
                            "Freon11": [[101, 100], [103, 60], [35, 16], [66, 15], [47, 12]],
                            "Xenon": [[132, 100], [129, 98], [131, 79], [134, 39], [136, 33]]
                        };
          
                        const totalColumns = 100; 
                        let newDataArray = new Array(totalColumns).fill(0);
                        if (mks_peaks[chem]) {
                            elementData = mks_peaks[chem];
                            const index_max = mks_peaks[chem][0][0]
                            const max_peak = oldData[index_max-1] || 0;
                            newLABEL = newLABEL + " + " + chem;  
                            newDataArray[index_max-1] = max_peak; 
                            button_color = selectedColor || '#00BFFF'; 

           
                            elementData.slice(1).forEach(([column, percentage]) => {
                                const colValue = max_peak || 0; 
                                if (totalColumns > column) newDataArray[column - 1] = colValue * (percentage / 100);
                            });
         
                            for (let i = 1; i <= totalColumns; i++) {
                                newLabels.push(i.toString());
                            }
                            
                        }           
                        if (!datasetList[label]?.includes(chem)) {
                            if (!Array.isArray(datasetList[label])) {
                                datasetList[label] = []; 
                            }
                            datasetList[label].push(chem);
                            buttonActive = 1;
                
                            datasets[`Calculated ${label} ${chem}`] = {
                                labels: newLabels,
                                data: newDataArray,
                                label: `Peak for ${label}: ${chem}`,
                                staks: `Calculated ${label}`,
                                backgroundColor: button_color,
                                borderColor: greyColor.replace('0.6', '1'),
                                borderWidth: 0,
                                peaks: newPeaks,
                                colorCode: "yes",
                                type: "bar",
                                
                            };
                            info_peaks = datasets[`Calculated ${label}`]?.peaks;
                        } else {
                            const index = datasetList[label].indexOf(chem);
                            if (index !== -1) {
                                datasetList[label].splice(index, 1);  
                            }
                            delete datasets[`Calculated ${label} ${chem}`];
                            buttonActive = 0;
                        }

                    }
                });

                updateChart();
                return buttonActive ; 
            }
        }
        function handleButtonClick(button) {
            

            let p = 0;
            let colorPicker, element;

            element = button.getAttribute('element');
            const colorPickerId = `colorPicker_${element}`; 
            colorPicker = document.getElementById(colorPickerId).value; 
            p = addCalculatedHistograms(element, colorPicker); 

            if (p===1) {
                button.classList.add(`square-button-${element}`);
                button.style.backgroundColor = colorPicker; 
            } else {
                button.classList.remove(`square-button-${element}`);
                button.style.backgroundColor = ''; 
            }
        }

        const buttons = document.querySelectorAll('[id^="addCalculatedHistogramsButton_"]'); 

        buttons.forEach(button => {
            button.addEventListener('click', function() {
                handleButtonClick(this); 
            });
        });

        
        let test = 0;
        function toggleDataFromTable(tableId, label, chartType) {
            if (datasets[label]) {
   
                delete datasets[label];
                delete datasetColors[label];
                test = 0;
            } else {
                const { labels, data } = getDataFromTable(tableId, label);              
                if (label.includes("Vacuum Crit.")) {
                    const data100 = new Array(data.length).fill(null);  
                    const referenceValue = data[17]; 
                    for (let i = 0; i < 45; i++) {
                        data100[i] = referenceValue / 100;  
                    }
                    for (let i = 44; i < data.length; i++) {
                        data100[i] = referenceValue / 1000;  
                    }
                    if (label.includes("reference")) {
                        color_color = 'colorPicker_vacuum_reference';
                    }
                    if (label.includes("sample")) {
                        color_color = 'colorPicker_vacuum_sample';
                    }
                    if (label.includes("comparison")) {
                        color_color = 'colorPicker_vacuum_comparison';
                    }
                    datasets[label] = {
                        data: data100,   
                        label: label,
                        borderColor: document.getElementById(color_color).value, 
                        showLine: true,   
                        fill: false,       
                        type: 'line',
                        labels: labels,
                        backgroundColor: "white",
                    };
                }
                else {
                    if (chartType === 'scatter') {
                        let color_plot = '';
                        if (label == "Reference measurement line") {
                            color_plot = document.getElementById('colorPicker_reference_line').value;
                        }
                        if (label == "Sample measurement line") {
                            color_plot = document.getElementById('colorPicker_sample_line').value;
                        }
                        if (label == "Comparison line") {
                            color_plot = document.getElementById('colorPicker_comparison_line').value;
                        }

                        datasets[label] = {
                            data: data,         
                            label: label,
                            borderColor: color_plot,   
                            showLine: true,     
                            fill: false,        
                            type: 'line',
                            labels: labels,
                            backgroundColor: "white",
                        };
                    } else {
                        let color = "";
                        datasets[label] = { labels, data, label };
                        if (label == "Reference measurement bar") {
                            color = document.getElementById('colorPicker_reference_bar').value;
                        }
                        if (label == "Sample measurement bar") {
                            color = document.getElementById('colorPicker_sample_bar').value;
                        }
                        if (label == "Comparison bar") {
                            color = document.getElementById('colorPicker_comparison_bar').value;
                        }
                        datasetColors[label] = color; 
                    }
                }

                test = 1;
            }

            updateChart();  
            return test;
        }


        document.getElementById('toggleChartFromTable5').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable5', 'Reference measurement',"bar");
            if (p===1) {
                this.classList.add('button-add-reference');
            } else {
                this.classList.remove('button-add-reference');
            }
        });

        document.getElementById('toggleChartFromTable6').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Sample measurement',"bar");
            if (p===1) {
                this.classList.add('button-add-data');
            } else {
                this.classList.remove('button-add-data');
            }
        });



        document.getElementById('toggleChartFromTable7').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable7', 'Comparison', "bar");
            if (p===1) {
                this.classList.add('button-add-comparison');
            } else {
                this.classList.remove('button-add-comparison');
            }
        });

        document.getElementById('toggleChartFromTable5-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable5', 'Reference measurement line','scatter');
            if (p===1) {
                this.classList.add('button-add-reference');
            } else {
                this.classList.remove('button-add-reference');
            }
        });

        document.getElementById('toggleChartFromTable6-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable6', 'Sample measurement line','scatter');
            if (p===1) {
                this.classList.add('button-add-data');
            } else {
                this.classList.remove('button-add-data');
            }
        });

        document.getElementById('toggleChartFromTable7-2').addEventListener('click', function () {
            p = toggleDataFromTable('dataTable7', 'Comparison line', 'scatter');
            if (p===1) {
                this.classList.add('button-add-comparison');
            } else {
                this.classList.remove('button-add-comparison');
            }
        });

        document.getElementById('vacuum_test_reference').addEventListener('click', function () {
            
            const source1 = this.getAttribute('source');
            const tableMap = {
                "reference": 'dataTable5',
                "sample": 'dataTable6',
                "comparison": 'dataTable7'
            };
            console.log (source1, tableMap[source1] )

            p = toggleDataFromTable(tableMap[source1], 'Vacuum Crit. for '+ source1, 'scatter');
            if (p===1) {
                this.classList.add('button-add-vacuum-100');
            } else {
                this.classList.remove('button-add-vacuum-100');
            }
        });

        document.getElementById('vacuum_test_sample').addEventListener('click', function () {
            
            const source1 = this.getAttribute('source');
            const tableMap = {
                "reference": 'dataTable5',
                "sample": 'dataTable6',
                "comparison": 'dataTable7'
            };
            console.log (source1, tableMap[source1] )

            p = toggleDataFromTable(tableMap[source1], 'Vacuum Crit. for '+ source1, 'scatter');
            if (p===1) {
                this.classList.add('button-add-vacuum-100');
            } else {
                this.classList.remove('button-add-vacuum-100');
            }
        });

        document.getElementById('vacuum_test_comparison').addEventListener('click', function () {
            
            const source1 = this.getAttribute('source');
            const tableMap = {
                "reference": 'dataTable5',
                "sample": 'dataTable6',
                "comparison": 'dataTable7'
            };
            console.log (source1, tableMap[source1] )

            p = toggleDataFromTable(tableMap[source1], 'Vacuum Crit. for '+ source1, 'scatter');
            if (p===1) {
                this.classList.add('button-add-vacuum-100');
            } else {
                this.classList.remove('button-add-vacuum-100');
            }
        });

        function add_criterium(source) {

            const water_peak= document.getElementById('wp_'+ source).textContent;
            const total = document.getElementById('fp_'+ source).textContent 
            const total_44 = document.getElementById('sum44_'+ source).textContent ;
            const total_ratio = document.getElementById('rat_'+ source).textContent;
            

            document.getElementById('sum_of_all_scan').innerText = total;
            document.getElementById('sum_of_44').innerText = total_44;
            document.getElementById('contribution_of_44').innerText = total_ratio;
            document.getElementById('water-peak').innerText = water_peak;

        }


        function toggleButtons(activeButtonId, vacuumButtonId) {
         
            console.log("ldd:",datasets)
            datasets = Object.keys(datasets)
            .filter(key => !key.includes("Vacuum Crit."))
            .reduce((acc, key) => {
                acc[key] = datasets[key];
                return acc;
            }, {});
            updateChart()
            const useButtons = [
                { id: 'use_criterium_comparison', vacuumId: 'vacuum_test_comparison' },
                { id: 'use_criterium_reference', vacuumId: 'vacuum_test_reference' },
                { id: 'use_criterium_sample', vacuumId: 'vacuum_test_sample' }
            ];

            let isActive = false;
            

            useButtons.forEach(button => {
                const useButton = document.getElementById(button.id);
                const vacuumButton = document.getElementById(button.vacuumId);

                if (button.id === activeButtonId) {
                    
                    if (useButton.classList.contains('button-add-green')) {
             
                        useButton.classList.remove('button-add-green');
                        useButton.classList.add('button-add-criterium');
                        vacuumButton.classList.add('button-add-grey');
                        vacuumButton.classList.remove('button-add-green');
                        isActive = true; 
                    } else {
        
                        useButton.classList.add('button-add-green');
                        useButton.classList.remove('button-add-criterium');
                        vacuumButton.click();
                    
                    }
                } else {
                
                    useButton.classList.remove('button-add-green');
                    useButton.classList.add('button-add-criterium');
            
                    vacuumButton.classList.add('button-add-grey');
                    vacuumButton.classList.remove('button-add-green');
                }
            });

            return isActive; 
        }

  
        document.getElementById('use_criterium_comparison').addEventListener('click', function() {
            const isActive = toggleButtons('use_criterium_comparison', 'vacuum_test_comparison');
            add_criterium("comp")
            

            if (!isActive) {
                console.log('Vacuum Criterium Comparison activated');
            } else {
                console.log('Vacuum Criterium Comparison deactivated');
            }
        });

        document.getElementById('use_criterium_reference').addEventListener('click', function() {
            const isActive = toggleButtons('use_criterium_reference', 'vacuum_test_reference');
            add_criterium("ref")
            if (!isActive) {
                console.log('Vacuum Criterium Reference activated');
            } else {
                console.log('Vacuum Criterium Reference deactivated');
            }
        });

        document.getElementById('use_criterium_sample').addEventListener('click', function() {
            const isActive = toggleButtons('use_criterium_sample', 'vacuum_test_sample');
            add_criterium("samp")
            if (!isActive) {
                console.log('Vacuum Criterium Sample activated');
            } else {
                console.log('Vacuum Criterium Sample deactivated');
            }
        });

        document.getElementById('yMin').addEventListener('input', function () {
            yMin = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('yMax').addEventListener('input', function () {
            yMax = parseFloat(this.value);
            updateChart();
        });
        document.getElementById('xMin').addEventListener('input', function () {
            xMin = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('xMax').addEventListener('input', function () {
            xMax = parseFloat(this.value);
            updateChart();
        });

        document.getElementById('myChart').addEventListener('contextmenu', function(event) {
            event.preventDefault(); 
            const elements = myChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
    
            if (elements.length) {
                const element = elements[0];
                const index = element.index;
                const label = myChart.data.labels[index];
                const annotationIndex = annotations.findIndex(ann => ann.value === label);
        
                if (annotationIndex !== -1) {
 
                    annotations.splice(annotationIndex, 1);
                    updateChart(); 
                }
            }
        });


        window.addEventListener('resize', () => {
            const canvas = document.getElementById('myChart');
            const dpr = window.devicePixelRatio || 1;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            if (myChart) {
                myChart.resize();
            }
        });

        updateChart(); 
    });


    function take_the_avarage(summaryTableId, dataTableId, tabNumber, refNumber) {
        const table_sum = document.getElementById(summaryTableId);
        const table_data = document.getElementById(dataTableId);
        const lastRowIndex = table_sum.rows.length - 1;


        if (lastRowIndex < 0) return; 

        const lastRow = table_sum.rows[lastRowIndex];
        const lastRow_data = table_data.rows[lastRowIndex];
        const rowCopy = lastRow.cloneNode(true);
        const rowCopy_data = lastRow_data.cloneNode(true);

        const ts = parseInt(refNumber) + 4; 

   
        const table_sum_comp = document.getElementById('summaryTable' + ts);
        const table_data_comp = document.getElementById('dataTable' + ts);


        table_sum_comp.innerHTML = '';
        table_data_comp.innerHTML = '';


        if (table_sum.rows.length > 0) {
        const headerRow = table_sum.rows[0].cloneNode(true);
        table_sum_comp.appendChild(headerRow);
        }
        if (table_data.rows.length > 0) {
            const headerRow_data = table_data.rows[0].cloneNode(true);
            table_data_comp.appendChild(headerRow_data);
        }

        table_sum_comp.appendChild(rowCopy);
        table_data_comp.appendChild(rowCopy_data);
    }

    function calculateDifference(referenceTable_sum, dataTable_sum,referenceTable_dat, dataTable_dat) {
        const refRows_sum = referenceTable_sum.rows;
        const dataRows_sum = dataTable_sum.rows;
        const refRows_dat = referenceTable_dat.rows;
        const dataRows_dat = dataTable_dat.rows;


        if (refRows_sum.length !== dataRows_sum.length && refRows_sum.length!==0 &&  dataRows_sum.length !==0) {
            console.warn("Tables have different number of rows.");
            return;
        }
        if (refRows_dat.length !== dataRows_dat.length && refRows_dat.length!==0 &&  dataRows_dat.length !==0) {
            console.warn("Tables have different number of rows.");
            return;
        }

        const comparisonTable_sum = document.getElementById('summaryTable7');
        comparisonTable_sum.innerHTML = ''; 
        const comparisonTable_dat = document.getElementById('dataTable7');
        comparisonTable_dat.innerHTML = ''; 


        const summaryHeaderRow_sum = document.createElement('tr');
        const headers = ['Sum', 'Sum>44', 'Ratio'];
        headers.forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            summaryHeaderRow_sum.appendChild(th);
        });
        comparisonTable_sum.appendChild(summaryHeaderRow_sum);

        const summaryHeaderRow_dat = document.createElement('tr');
        const firstCell = document.createElement('th');
        firstCell.textContent = '№';
        summaryHeaderRow_dat.appendChild(firstCell);
        const numLabels = 100;
        for (let i = 1; i <= numLabels; i++) {
            const th = document.createElement('th');
            th.textContent = i; 
            summaryHeaderRow_dat.appendChild(th);
        }
    

        for (let i = 1; i < refRows_sum.length; i++) { 
            const refRow = refRows_sum[i];
            const dataRow = dataRows_sum[i];
            const newRow = document.createElement('tr');

            for (let j = 0; j < refRow.cells.length-1; j++) {
                
                const refCell = parseFloat(refRow.cells[j].innerText) || 0;
                const dataCell = parseFloat(dataRow.cells[j].innerText) || 0;
                const diff = dataCell - refCell
            

                const newCell = document.createElement('td');
                newCell.innerText = diff.toExponential(4); 
                newRow.appendChild(newCell);
            }
            const ratio_cell = document.createElement('td');
            const newrow1 = parseFloat(newRow.cells[0].innerText) 
            const newrow2 = parseFloat(newRow.cells[1].innerText) 
            const ratio_end = newrow2/newrow1;
            ratio_cell.innerText = ratio_end.toExponential(4); 
            newRow.appendChild(ratio_cell);

            comparisonTable_sum.appendChild(newRow);
        }
        comparisonTable_dat.appendChild(summaryHeaderRow_dat);
    
        for (let i = 1; i < refRows_dat.length; i++) {
            const refRow = refRows_dat[i];
            const dataRow = dataRows_dat[i];
            const newRow = document.createElement('tr');

            const averageCell = document.createElement('td');
            averageCell.innerText = "Average";
            newRow.appendChild(averageCell);

            for (let j = 1; j < refRow.cells.length; j++) {
                const refCell = parseFloat(refRow.cells[j].innerText) || 0;
                const dataCell = parseFloat(dataRow.cells[j].innerText) || 0;
                const diff = dataCell - refCell;
                const newCell = document.createElement('td');
                newCell.innerText = diff.toExponential(4); 
                newRow.appendChild(newCell);
            }

        
        comparisonTable_dat.appendChild(newRow);
        }
        
    
    }

    function updateComparisonTable(tabNumber, refNumber) {

        const referenceTable_sum = document.getElementById('summaryTable5');
        const referenceTable_dat = document.getElementById('dataTable5');
        const dataTable_sum = document.getElementById('summaryTable6');
        const dataTable_dat = document.getElementById('dataTable6');
        const comparisonTable_sum = document.getElementById('summaryTable7');
        const comparisonTable_dat = document.getElementById('dataTable7');
        calculateDifference(referenceTable_sum, dataTable_sum,referenceTable_dat, dataTable_dat)
        return 1
    
    }


    document.querySelectorAll('.sendToComparison').forEach(button => {
        button.addEventListener('click', function () {
            const tabNumber = this.getAttribute('data-tab');
            const refNumber = this.getAttribute('data-ref');
            const summaryTableId = 'summaryTable' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;


            take_the_avarage(summaryTableId, dataTableId, tabNumber, refNumber);

            if (tabNumber === "3" || tabNumber === "4") {
                const table = document.getElementById('summaryTable6');
                const data_table = document.getElementById('dataTable6');

                if (table && data_table) {
                    const total = table.rows[1].cells[0].innerText;
                    const total_44 = table.rows[1].cells[1].innerText;
                    const total_ratio = table.rows[1].cells[2].innerText;
                    const water_peak = data_table.rows[1].cells[18].innerText;

                    document.getElementById('sum_of_all_scan').innerText = total;
                    document.getElementById('final_pressure_sample').innerText = total + " mbar";
                    document.getElementById('final_pressure').innerText = total + " mbar";
                    document.getElementById('sum_of_44').innerText = total_44;
                    document.getElementById('contribution_of_44').innerText = total_ratio;
                    document.getElementById('water-peak').innerText = water_peak;

                    document.getElementById('wp_samp').innerText = water_peak;
                    document.getElementById('fp_samp').innerText = total;
                    document.getElementById('sum44_samp').innerText = total_44;
                    document.getElementById('rat_samp').innerText = total_ratio;
                } else {
                    console.error("Table or Data Table for Tab 6 not found.");
                }
            }

            if (tabNumber === "1" || tabNumber === "2") {
                const table = document.getElementById('summaryTable5');
                const data_table = document.getElementById('dataTable5');

                if (table && data_table) {
                    const total = table.rows[1].cells[0].innerText;
                    const total_44 = table.rows[1].cells[1].innerText;
                    const total_ratio = table.rows[1].cells[2].innerText;
                    const water_peak = data_table.rows[1].cells[18].innerText;

                    document.getElementById('sum_of_all_scan').innerText = total;
                    document.getElementById('final_pressure_reference').innerText = total + " mbar";
                    document.getElementById('wp_ref').innerText = water_peak;
                    document.getElementById('fp_ref').innerText = total;
                    document.getElementById('sum44_ref').innerText = total_44;
                    document.getElementById('rat_ref').innerText = total_ratio;
                } else {
                    console.error("Table or Data Table for Tab 5 not found.");
                }
            }

            const today = new Date();
            const formattedDate = today.getDate().toString().padStart(2, '0') + '.' +
                (today.getMonth() + 1).toString().padStart(2, '0') + '.' +
                today.getFullYear();

            document.getElementById('data-final-1').innerText = formattedDate;
            document.getElementById('data-final-2').innerText = formattedDate;
            document.getElementById('data-final-3').innerText = formattedDate;
            document.getElementById('data-final-4').innerText = formattedDate;

            const p = updateComparisonTable(tabNumber, refNumber);
            console.log("Result of updateComparisonTable:", p);

            if (p === 1) {
                const table = document.getElementById('summaryTable7');
                const data_table = document.getElementById('dataTable7');

                if (table && data_table) {
                    console.log("Found tables for comparison update.");

                    if (table && table.rows[1] && table.rows[1].cells[0]) {
                    const total = table.rows[1].cells[0].innerText;
                    console.log("Total:", total);
                } else {
                    console.error("Ошибка: строки или ячейки в таблице отсутствуют.");
                    console.log("Таблица:", table);
                    console.log("Строка 1:", table ? table.rows[1] : "нет строки");
                    console.log("Ячейка 0:", table && table.rows[1] ? table.rows[1].cells[0] : "нет ячейки");
                }
                const row = table.rows[1];
                console.log("Содержимое строки 1:", row.innerHTML);

                    const total = table.rows[1].cells[0].innerText;
                    const total_44 = table.rows[1].cells[1].innerText;
                    const total_ratio = table.rows[1].cells[2].innerText;
                    const water_peak = data_table.rows[1].cells[18].innerText;

                    document.getElementById('wp_comp').innerText = water_peak;
                    document.getElementById('fp_comp').innerText = total;
                    document.getElementById('sum44_comp').innerText = total_44;
                    document.getElementById('rat_comp').innerText = total_ratio;
                } else {
                    console.error("Table or Data Table for Comparison not found.");
                }
            }
        });
    });


    function setupControls(tabNumber) {
        document.getElementById('startInterval' + tabNumber).addEventListener('change', () => {
            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            console.log (type_file);
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
        });

        
        document.getElementById('endInterval' + tabNumber).addEventListener('change', () => {
            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            console.log ("type:",type_file.getAttribute('value'));
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
        });
    }

    function downloadChart_sample() {
            const canvas = document.getElementById('myChart');
            const link = document.createElement('a');
            const dataURL = canvas.toDataURL('image/png'); 
            const resultContainer_sample = document.getElementById('resultChartContainer_sample');
            const img = document.createElement('img');
            img.src = dataURL;
            img.style.maxWidth = '100%';
            resultContainer_sample.innerHTML = ''; 
            resultContainer_sample.appendChild(img); 

        }
        function downloadChart_reference() {
            const canvas = document.getElementById('myChart');
            const link = document.createElement('a');
            const dataURL = canvas.toDataURL('image/png'); 
            const resultContainer_reference = document.getElementById('resultChartContainer_reference');
            const img = document.createElement('img');
            img.src = dataURL;
            img.style.maxWidth = '100%';
            resultContainer_reference.innerHTML = ''; 
            resultContainer_reference.appendChild(img); 

        }
        function downloadChart_summary() {
            const canvas = document.getElementById('myChart');
            const link = document.createElement('a');
            const dataURL = canvas.toDataURL('image/png'); 
            const resultContainer_summary = document.getElementById('resultChartContainer_summary');
            const img = document.createElement('img');
            img.src = dataURL;
            img.style.maxWidth = '100%';
            resultContainer_summary.innerHTML = ''; 
            resultContainer_summary.appendChild(img); 

        }

    document.getElementById('downloadBtn_refernce').addEventListener('click', downloadChart_reference);
    document.getElementById('downloadBtn_sample').addEventListener('click', downloadChart_sample);
    document.getElementById('downloadBtn_summary').addEventListener('click', downloadChart_summary);

    

    document.querySelectorAll('.last100').forEach(button => {
        button.addEventListener('click', function() {
            const tabNumber = this.getAttribute('data-tab'); 
            const startIntervalInput = document.getElementById('startInterval' + tabNumber);
            const endIntervalInput = document.getElementById('endInterval' + tabNumber);
            if (this.value === "all") {
                startIntervalInput.value = endIntervalInput.value - 100;
                this.value = "100"
                this.textContent = "All measurements"
                
            } else {
                startIntervalInput.value = 1;
                this.value = "all"
                this.textContent = "Last 100 measurements"
            }

            const fileInputId = 'fileInput' + tabNumber;
            const dataTableId = 'dataTable' + tabNumber;
            const summaryTableId = 'summaryTable' + tabNumber;
            const type_file = document.querySelector('.choise-of-the-quelle' + '[data-tab-number="' +tabNumber + '"]');
            if (document.getElementById(fileInputId).files[0]) {
                if (type_file.getAttribute('value') === "Karabo") {
                    processFile2(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }else{
                    processFile1(document.getElementById(fileInputId).files[0], dataTableId, summaryTableId, tabNumber);
                }
            }
            
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        const inputField = document.getElementById("Peak Number");
        const resultsContainer = document.querySelector(".peaks_info");

        inputField.addEventListener("input", function() {
            const massPeak = parseInt(this.value, 10);
            resultsContainer.innerHTML = ""; 
            
            if (!isNaN(massPeak)) {
                for (const [substance, peaks] of Object.entries(mks_peaks)) {
                    const matchingPeaks = peaks.some(([mass, _]) => mass === massPeak);
                    
                    if (matchingPeaks) {
                        const substanceContainer = document.createElement("div");
                        const substanceId = substance.replace(/\s+/g, '-'); 
                        substanceContainer.id = substanceId;
                        substanceContainer.classList.add("substance-container");

                        
                        substanceContainer.style.display = "flex";
                        substanceContainer.style.alignItems = "center";
                        substanceContainer.style.justifyContent = "space-between";
                        substanceContainer.style.padding = "10px";
                        substanceContainer.style.marginBottom = "10px";
                        substanceContainer.style.border = "1px solid #ccc";
                        substanceContainer.style.borderRadius = "5px";

                    
                        const titleContainer = document.createElement("div");
                        titleContainer.style.flex = "0 0 150px"; 
                        titleContainer.style.textAlign = "center";
                        titleContainer.style.fontWeight = "bold";
                        titleContainer.style.fontSize = "20px";
                        titleContainer.textContent = substance;
                        titleContainer.style.overflow = "hidden"; 
                        titleContainer.style.textOverflow = "ellipsis"; 
                    
                        const listContainer = document.createElement("div");
                        listContainer.style.flex = "2";
                        listContainer.style.marginLeft = "100px";

                        const peakList = document.createElement("ul");
                        peakList.style.listStyleType = "none";
                        peakList.style.padding = "0";
                        peakList.style.margin = "0";

                        peaks.forEach(([mass, percent]) => {
                            const listItem = document.createElement("li");
                            listItem.innerHTML = `<strong>${mass}</strong>     -      ${percent}%`;
                            listItem.style.padding = "2px 0";
                            peakList.appendChild(listItem);
                        });

                        listContainer.appendChild(peakList);

                        
                        substanceContainer.appendChild(titleContainer);
                        substanceContainer.appendChild(listContainer);
                        resultsContainer.appendChild(substanceContainer);

                    
                        let foundColor = false; 
                        if (datasets) {
                            for (const datasetKey in datasets) {
                                const dataset = datasets[datasetKey];
                                if (dataset.label && dataset.label.includes(substance)) {
                                    const graphColor = dataset.backgroundColor;
                                    substanceContainer.style.backgroundColor = graphColor; 
                                    foundColor = true;
                                    break;
                                }
                            }
                        } 
                        if (!foundColor) {
                                substanceContainer.style.backgroundColor = "transparent";
                        }


                        substanceContainer.addEventListener('click', function() {
                            const buttonId = `addCalculatedHistogramsButton_${substance.replace(/\s+/g, '')}`;
                            const button = document.getElementById(buttonId);
                            
                            if (button) {
                                button.click();
                            }
                            let foundColor = false; 
                            if (datasets) {
                                for (const datasetKey in datasets) {
                                    const dataset = datasets[datasetKey];
                                    if (dataset.label && dataset.label.includes(substance)) {
                                        const graphColor = dataset.backgroundColor;
                                        substanceContainer.style.backgroundColor = graphColor; 
                                        foundColor = true;
                                        break;
                                    }
                                }
                            } 
                            if (!foundColor) {
                                substanceContainer.style.backgroundColor = "transparent";
                            }
                        });
                    }
                }
            }
        });
    });



    function saveAsPDF() {
    
        var elementToPrint_1 = document.getElementById('end-file-1').outerHTML;
        var elementToPrint_2 = document.getElementById('end-file-2').outerHTML;
        var elementToPrint_3 = document.getElementById('end-file-3').outerHTML;
        

        var combinedContent = elementToPrint_1 + elementToPrint_2 + elementToPrint_3;

        var printWindow = window.open('', '', 'width=800,height=600');
        

        var styles = '';
        Array.from(document.styleSheets).forEach(styleSheet => {
            try {
                if (styleSheet.href) {
                    styles += `<link rel="stylesheet" href="${styleSheet.href}">`;
                } else {
                    Array.from(styleSheet.cssRules).forEach(rule => {
                        styles += `<style>${rule.cssText}</style>`;
                    });
                }
            } catch (e) {
                console.log("Style is not founded:", styleSheet.href);
            }
        });

        function updateCheckboxHTML(element) {
            var checkboxes = element.querySelectorAll('input[type="checkbox"]');
 
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    checkbox.setAttribute('checked', 'checked');
                } else {
                    checkbox.removeAttribute('checked'); 
                }
            });
        }

        var element_1 = document.getElementById('end-file-1');
        var element_2 = document.getElementById('end-file-2');
        var element_3 = document.getElementById('end-file-3');

        updateCheckboxHTML(element_1);
        updateCheckboxHTML(element_2);
        updateCheckboxHTML(element_3);

        var elementToPrint_1 = element_1.outerHTML;
        var elementToPrint_2 = element_2.outerHTML;
        var elementToPrint_3 = element_3.outerHTML;

        var combinedContent = elementToPrint_1 + elementToPrint_2 + elementToPrint_3;



        
        
        printWindow.document.write('<html><head><title>Print</title>');
        printWindow.document.write(styles);  
        printWindow.document.write('</head><body>');
        printWindow.document.write(combinedContent);
        printWindow.document.write('</body></html>');
      
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        
    
    }
    document.getElementById('saveButton').addEventListener('click', function() {

        const link = document.createElement('a');
        link.href = myChart.toBase64Image();
        link.download = 'my_chart.png';  
        link.click();
    });

    [1, 2, 3, 4].forEach(setupControls);


    showTab(1);


         
</script>

</body>
</html>
